import{j as i,m as Me,X as He,U as nr,C as rr,S as Ge,L as Nt,a as Qr,b as ei,c as ir,d as sr,B as an,e as Wt,f as mn,g as or,h as ti,M as ni,i as ri,k as ii,l as si,n as oi,o as ai,R as li,p as Vt,E as ar,D as ct,q as nt,r as gn,I as ci,V as ln,F as Yt,P as ui,s as cn,t as di,u as fi,v as lr,w as hi,x as cr,y as pi,z as mi,A as gi,T as yi}from"./ui-vendor-dXPLF-X1.js";import{a as wi,r as S,R as ur,c as De,g as bi,b as xi,B as _i}from"./react-vendor-C52KUyp2.js";import{l as Ei}from"./socket-vendor-TjCxX7sJ.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(a){if(a.ep)return;a.ep=!0;const l=n(a);fetch(a.href,l)}})();var Gt={},yn=wi;Gt.createRoot=yn.createRoot,Gt.hydrateRoot=yn.hydrateRoot;function vi(e={}){const{nonce:t,onScriptLoadSuccess:n,onScriptLoadError:s}=e,[a,l]=S.useState(!1),c=S.useRef(n);c.current=n;const u=S.useRef(s);return u.current=s,S.useEffect(()=>{const b=document.createElement("script");return b.src="https://accounts.google.com/gsi/client",b.async=!0,b.defer=!0,b.nonce=t,b.onload=()=>{var h;l(!0),(h=c.current)===null||h===void 0||h.call(c)},b.onerror=()=>{var h;l(!1),(h=u.current)===null||h===void 0||h.call(u)},document.body.appendChild(b),()=>{document.body.removeChild(b)}},[t]),a}const Ri=S.createContext(null);function Ci({clientId:e,nonce:t,onScriptLoadSuccess:n,onScriptLoadError:s,children:a}){const l=vi({nonce:t,onScriptLoadSuccess:n,onScriptLoadError:s}),c=S.useMemo(()=>({clientId:e,scriptLoadedSuccessfully:l}),[e,l]);return ur.createElement(Ri.Provider,{value:c},a)}const dr=S.createContext(),ke=()=>{const e=S.useContext(dr);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},fr=({children:e})=>{const[t,n]=S.useState(null),[s,a]=S.useState(!0);S.useEffect(()=>{console.log("ðŸ” AuthContext: Checking stored auth data...");const h=localStorage.getItem("token"),f=localStorage.getItem("user");if(console.log("ðŸ” AuthContext: Token exists:",!!h),console.log("ðŸ” AuthContext: User data exists:",!!f),h&&f)try{const w=JSON.parse(f);console.log("âœ… AuthContext: Loaded user from storage:",w),n(w)}catch(w){console.error("âŒ AuthContext: Error parsing user data:",w),localStorage.removeItem("token"),localStorage.removeItem("user")}else console.log("âš ï¸ AuthContext: No valid auth data found");a(!1)},[]);const b={user:t,login:(h,f)=>{if(console.log("ðŸ”‘ AuthContext: Login called with:",{userData:f==null?void 0:f.name,token:!!h}),!f||!h){console.error("âŒ AuthContext: Invalid login data provided");return}localStorage.setItem("token",h),localStorage.setItem("user",JSON.stringify(f)),n(f),console.log("âœ… AuthContext: User logged in successfully:",f.name)},logout:()=>{console.log("ðŸšª AuthContext: Logging out user"),localStorage.removeItem("token"),localStorage.removeItem("user"),n(null)},updateProfile:async h=>{try{const f=localStorage.getItem("token"),w=new FormData;w.append("name",h.name),h.avatar&&w.append("avatar",h.avatar),console.log("ðŸ”„ AuthContext: Updating profile with:",{name:h.name,hasAvatar:!!h.avatar});const E=await fetch("https://lovebirds-ph.onrender.com/api/users/profile",{method:"PATCH",headers:{Authorization:`Bearer ${f}`},body:w});if(console.log("ðŸ“¡ AuthContext: Profile update response status:",E.status),!E.ok){let x="Failed to update profile";try{const C=await E.json();x=C.message||x,console.error("âŒ AuthContext: Profile update error:",C)}catch(C){x=E.statusText||x,console.error("âŒ AuthContext: Profile update error (no JSON):",C)}throw new Error(x)}const I=await E.json();return console.log("âœ… AuthContext: Profile updated successfully:",I),n(I),localStorage.setItem("user",JSON.stringify(I)),I}catch(f){throw console.error("âŒ AuthContext: Profile update error:",f),f}},loading:s};return i.jsx(dr.Provider,{value:b,children:e})},Pe=S.createContext(null),Si=e=>!e||typeof e!="string"?!1:e.split(".").length===3,hr=({children:e})=>{const[t,n]=S.useState(null),[s,a]=S.useState([]),{user:l,logout:c}=ke();return S.useEffect(()=>{if(l){console.log("ðŸ”Œ [SOCKET CONTEXT] Connecting socket for user:",l.name,l._id);const u=localStorage.getItem("token");if(!Si(u)){console.error("âŒ [SOCKET CONTEXT] Invalid JWT token found, logging out..."),c();return}const b=Ei("https://lovebirds-ph.onrender.com",{auth:{token:u},reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:5});return b.on("connect",()=>{console.log("âœ… [SOCKET CONTEXT] Socket connected:",b.id),setTimeout(()=>b.emit("loadRecentChats"),100)}),b.on("disconnect",h=>{console.log("âŒ [SOCKET CONTEXT] Socket disconnected:",h)}),b.on("connect_error",h=>{var f,w;console.error("âŒ [SOCKET CONTEXT] Socket connection error:",h),((f=h.message)!=null&&f.includes("Authentication")||(w=h.message)!=null&&w.includes("jwt"))&&(console.error("âŒ [SOCKET CONTEXT] JWT authentication failed, logging out..."),c())}),b.on("recentChatsLoaded",h=>{console.log("ðŸ“š [SOCKET CONTEXT] Recent chats loaded:",h),Array.isArray(h)&&a(h)}),b.on("newMessageForSidebar",h=>{var f;console.log("ðŸ“¡ [SOCKET CONTEXT] newMessageForSidebar event received (passing through):",{messageId:h._id,sender:(f=h.sender)==null?void 0:f.name,isForSender:h.isForSender,isForReceiver:h.isForReceiver,chatId:h.chatId})}),b.onAny((h,...f)=>{["ping","pong"].includes(h)||console.log(`ðŸ“¡ [SOCKET CONTEXT] Event: ${h}`,f[0])}),n(b),()=>{console.log("ðŸ”Œ [SOCKET CONTEXT] Closing socket connection"),b.close()}}else t&&(console.log("ðŸ”Œ [SOCKET CONTEXT] User logged out, closing socket"),t.close(),n(null),a([]))},[l,c]),S.useEffect(()=>{console.log("ðŸ” [SOCKET CONTEXT] Socket state changed:",{exists:!!t,connected:t==null?void 0:t.connected,id:t==null?void 0:t.id})},[t]),i.jsx(Pe.Provider,{value:t,children:e})},Ni=()=>S.useContext(Pe);var Kt={exports:{}},jt,wn;function ji(){if(wn)return jt;wn=1;var e=1e3,t=e*60,n=t*60,s=n*24,a=s*7,l=s*365.25;jt=function(f,w){w=w||{};var E=typeof f;if(E==="string"&&f.length>0)return c(f);if(E==="number"&&isFinite(f))return w.long?b(f):u(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))};function c(f){if(f=String(f),!(f.length>100)){var w=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(w){var E=parseFloat(w[1]),I=(w[2]||"ms").toLowerCase();switch(I){case"years":case"year":case"yrs":case"yr":case"y":return E*l;case"weeks":case"week":case"w":return E*a;case"days":case"day":case"d":return E*s;case"hours":case"hour":case"hrs":case"hr":case"h":return E*n;case"minutes":case"minute":case"mins":case"min":case"m":return E*t;case"seconds":case"second":case"secs":case"sec":case"s":return E*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return E;default:return}}}}function u(f){var w=Math.abs(f);return w>=s?Math.round(f/s)+"d":w>=n?Math.round(f/n)+"h":w>=t?Math.round(f/t)+"m":w>=e?Math.round(f/e)+"s":f+"ms"}function b(f){var w=Math.abs(f);return w>=s?h(f,w,s,"day"):w>=n?h(f,w,n,"hour"):w>=t?h(f,w,t,"minute"):w>=e?h(f,w,e,"second"):f+" ms"}function h(f,w,E,I){var x=w>=E*1.5;return Math.round(f/E)+" "+I+(x?"s":"")}return jt}function Ti(e){n.debug=n,n.default=n,n.coerce=b,n.disable=c,n.enable=a,n.enabled=u,n.humanize=ji(),n.destroy=h,Object.keys(e).forEach(f=>{n[f]=e[f]}),n.names=[],n.skips=[],n.formatters={};function t(f){let w=0;for(let E=0;E<f.length;E++)w=(w<<5)-w+f.charCodeAt(E),w|=0;return n.colors[Math.abs(w)%n.colors.length]}n.selectColor=t;function n(f){let w,E=null,I,x;function C(..._){if(!C.enabled)return;const m=C,k=Number(new Date),j=k-(w||k);m.diff=j,m.prev=w,m.curr=k,w=k,_[0]=n.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let N=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(z,W)=>{if(z==="%%")return"%";N++;const M=n.formatters[W];if(typeof M=="function"){const F=_[N];z=M.call(m,F),_.splice(N,1),N--}return z}),n.formatArgs.call(m,_),(m.log||n.log).apply(m,_)}return C.namespace=f,C.useColors=n.useColors(),C.color=n.selectColor(f),C.extend=s,C.destroy=n.destroy,Object.defineProperty(C,"enabled",{enumerable:!0,configurable:!1,get:()=>E!==null?E:(I!==n.namespaces&&(I=n.namespaces,x=n.enabled(f)),x),set:_=>{E=_}}),typeof n.init=="function"&&n.init(C),C}function s(f,w){const E=n(this.namespace+(typeof w>"u"?":":w)+f);return E.log=this.log,E}function a(f){n.save(f),n.namespaces=f,n.names=[],n.skips=[];const w=(typeof f=="string"?f:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const E of w)E[0]==="-"?n.skips.push(E.slice(1)):n.names.push(E)}function l(f,w){let E=0,I=0,x=-1,C=0;for(;E<f.length;)if(I<w.length&&(w[I]===f[E]||w[I]==="*"))w[I]==="*"?(x=I,C=E,I++):(E++,I++);else if(x!==-1)I=x+1,C++,E=C;else return!1;for(;I<w.length&&w[I]==="*";)I++;return I===w.length}function c(){const f=[...n.names,...n.skips.map(w=>"-"+w)].join(",");return n.enable(""),f}function u(f){for(const w of n.skips)if(l(f,w))return!1;for(const w of n.names)if(l(f,w))return!0;return!1}function b(f){return f instanceof Error?f.stack||f.message:f}function h(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var Ai=Ti;(function(e,t){var n={};t.formatArgs=a,t.save=l,t.load=c,t.useColors=s,t.storage=u(),t.destroy=(()=>{let h=!1;return()=>{h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function s(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let h;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(h=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(h[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function a(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const f="color: "+this.color;h.splice(1,0,f,"color: inherit");let w=0,E=0;h[0].replace(/%[a-zA-Z%]/g,I=>{I!=="%%"&&(w++,I==="%c"&&(E=w))}),h.splice(E,0,f)}t.log=console.debug||console.log||(()=>{});function l(h){try{h?t.storage.setItem("debug",h):t.storage.removeItem("debug")}catch{}}function c(){let h;try{h=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch{}return!h&&typeof process<"u"&&"env"in process&&(h=n.DEBUG),h}function u(){try{return localStorage}catch{}}e.exports=Ai(t);const{formatters:b}=e.exports;b.j=function(h){try{return JSON.stringify(h)}catch(f){return"[UnexpectedJSONParseError]: "+f.message}}})(Kt,Kt.exports);var Ii=Kt.exports,ki=function(){if(typeof globalThis>"u")return null;var t={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return t.RTCPeerConnection?t:null},Jt={exports:{}},Xt={exports:{}},Xe={},wt={};wt.byteLength=Fi;wt.toByteArray=Di;wt.fromByteArray=Ui;var Fe=[],Te=[],Oi=typeof Uint8Array<"u"?Uint8Array:Array,Tt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Ve=0,Bi=Tt.length;Ve<Bi;++Ve)Fe[Ve]=Tt[Ve],Te[Tt.charCodeAt(Ve)]=Ve;Te[45]=62;Te[95]=63;function pr(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var s=n===t?0:4-n%4;return[n,s]}function Fi(e){var t=pr(e),n=t[0],s=t[1];return(n+s)*3/4-s}function Pi(e,t,n){return(t+n)*3/4-n}function Di(e){var t,n=pr(e),s=n[0],a=n[1],l=new Oi(Pi(e,s,a)),c=0,u=a>0?s-4:s,b;for(b=0;b<u;b+=4)t=Te[e.charCodeAt(b)]<<18|Te[e.charCodeAt(b+1)]<<12|Te[e.charCodeAt(b+2)]<<6|Te[e.charCodeAt(b+3)],l[c++]=t>>16&255,l[c++]=t>>8&255,l[c++]=t&255;return a===2&&(t=Te[e.charCodeAt(b)]<<2|Te[e.charCodeAt(b+1)]>>4,l[c++]=t&255),a===1&&(t=Te[e.charCodeAt(b)]<<10|Te[e.charCodeAt(b+1)]<<4|Te[e.charCodeAt(b+2)]>>2,l[c++]=t>>8&255,l[c++]=t&255),l}function Li(e){return Fe[e>>18&63]+Fe[e>>12&63]+Fe[e>>6&63]+Fe[e&63]}function Mi(e,t,n){for(var s,a=[],l=t;l<n;l+=3)s=(e[l]<<16&16711680)+(e[l+1]<<8&65280)+(e[l+2]&255),a.push(Li(s));return a.join("")}function Ui(e){for(var t,n=e.length,s=n%3,a=[],l=16383,c=0,u=n-s;c<u;c+=l)a.push(Mi(e,c,c+l>u?u:c+l));return s===1?(t=e[n-1],a.push(Fe[t>>2]+Fe[t<<4&63]+"==")):s===2&&(t=(e[n-2]<<8)+e[n-1],a.push(Fe[t>>10]+Fe[t>>4&63]+Fe[t<<2&63]+"=")),a.join("")}var un={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */un.read=function(e,t,n,s,a){var l,c,u=a*8-s-1,b=(1<<u)-1,h=b>>1,f=-7,w=n?a-1:0,E=n?-1:1,I=e[t+w];for(w+=E,l=I&(1<<-f)-1,I>>=-f,f+=u;f>0;l=l*256+e[t+w],w+=E,f-=8);for(c=l&(1<<-f)-1,l>>=-f,f+=s;f>0;c=c*256+e[t+w],w+=E,f-=8);if(l===0)l=1-h;else{if(l===b)return c?NaN:(I?-1:1)*(1/0);c=c+Math.pow(2,s),l=l-h}return(I?-1:1)*c*Math.pow(2,l-s)};un.write=function(e,t,n,s,a,l){var c,u,b,h=l*8-a-1,f=(1<<h)-1,w=f>>1,E=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,I=s?0:l-1,x=s?1:-1,C=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(u=isNaN(t)?1:0,c=f):(c=Math.floor(Math.log(t)/Math.LN2),t*(b=Math.pow(2,-c))<1&&(c--,b*=2),c+w>=1?t+=E/b:t+=E*Math.pow(2,1-w),t*b>=2&&(c++,b/=2),c+w>=f?(u=0,c=f):c+w>=1?(u=(t*b-1)*Math.pow(2,a),c=c+w):(u=t*Math.pow(2,w-1)*Math.pow(2,a),c=0));a>=8;e[n+I]=u&255,I+=x,u/=256,a-=8);for(c=c<<a|u,h+=a;h>0;e[n+I]=c&255,I+=x,c/=256,h-=8);e[n+I-x]|=C*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=wt,n=un,s=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=u,e.SlowBuffer=k,e.INSPECT_MAX_BYTES=50;const a=2147483647;e.kMaxLength=a,u.TYPED_ARRAY_SUPPORT=l(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function l(){try{const d=new Uint8Array(1),r={foo:function(){return 42}};return Object.setPrototypeOf(r,Uint8Array.prototype),Object.setPrototypeOf(d,r),d.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function c(d){if(d>a)throw new RangeError('The value "'+d+'" is invalid for option "size"');const r=new Uint8Array(d);return Object.setPrototypeOf(r,u.prototype),r}function u(d,r,o){if(typeof d=="number"){if(typeof r=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return w(d)}return b(d,r,o)}u.poolSize=8192;function b(d,r,o){if(typeof d=="string")return E(d,r);if(ArrayBuffer.isView(d))return x(d);if(d==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof d);if(pe(d,ArrayBuffer)||d&&pe(d.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(pe(d,SharedArrayBuffer)||d&&pe(d.buffer,SharedArrayBuffer)))return C(d,r,o);if(typeof d=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const p=d.valueOf&&d.valueOf();if(p!=null&&p!==d)return u.from(p,r,o);const v=_(d);if(v)return v;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof d[Symbol.toPrimitive]=="function")return u.from(d[Symbol.toPrimitive]("string"),r,o);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof d)}u.from=function(d,r,o){return b(d,r,o)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array);function h(d){if(typeof d!="number")throw new TypeError('"size" argument must be of type number');if(d<0)throw new RangeError('The value "'+d+'" is invalid for option "size"')}function f(d,r,o){return h(d),d<=0?c(d):r!==void 0?typeof o=="string"?c(d).fill(r,o):c(d).fill(r):c(d)}u.alloc=function(d,r,o){return f(d,r,o)};function w(d){return h(d),c(d<0?0:m(d)|0)}u.allocUnsafe=function(d){return w(d)},u.allocUnsafeSlow=function(d){return w(d)};function E(d,r){if((typeof r!="string"||r==="")&&(r="utf8"),!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r);const o=j(d,r)|0;let p=c(o);const v=p.write(d,r);return v!==o&&(p=p.slice(0,v)),p}function I(d){const r=d.length<0?0:m(d.length)|0,o=c(r);for(let p=0;p<r;p+=1)o[p]=d[p]&255;return o}function x(d){if(pe(d,Uint8Array)){const r=new Uint8Array(d);return C(r.buffer,r.byteOffset,r.byteLength)}return I(d)}function C(d,r,o){if(r<0||d.byteLength<r)throw new RangeError('"offset" is outside of buffer bounds');if(d.byteLength<r+(o||0))throw new RangeError('"length" is outside of buffer bounds');let p;return r===void 0&&o===void 0?p=new Uint8Array(d):o===void 0?p=new Uint8Array(d,r):p=new Uint8Array(d,r,o),Object.setPrototypeOf(p,u.prototype),p}function _(d){if(u.isBuffer(d)){const r=m(d.length)|0,o=c(r);return o.length===0||d.copy(o,0,0,r),o}if(d.length!==void 0)return typeof d.length!="number"||je(d.length)?c(0):I(d);if(d.type==="Buffer"&&Array.isArray(d.data))return I(d.data)}function m(d){if(d>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return d|0}function k(d){return+d!=d&&(d=0),u.alloc(+d)}u.isBuffer=function(r){return r!=null&&r._isBuffer===!0&&r!==u.prototype},u.compare=function(r,o){if(pe(r,Uint8Array)&&(r=u.from(r,r.offset,r.byteLength)),pe(o,Uint8Array)&&(o=u.from(o,o.offset,o.byteLength)),!u.isBuffer(r)||!u.isBuffer(o))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(r===o)return 0;let p=r.length,v=o.length;for(let A=0,U=Math.min(p,v);A<U;++A)if(r[A]!==o[A]){p=r[A],v=o[A];break}return p<v?-1:v<p?1:0},u.isEncoding=function(r){switch(String(r).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(r,o){if(!Array.isArray(r))throw new TypeError('"list" argument must be an Array of Buffers');if(r.length===0)return u.alloc(0);let p;if(o===void 0)for(o=0,p=0;p<r.length;++p)o+=r[p].length;const v=u.allocUnsafe(o);let A=0;for(p=0;p<r.length;++p){let U=r[p];if(pe(U,Uint8Array))A+U.length>v.length?(u.isBuffer(U)||(U=u.from(U)),U.copy(v,A)):Uint8Array.prototype.set.call(v,U,A);else if(u.isBuffer(U))U.copy(v,A);else throw new TypeError('"list" argument must be an Array of Buffers');A+=U.length}return v};function j(d,r){if(u.isBuffer(d))return d.length;if(ArrayBuffer.isView(d)||pe(d,ArrayBuffer))return d.byteLength;if(typeof d!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof d);const o=d.length,p=arguments.length>2&&arguments[2]===!0;if(!p&&o===0)return 0;let v=!1;for(;;)switch(r){case"ascii":case"latin1":case"binary":return o;case"utf8":case"utf-8":return re(d).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return o*2;case"hex":return o>>>1;case"base64":return Re(d).length;default:if(v)return p?-1:re(d).length;r=(""+r).toLowerCase(),v=!0}}u.byteLength=j;function N(d,r,o){let p=!1;if((r===void 0||r<0)&&(r=0),r>this.length||((o===void 0||o>this.length)&&(o=this.length),o<=0)||(o>>>=0,r>>>=0,o<=r))return"";for(d||(d="utf8");;)switch(d){case"hex":return fe(this,r,o);case"utf8":case"utf-8":return X(this,r,o);case"ascii":return ue(this,r,o);case"latin1":case"binary":return Y(this,r,o);case"base64":return J(this,r,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return de(this,r,o);default:if(p)throw new TypeError("Unknown encoding: "+d);d=(d+"").toLowerCase(),p=!0}}u.prototype._isBuffer=!0;function B(d,r,o){const p=d[r];d[r]=d[o],d[o]=p}u.prototype.swap16=function(){const r=this.length;if(r%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let o=0;o<r;o+=2)B(this,o,o+1);return this},u.prototype.swap32=function(){const r=this.length;if(r%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let o=0;o<r;o+=4)B(this,o,o+3),B(this,o+1,o+2);return this},u.prototype.swap64=function(){const r=this.length;if(r%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let o=0;o<r;o+=8)B(this,o,o+7),B(this,o+1,o+6),B(this,o+2,o+5),B(this,o+3,o+4);return this},u.prototype.toString=function(){const r=this.length;return r===0?"":arguments.length===0?X(this,0,r):N.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(r){if(!u.isBuffer(r))throw new TypeError("Argument must be a Buffer");return this===r?!0:u.compare(this,r)===0},u.prototype.inspect=function(){let r="";const o=e.INSPECT_MAX_BYTES;return r=this.toString("hex",0,o).replace(/(.{2})/g,"$1 ").trim(),this.length>o&&(r+=" ... "),"<Buffer "+r+">"},s&&(u.prototype[s]=u.prototype.inspect),u.prototype.compare=function(r,o,p,v,A){if(pe(r,Uint8Array)&&(r=u.from(r,r.offset,r.byteLength)),!u.isBuffer(r))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof r);if(o===void 0&&(o=0),p===void 0&&(p=r?r.length:0),v===void 0&&(v=0),A===void 0&&(A=this.length),o<0||p>r.length||v<0||A>this.length)throw new RangeError("out of range index");if(v>=A&&o>=p)return 0;if(v>=A)return-1;if(o>=p)return 1;if(o>>>=0,p>>>=0,v>>>=0,A>>>=0,this===r)return 0;let U=A-v,ae=p-o;const ge=Math.min(U,ae),me=this.slice(v,A),ye=r.slice(o,p);for(let he=0;he<ge;++he)if(me[he]!==ye[he]){U=me[he],ae=ye[he];break}return U<ae?-1:ae<U?1:0};function z(d,r,o,p,v){if(d.length===0)return-1;if(typeof o=="string"?(p=o,o=0):o>2147483647?o=2147483647:o<-2147483648&&(o=-2147483648),o=+o,je(o)&&(o=v?0:d.length-1),o<0&&(o=d.length+o),o>=d.length){if(v)return-1;o=d.length-1}else if(o<0)if(v)o=0;else return-1;if(typeof r=="string"&&(r=u.from(r,p)),u.isBuffer(r))return r.length===0?-1:W(d,r,o,p,v);if(typeof r=="number")return r=r&255,typeof Uint8Array.prototype.indexOf=="function"?v?Uint8Array.prototype.indexOf.call(d,r,o):Uint8Array.prototype.lastIndexOf.call(d,r,o):W(d,[r],o,p,v);throw new TypeError("val must be string, number or Buffer")}function W(d,r,o,p,v){let A=1,U=d.length,ae=r.length;if(p!==void 0&&(p=String(p).toLowerCase(),p==="ucs2"||p==="ucs-2"||p==="utf16le"||p==="utf-16le")){if(d.length<2||r.length<2)return-1;A=2,U/=2,ae/=2,o/=2}function ge(ye,he){return A===1?ye[he]:ye.readUInt16BE(he*A)}let me;if(v){let ye=-1;for(me=o;me<U;me++)if(ge(d,me)===ge(r,ye===-1?0:me-ye)){if(ye===-1&&(ye=me),me-ye+1===ae)return ye*A}else ye!==-1&&(me-=me-ye),ye=-1}else for(o+ae>U&&(o=U-ae),me=o;me>=0;me--){let ye=!0;for(let he=0;he<ae;he++)if(ge(d,me+he)!==ge(r,he)){ye=!1;break}if(ye)return me}return-1}u.prototype.includes=function(r,o,p){return this.indexOf(r,o,p)!==-1},u.prototype.indexOf=function(r,o,p){return z(this,r,o,p,!0)},u.prototype.lastIndexOf=function(r,o,p){return z(this,r,o,p,!1)};function M(d,r,o,p){o=Number(o)||0;const v=d.length-o;p?(p=Number(p),p>v&&(p=v)):p=v;const A=r.length;p>A/2&&(p=A/2);let U;for(U=0;U<p;++U){const ae=parseInt(r.substr(U*2,2),16);if(je(ae))return U;d[o+U]=ae}return U}function F(d,r,o,p){return xe(re(r,d.length-o),d,o,p)}function G(d,r,o,p){return xe(be(r),d,o,p)}function ie(d,r,o,p){return xe(Re(r),d,o,p)}function $(d,r,o,p){return xe(_e(r,d.length-o),d,o,p)}u.prototype.write=function(r,o,p,v){if(o===void 0)v="utf8",p=this.length,o=0;else if(p===void 0&&typeof o=="string")v=o,p=this.length,o=0;else if(isFinite(o))o=o>>>0,isFinite(p)?(p=p>>>0,v===void 0&&(v="utf8")):(v=p,p=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const A=this.length-o;if((p===void 0||p>A)&&(p=A),r.length>0&&(p<0||o<0)||o>this.length)throw new RangeError("Attempt to write outside buffer bounds");v||(v="utf8");let U=!1;for(;;)switch(v){case"hex":return M(this,r,o,p);case"utf8":case"utf-8":return F(this,r,o,p);case"ascii":case"latin1":case"binary":return G(this,r,o,p);case"base64":return ie(this,r,o,p);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $(this,r,o,p);default:if(U)throw new TypeError("Unknown encoding: "+v);v=(""+v).toLowerCase(),U=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function J(d,r,o){return r===0&&o===d.length?t.fromByteArray(d):t.fromByteArray(d.slice(r,o))}function X(d,r,o){o=Math.min(d.length,o);const p=[];let v=r;for(;v<o;){const A=d[v];let U=null,ae=A>239?4:A>223?3:A>191?2:1;if(v+ae<=o){let ge,me,ye,he;switch(ae){case 1:A<128&&(U=A);break;case 2:ge=d[v+1],(ge&192)===128&&(he=(A&31)<<6|ge&63,he>127&&(U=he));break;case 3:ge=d[v+1],me=d[v+2],(ge&192)===128&&(me&192)===128&&(he=(A&15)<<12|(ge&63)<<6|me&63,he>2047&&(he<55296||he>57343)&&(U=he));break;case 4:ge=d[v+1],me=d[v+2],ye=d[v+3],(ge&192)===128&&(me&192)===128&&(ye&192)===128&&(he=(A&15)<<18|(ge&63)<<12|(me&63)<<6|ye&63,he>65535&&he<1114112&&(U=he))}}U===null?(U=65533,ae=1):U>65535&&(U-=65536,p.push(U>>>10&1023|55296),U=56320|U&1023),p.push(U),v+=ae}return ce(p)}const ne=4096;function ce(d){const r=d.length;if(r<=ne)return String.fromCharCode.apply(String,d);let o="",p=0;for(;p<r;)o+=String.fromCharCode.apply(String,d.slice(p,p+=ne));return o}function ue(d,r,o){let p="";o=Math.min(d.length,o);for(let v=r;v<o;++v)p+=String.fromCharCode(d[v]&127);return p}function Y(d,r,o){let p="";o=Math.min(d.length,o);for(let v=r;v<o;++v)p+=String.fromCharCode(d[v]);return p}function fe(d,r,o){const p=d.length;(!r||r<0)&&(r=0),(!o||o<0||o>p)&&(o=p);let v="";for(let A=r;A<o;++A)v+=Ie[d[A]];return v}function de(d,r,o){const p=d.slice(r,o);let v="";for(let A=0;A<p.length-1;A+=2)v+=String.fromCharCode(p[A]+p[A+1]*256);return v}u.prototype.slice=function(r,o){const p=this.length;r=~~r,o=o===void 0?p:~~o,r<0?(r+=p,r<0&&(r=0)):r>p&&(r=p),o<0?(o+=p,o<0&&(o=0)):o>p&&(o=p),o<r&&(o=r);const v=this.subarray(r,o);return Object.setPrototypeOf(v,u.prototype),v};function ee(d,r,o){if(d%1!==0||d<0)throw new RangeError("offset is not uint");if(d+r>o)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(r,o,p){r=r>>>0,o=o>>>0,p||ee(r,o,this.length);let v=this[r],A=1,U=0;for(;++U<o&&(A*=256);)v+=this[r+U]*A;return v},u.prototype.readUintBE=u.prototype.readUIntBE=function(r,o,p){r=r>>>0,o=o>>>0,p||ee(r,o,this.length);let v=this[r+--o],A=1;for(;o>0&&(A*=256);)v+=this[r+--o]*A;return v},u.prototype.readUint8=u.prototype.readUInt8=function(r,o){return r=r>>>0,o||ee(r,1,this.length),this[r]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(r,o){return r=r>>>0,o||ee(r,2,this.length),this[r]|this[r+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(r,o){return r=r>>>0,o||ee(r,2,this.length),this[r]<<8|this[r+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(r,o){return r=r>>>0,o||ee(r,4,this.length),(this[r]|this[r+1]<<8|this[r+2]<<16)+this[r+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(r,o){return r=r>>>0,o||ee(r,4,this.length),this[r]*16777216+(this[r+1]<<16|this[r+2]<<8|this[r+3])},u.prototype.readBigUInt64LE=Ee(function(r){r=r>>>0,q(r,"offset");const o=this[r],p=this[r+7];(o===void 0||p===void 0)&&P(r,this.length-8);const v=o+this[++r]*2**8+this[++r]*2**16+this[++r]*2**24,A=this[++r]+this[++r]*2**8+this[++r]*2**16+p*2**24;return BigInt(v)+(BigInt(A)<<BigInt(32))}),u.prototype.readBigUInt64BE=Ee(function(r){r=r>>>0,q(r,"offset");const o=this[r],p=this[r+7];(o===void 0||p===void 0)&&P(r,this.length-8);const v=o*2**24+this[++r]*2**16+this[++r]*2**8+this[++r],A=this[++r]*2**24+this[++r]*2**16+this[++r]*2**8+p;return(BigInt(v)<<BigInt(32))+BigInt(A)}),u.prototype.readIntLE=function(r,o,p){r=r>>>0,o=o>>>0,p||ee(r,o,this.length);let v=this[r],A=1,U=0;for(;++U<o&&(A*=256);)v+=this[r+U]*A;return A*=128,v>=A&&(v-=Math.pow(2,8*o)),v},u.prototype.readIntBE=function(r,o,p){r=r>>>0,o=o>>>0,p||ee(r,o,this.length);let v=o,A=1,U=this[r+--v];for(;v>0&&(A*=256);)U+=this[r+--v]*A;return A*=128,U>=A&&(U-=Math.pow(2,8*o)),U},u.prototype.readInt8=function(r,o){return r=r>>>0,o||ee(r,1,this.length),this[r]&128?(255-this[r]+1)*-1:this[r]},u.prototype.readInt16LE=function(r,o){r=r>>>0,o||ee(r,2,this.length);const p=this[r]|this[r+1]<<8;return p&32768?p|4294901760:p},u.prototype.readInt16BE=function(r,o){r=r>>>0,o||ee(r,2,this.length);const p=this[r+1]|this[r]<<8;return p&32768?p|4294901760:p},u.prototype.readInt32LE=function(r,o){return r=r>>>0,o||ee(r,4,this.length),this[r]|this[r+1]<<8|this[r+2]<<16|this[r+3]<<24},u.prototype.readInt32BE=function(r,o){return r=r>>>0,o||ee(r,4,this.length),this[r]<<24|this[r+1]<<16|this[r+2]<<8|this[r+3]},u.prototype.readBigInt64LE=Ee(function(r){r=r>>>0,q(r,"offset");const o=this[r],p=this[r+7];(o===void 0||p===void 0)&&P(r,this.length-8);const v=this[r+4]+this[r+5]*2**8+this[r+6]*2**16+(p<<24);return(BigInt(v)<<BigInt(32))+BigInt(o+this[++r]*2**8+this[++r]*2**16+this[++r]*2**24)}),u.prototype.readBigInt64BE=Ee(function(r){r=r>>>0,q(r,"offset");const o=this[r],p=this[r+7];(o===void 0||p===void 0)&&P(r,this.length-8);const v=(o<<24)+this[++r]*2**16+this[++r]*2**8+this[++r];return(BigInt(v)<<BigInt(32))+BigInt(this[++r]*2**24+this[++r]*2**16+this[++r]*2**8+p)}),u.prototype.readFloatLE=function(r,o){return r=r>>>0,o||ee(r,4,this.length),n.read(this,r,!0,23,4)},u.prototype.readFloatBE=function(r,o){return r=r>>>0,o||ee(r,4,this.length),n.read(this,r,!1,23,4)},u.prototype.readDoubleLE=function(r,o){return r=r>>>0,o||ee(r,8,this.length),n.read(this,r,!0,52,8)},u.prototype.readDoubleBE=function(r,o){return r=r>>>0,o||ee(r,8,this.length),n.read(this,r,!1,52,8)};function D(d,r,o,p,v,A){if(!u.isBuffer(d))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>v||r<A)throw new RangeError('"value" argument is out of bounds');if(o+p>d.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(r,o,p,v){if(r=+r,o=o>>>0,p=p>>>0,!v){const ae=Math.pow(2,8*p)-1;D(this,r,o,p,ae,0)}let A=1,U=0;for(this[o]=r&255;++U<p&&(A*=256);)this[o+U]=r/A&255;return o+p},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(r,o,p,v){if(r=+r,o=o>>>0,p=p>>>0,!v){const ae=Math.pow(2,8*p)-1;D(this,r,o,p,ae,0)}let A=p-1,U=1;for(this[o+A]=r&255;--A>=0&&(U*=256);)this[o+A]=r/U&255;return o+p},u.prototype.writeUint8=u.prototype.writeUInt8=function(r,o,p){return r=+r,o=o>>>0,p||D(this,r,o,1,255,0),this[o]=r&255,o+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(r,o,p){return r=+r,o=o>>>0,p||D(this,r,o,2,65535,0),this[o]=r&255,this[o+1]=r>>>8,o+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(r,o,p){return r=+r,o=o>>>0,p||D(this,r,o,2,65535,0),this[o]=r>>>8,this[o+1]=r&255,o+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(r,o,p){return r=+r,o=o>>>0,p||D(this,r,o,4,4294967295,0),this[o+3]=r>>>24,this[o+2]=r>>>16,this[o+1]=r>>>8,this[o]=r&255,o+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(r,o,p){return r=+r,o=o>>>0,p||D(this,r,o,4,4294967295,0),this[o]=r>>>24,this[o+1]=r>>>16,this[o+2]=r>>>8,this[o+3]=r&255,o+4};function H(d,r,o,p,v){g(r,p,v,d,o,7);let A=Number(r&BigInt(4294967295));d[o++]=A,A=A>>8,d[o++]=A,A=A>>8,d[o++]=A,A=A>>8,d[o++]=A;let U=Number(r>>BigInt(32)&BigInt(4294967295));return d[o++]=U,U=U>>8,d[o++]=U,U=U>>8,d[o++]=U,U=U>>8,d[o++]=U,o}function te(d,r,o,p,v){g(r,p,v,d,o,7);let A=Number(r&BigInt(4294967295));d[o+7]=A,A=A>>8,d[o+6]=A,A=A>>8,d[o+5]=A,A=A>>8,d[o+4]=A;let U=Number(r>>BigInt(32)&BigInt(4294967295));return d[o+3]=U,U=U>>8,d[o+2]=U,U=U>>8,d[o+1]=U,U=U>>8,d[o]=U,o+8}u.prototype.writeBigUInt64LE=Ee(function(r,o=0){return H(this,r,o,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Ee(function(r,o=0){return te(this,r,o,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(r,o,p,v){if(r=+r,o=o>>>0,!v){const ge=Math.pow(2,8*p-1);D(this,r,o,p,ge-1,-ge)}let A=0,U=1,ae=0;for(this[o]=r&255;++A<p&&(U*=256);)r<0&&ae===0&&this[o+A-1]!==0&&(ae=1),this[o+A]=(r/U>>0)-ae&255;return o+p},u.prototype.writeIntBE=function(r,o,p,v){if(r=+r,o=o>>>0,!v){const ge=Math.pow(2,8*p-1);D(this,r,o,p,ge-1,-ge)}let A=p-1,U=1,ae=0;for(this[o+A]=r&255;--A>=0&&(U*=256);)r<0&&ae===0&&this[o+A+1]!==0&&(ae=1),this[o+A]=(r/U>>0)-ae&255;return o+p},u.prototype.writeInt8=function(r,o,p){return r=+r,o=o>>>0,p||D(this,r,o,1,127,-128),r<0&&(r=255+r+1),this[o]=r&255,o+1},u.prototype.writeInt16LE=function(r,o,p){return r=+r,o=o>>>0,p||D(this,r,o,2,32767,-32768),this[o]=r&255,this[o+1]=r>>>8,o+2},u.prototype.writeInt16BE=function(r,o,p){return r=+r,o=o>>>0,p||D(this,r,o,2,32767,-32768),this[o]=r>>>8,this[o+1]=r&255,o+2},u.prototype.writeInt32LE=function(r,o,p){return r=+r,o=o>>>0,p||D(this,r,o,4,2147483647,-2147483648),this[o]=r&255,this[o+1]=r>>>8,this[o+2]=r>>>16,this[o+3]=r>>>24,o+4},u.prototype.writeInt32BE=function(r,o,p){return r=+r,o=o>>>0,p||D(this,r,o,4,2147483647,-2147483648),r<0&&(r=4294967295+r+1),this[o]=r>>>24,this[o+1]=r>>>16,this[o+2]=r>>>8,this[o+3]=r&255,o+4},u.prototype.writeBigInt64LE=Ee(function(r,o=0){return H(this,r,o,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Ee(function(r,o=0){return te(this,r,o,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function oe(d,r,o,p,v,A){if(o+p>d.length)throw new RangeError("Index out of range");if(o<0)throw new RangeError("Index out of range")}function T(d,r,o,p,v){return r=+r,o=o>>>0,v||oe(d,r,o,4),n.write(d,r,o,p,23,4),o+4}u.prototype.writeFloatLE=function(r,o,p){return T(this,r,o,!0,p)},u.prototype.writeFloatBE=function(r,o,p){return T(this,r,o,!1,p)};function R(d,r,o,p,v){return r=+r,o=o>>>0,v||oe(d,r,o,8),n.write(d,r,o,p,52,8),o+8}u.prototype.writeDoubleLE=function(r,o,p){return R(this,r,o,!0,p)},u.prototype.writeDoubleBE=function(r,o,p){return R(this,r,o,!1,p)},u.prototype.copy=function(r,o,p,v){if(!u.isBuffer(r))throw new TypeError("argument should be a Buffer");if(p||(p=0),!v&&v!==0&&(v=this.length),o>=r.length&&(o=r.length),o||(o=0),v>0&&v<p&&(v=p),v===p||r.length===0||this.length===0)return 0;if(o<0)throw new RangeError("targetStart out of bounds");if(p<0||p>=this.length)throw new RangeError("Index out of range");if(v<0)throw new RangeError("sourceEnd out of bounds");v>this.length&&(v=this.length),r.length-o<v-p&&(v=r.length-o+p);const A=v-p;return this===r&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(o,p,v):Uint8Array.prototype.set.call(r,this.subarray(p,v),o),A},u.prototype.fill=function(r,o,p,v){if(typeof r=="string"){if(typeof o=="string"?(v=o,o=0,p=this.length):typeof p=="string"&&(v=p,p=this.length),v!==void 0&&typeof v!="string")throw new TypeError("encoding must be a string");if(typeof v=="string"&&!u.isEncoding(v))throw new TypeError("Unknown encoding: "+v);if(r.length===1){const U=r.charCodeAt(0);(v==="utf8"&&U<128||v==="latin1")&&(r=U)}}else typeof r=="number"?r=r&255:typeof r=="boolean"&&(r=Number(r));if(o<0||this.length<o||this.length<p)throw new RangeError("Out of range index");if(p<=o)return this;o=o>>>0,p=p===void 0?this.length:p>>>0,r||(r=0);let A;if(typeof r=="number")for(A=o;A<p;++A)this[A]=r;else{const U=u.isBuffer(r)?r:u.from(r,v),ae=U.length;if(ae===0)throw new TypeError('The value "'+r+'" is invalid for argument "value"');for(A=0;A<p-o;++A)this[A+o]=U[A%ae]}return this};const L={};function V(d,r,o){L[d]=class extends o{constructor(){super(),Object.defineProperty(this,"message",{value:r.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${d}]`,this.stack,delete this.name}get code(){return d}set code(v){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:v,writable:!0})}toString(){return`${this.name} [${d}]: ${this.message}`}}}V("ERR_BUFFER_OUT_OF_BOUNDS",function(d){return d?`${d} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),V("ERR_INVALID_ARG_TYPE",function(d,r){return`The "${d}" argument must be of type number. Received type ${typeof r}`},TypeError),V("ERR_OUT_OF_RANGE",function(d,r,o){let p=`The value of "${d}" is out of range.`,v=o;return Number.isInteger(o)&&Math.abs(o)>2**32?v=Z(String(o)):typeof o=="bigint"&&(v=String(o),(o>BigInt(2)**BigInt(32)||o<-(BigInt(2)**BigInt(32)))&&(v=Z(v)),v+="n"),p+=` It must be ${r}. Received ${v}`,p},RangeError);function Z(d){let r="",o=d.length;const p=d[0]==="-"?1:0;for(;o>=p+4;o-=3)r=`_${d.slice(o-3,o)}${r}`;return`${d.slice(0,o)}${r}`}function y(d,r,o){q(r,"offset"),(d[r]===void 0||d[r+o]===void 0)&&P(r,d.length-(o+1))}function g(d,r,o,p,v,A){if(d>o||d<r){const U=typeof r=="bigint"?"n":"";let ae;throw r===0||r===BigInt(0)?ae=`>= 0${U} and < 2${U} ** ${(A+1)*8}${U}`:ae=`>= -(2${U} ** ${(A+1)*8-1}${U}) and < 2 ** ${(A+1)*8-1}${U}`,new L.ERR_OUT_OF_RANGE("value",ae,d)}y(p,v,A)}function q(d,r){if(typeof d!="number")throw new L.ERR_INVALID_ARG_TYPE(r,"number",d)}function P(d,r,o){throw Math.floor(d)!==d?(q(d,o),new L.ERR_OUT_OF_RANGE("offset","an integer",d)):r<0?new L.ERR_BUFFER_OUT_OF_BOUNDS:new L.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${r}`,d)}const Q=/[^+/0-9A-Za-z-_]/g;function K(d){if(d=d.split("=")[0],d=d.trim().replace(Q,""),d.length<2)return"";for(;d.length%4!==0;)d=d+"=";return d}function re(d,r){r=r||1/0;let o;const p=d.length;let v=null;const A=[];for(let U=0;U<p;++U){if(o=d.charCodeAt(U),o>55295&&o<57344){if(!v){if(o>56319){(r-=3)>-1&&A.push(239,191,189);continue}else if(U+1===p){(r-=3)>-1&&A.push(239,191,189);continue}v=o;continue}if(o<56320){(r-=3)>-1&&A.push(239,191,189),v=o;continue}o=(v-55296<<10|o-56320)+65536}else v&&(r-=3)>-1&&A.push(239,191,189);if(v=null,o<128){if((r-=1)<0)break;A.push(o)}else if(o<2048){if((r-=2)<0)break;A.push(o>>6|192,o&63|128)}else if(o<65536){if((r-=3)<0)break;A.push(o>>12|224,o>>6&63|128,o&63|128)}else if(o<1114112){if((r-=4)<0)break;A.push(o>>18|240,o>>12&63|128,o>>6&63|128,o&63|128)}else throw new Error("Invalid code point")}return A}function be(d){const r=[];for(let o=0;o<d.length;++o)r.push(d.charCodeAt(o)&255);return r}function _e(d,r){let o,p,v;const A=[];for(let U=0;U<d.length&&!((r-=2)<0);++U)o=d.charCodeAt(U),p=o>>8,v=o%256,A.push(v),A.push(p);return A}function Re(d){return t.toByteArray(K(d))}function xe(d,r,o,p){let v;for(v=0;v<p&&!(v+o>=r.length||v>=d.length);++v)r[v+o]=d[v];return v}function pe(d,r){return d instanceof r||d!=null&&d.constructor!=null&&d.constructor.name!=null&&d.constructor.name===r.name}function je(d){return d!==d}const Ie=function(){const d="0123456789abcdef",r=new Array(256);for(let o=0;o<16;++o){const p=o*16;for(let v=0;v<16;++v)r[p+v]=d[o]+d[v]}return r}();function Ee(d){return typeof BigInt>"u"?Ce:d}function Ce(){throw new Error("BigInt not supported")}})(Xe);/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(e,t){var n=Xe,s=n.Buffer;function a(c,u){for(var b in c)u[b]=c[b]}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?e.exports=n:(a(n,t),t.Buffer=l);function l(c,u,b){return s(c,u,b)}l.prototype=Object.create(s.prototype),a(s,l),l.from=function(c,u,b){if(typeof c=="number")throw new TypeError("Argument must not be a number");return s(c,u,b)},l.alloc=function(c,u,b){if(typeof c!="number")throw new TypeError("Argument must be a number");var h=s(c);return u!==void 0?typeof b=="string"?h.fill(u,b):h.fill(u):h.fill(0),h},l.allocUnsafe=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return s(c)},l.allocUnsafeSlow=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return n.SlowBuffer(c)}})(Xt,Xt.exports);var mr=Xt.exports,At=65536,qi=4294967295;function $i(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var zi=mr.Buffer,mt=De.crypto||De.msCrypto;mt&&mt.getRandomValues?Jt.exports=Hi:Jt.exports=$i;function Hi(e,t){if(e>qi)throw new RangeError("requested too many random bytes");var n=zi.allocUnsafe(e);if(e>0)if(e>At)for(var s=0;s<e;s+=At)mt.getRandomValues(n.slice(s,s+At));else mt.getRandomValues(n);return typeof t=="function"?process.nextTick(function(){t(null,n)}):n}var Wi=Jt.exports,Zt={exports:{}};const Vi={},Yi=Object.freeze(Object.defineProperty({__proto__:null,default:Vi},Symbol.toStringTag,{value:"Module"})),gt=bi(Yi);var gr=gt.EventEmitter,It,bn;function Gi(){if(bn)return It;bn=1;function e(x,C){var _=Object.keys(x);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(x);C&&(m=m.filter(function(k){return Object.getOwnPropertyDescriptor(x,k).enumerable})),_.push.apply(_,m)}return _}function t(x){for(var C=1;C<arguments.length;C++){var _=arguments[C]!=null?arguments[C]:{};C%2?e(Object(_),!0).forEach(function(m){n(x,m,_[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(_)):e(Object(_)).forEach(function(m){Object.defineProperty(x,m,Object.getOwnPropertyDescriptor(_,m))})}return x}function n(x,C,_){return C=c(C),C in x?Object.defineProperty(x,C,{value:_,enumerable:!0,configurable:!0,writable:!0}):x[C]=_,x}function s(x,C){if(!(x instanceof C))throw new TypeError("Cannot call a class as a function")}function a(x,C){for(var _=0;_<C.length;_++){var m=C[_];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(x,c(m.key),m)}}function l(x,C,_){return C&&a(x.prototype,C),Object.defineProperty(x,"prototype",{writable:!1}),x}function c(x){var C=u(x,"string");return typeof C=="symbol"?C:String(C)}function u(x,C){if(typeof x!="object"||x===null)return x;var _=x[Symbol.toPrimitive];if(_!==void 0){var m=_.call(x,C);if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(x)}var b=Xe,h=b.Buffer,f=gt,w=f.inspect,E=w&&w.custom||"inspect";function I(x,C,_){h.prototype.copy.call(x,C,_)}return It=function(){function x(){s(this,x),this.head=null,this.tail=null,this.length=0}return l(x,[{key:"push",value:function(_){var m={data:_,next:null};this.length>0?this.tail.next=m:this.head=m,this.tail=m,++this.length}},{key:"unshift",value:function(_){var m={data:_,next:this.head};this.length===0&&(this.tail=m),this.head=m,++this.length}},{key:"shift",value:function(){if(this.length!==0){var _=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,_}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(_){if(this.length===0)return"";for(var m=this.head,k=""+m.data;m=m.next;)k+=_+m.data;return k}},{key:"concat",value:function(_){if(this.length===0)return h.alloc(0);for(var m=h.allocUnsafe(_>>>0),k=this.head,j=0;k;)I(k.data,m,j),j+=k.data.length,k=k.next;return m}},{key:"consume",value:function(_,m){var k;return _<this.head.data.length?(k=this.head.data.slice(0,_),this.head.data=this.head.data.slice(_)):_===this.head.data.length?k=this.shift():k=m?this._getString(_):this._getBuffer(_),k}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(_){var m=this.head,k=1,j=m.data;for(_-=j.length;m=m.next;){var N=m.data,B=_>N.length?N.length:_;if(B===N.length?j+=N:j+=N.slice(0,_),_-=B,_===0){B===N.length?(++k,m.next?this.head=m.next:this.head=this.tail=null):(this.head=m,m.data=N.slice(B));break}++k}return this.length-=k,j}},{key:"_getBuffer",value:function(_){var m=h.allocUnsafe(_),k=this.head,j=1;for(k.data.copy(m),_-=k.data.length;k=k.next;){var N=k.data,B=_>N.length?N.length:_;if(N.copy(m,m.length-_,0,B),_-=B,_===0){B===N.length?(++j,k.next?this.head=k.next:this.head=this.tail=null):(this.head=k,k.data=N.slice(B));break}++j}return this.length-=j,m}},{key:E,value:function(_,m){return w(this,t(t({},m),{},{depth:0,customInspect:!1}))}}]),x}(),It}function Ki(e,t){var n=this,s=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;return s||a?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(Qt,this,e)):process.nextTick(Qt,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(l){!t&&l?n._writableState?n._writableState.errorEmitted?process.nextTick(dt,n):(n._writableState.errorEmitted=!0,process.nextTick(xn,n,l)):process.nextTick(xn,n,l):t?(process.nextTick(dt,n),t(l)):process.nextTick(dt,n)}),this)}function xn(e,t){Qt(e,t),dt(e)}function dt(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function Ji(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function Qt(e,t){e.emit("error",t)}function Xi(e,t){var n=e._readableState,s=e._writableState;n&&n.autoDestroy||s&&s.autoDestroy?e.destroy(t):e.emit("error",t)}var yr={destroy:Ki,undestroy:Ji,errorOrDestroy:Xi},We={};function Zi(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var wr={};function Ae(e,t,n){n||(n=Error);function s(l,c,u){return typeof t=="string"?t:t(l,c,u)}var a=function(l){Zi(c,l);function c(u,b,h){return l.call(this,s(u,b,h))||this}return c}(n);a.prototype.name=n.name,a.prototype.code=e,wr[e]=a}function _n(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map(function(s){return String(s)}),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:n===2?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}else return"of ".concat(t," ").concat(String(e))}function Qi(e,t,n){return e.substr(0,t.length)===t}function es(e,t,n){return(n===void 0||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}function ts(e,t,n){return typeof n!="number"&&(n=0),n+t.length>e.length?!1:e.indexOf(t,n)!==-1}Ae("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError);Ae("ERR_INVALID_ARG_TYPE",function(e,t,n){var s;typeof t=="string"&&Qi(t,"not ")?(s="must not be",t=t.replace(/^not /,"")):s="must be";var a;if(es(e," argument"))a="The ".concat(e," ").concat(s," ").concat(_n(t,"type"));else{var l=ts(e,".")?"property":"argument";a='The "'.concat(e,'" ').concat(l," ").concat(s," ").concat(_n(t,"type"))}return a+=". Received type ".concat(typeof n),a},TypeError);Ae("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");Ae("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"});Ae("ERR_STREAM_PREMATURE_CLOSE","Premature close");Ae("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"});Ae("ERR_MULTIPLE_CALLBACK","Callback called multiple times");Ae("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");Ae("ERR_STREAM_WRITE_AFTER_END","write after end");Ae("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);Ae("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError);Ae("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");We.codes=wr;var ns=We.codes.ERR_INVALID_OPT_VALUE;function rs(e,t,n){return e.highWaterMark!=null?e.highWaterMark:t?e[n]:null}function is(e,t,n,s){var a=rs(t,s,n);if(a!=null){if(!(isFinite(a)&&Math.floor(a)===a)||a<0){var l=s?n:"highWaterMark";throw new ns(l,a)}return Math.floor(a)}return e.objectMode?16:16*1024}var br={getHighWaterMark:is},en={exports:{}};typeof Object.create=="function"?en.exports=function(t,n){n&&(t.super_=n,t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:en.exports=function(t,n){if(n){t.super_=n;var s=function(){};s.prototype=n.prototype,t.prototype=new s,t.prototype.constructor=t}};var it=en.exports,ss=os;function os(e,t){if(kt("noDeprecation"))return e;var n=!1;function s(){if(!n){if(kt("throwDeprecation"))throw new Error(t);kt("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}return s}function kt(e){try{if(!De.localStorage)return!1}catch{return!1}var t=De.localStorage[e];return t==null?!1:String(t).toLowerCase()==="true"}var Ot,En;function xr(){if(En)return Ot;En=1,Ot=M;function e(T){var R=this;this.next=null,this.entry=null,this.finish=function(){oe(R,T)}}var t;M.WritableState=z;var n={deprecate:ss},s=gr,a=Xe.Buffer,l=(typeof De<"u"?De:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function c(T){return a.from(T)}function u(T){return a.isBuffer(T)||T instanceof l}var b=yr,h=br,f=h.getHighWaterMark,w=We.codes,E=w.ERR_INVALID_ARG_TYPE,I=w.ERR_METHOD_NOT_IMPLEMENTED,x=w.ERR_MULTIPLE_CALLBACK,C=w.ERR_STREAM_CANNOT_PIPE,_=w.ERR_STREAM_DESTROYED,m=w.ERR_STREAM_NULL_VALUES,k=w.ERR_STREAM_WRITE_AFTER_END,j=w.ERR_UNKNOWN_ENCODING,N=b.errorOrDestroy;it(M,s);function B(){}function z(T,R,L){t=t||Ke(),T=T||{},typeof L!="boolean"&&(L=R instanceof t),this.objectMode=!!T.objectMode,L&&(this.objectMode=this.objectMode||!!T.writableObjectMode),this.highWaterMark=f(this,T,"writableHighWaterMark",L),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var V=T.decodeStrings===!1;this.decodeStrings=!V,this.defaultEncoding=T.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(Z){ce(R,Z)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=T.emitClose!==!1,this.autoDestroy=!!T.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new e(this)}z.prototype.getBuffer=function(){for(var R=this.bufferedRequest,L=[];R;)L.push(R),R=R.next;return L},function(){try{Object.defineProperty(z.prototype,"buffer",{get:n.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var W;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(W=Function.prototype[Symbol.hasInstance],Object.defineProperty(M,Symbol.hasInstance,{value:function(R){return W.call(this,R)?!0:this!==M?!1:R&&R._writableState instanceof z}})):W=function(R){return R instanceof this};function M(T){t=t||Ke();var R=this instanceof t;if(!R&&!W.call(M,this))return new M(T);this._writableState=new z(T,this,R),this.writable=!0,T&&(typeof T.write=="function"&&(this._write=T.write),typeof T.writev=="function"&&(this._writev=T.writev),typeof T.destroy=="function"&&(this._destroy=T.destroy),typeof T.final=="function"&&(this._final=T.final)),s.call(this)}M.prototype.pipe=function(){N(this,new C)};function F(T,R){var L=new k;N(T,L),process.nextTick(R,L)}function G(T,R,L,V){var Z;return L===null?Z=new m:typeof L!="string"&&!R.objectMode&&(Z=new E("chunk",["string","Buffer"],L)),Z?(N(T,Z),process.nextTick(V,Z),!1):!0}M.prototype.write=function(T,R,L){var V=this._writableState,Z=!1,y=!V.objectMode&&u(T);return y&&!a.isBuffer(T)&&(T=c(T)),typeof R=="function"&&(L=R,R=null),y?R="buffer":R||(R=V.defaultEncoding),typeof L!="function"&&(L=B),V.ending?F(this,L):(y||G(this,V,T,L))&&(V.pendingcb++,Z=$(this,V,y,T,R,L)),Z},M.prototype.cork=function(){this._writableState.corked++},M.prototype.uncork=function(){var T=this._writableState;T.corked&&(T.corked--,!T.writing&&!T.corked&&!T.bufferProcessing&&T.bufferedRequest&&fe(this,T))},M.prototype.setDefaultEncoding=function(R){if(typeof R=="string"&&(R=R.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((R+"").toLowerCase())>-1))throw new j(R);return this._writableState.defaultEncoding=R,this},Object.defineProperty(M.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function ie(T,R,L){return!T.objectMode&&T.decodeStrings!==!1&&typeof R=="string"&&(R=a.from(R,L)),R}Object.defineProperty(M.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function $(T,R,L,V,Z,y){if(!L){var g=ie(R,V,Z);V!==g&&(L=!0,Z="buffer",V=g)}var q=R.objectMode?1:V.length;R.length+=q;var P=R.length<R.highWaterMark;if(P||(R.needDrain=!0),R.writing||R.corked){var Q=R.lastBufferedRequest;R.lastBufferedRequest={chunk:V,encoding:Z,isBuf:L,callback:y,next:null},Q?Q.next=R.lastBufferedRequest:R.bufferedRequest=R.lastBufferedRequest,R.bufferedRequestCount+=1}else J(T,R,!1,q,V,Z,y);return P}function J(T,R,L,V,Z,y,g){R.writelen=V,R.writecb=g,R.writing=!0,R.sync=!0,R.destroyed?R.onwrite(new _("write")):L?T._writev(Z,R.onwrite):T._write(Z,y,R.onwrite),R.sync=!1}function X(T,R,L,V,Z){--R.pendingcb,L?(process.nextTick(Z,V),process.nextTick(H,T,R),T._writableState.errorEmitted=!0,N(T,V)):(Z(V),T._writableState.errorEmitted=!0,N(T,V),H(T,R))}function ne(T){T.writing=!1,T.writecb=null,T.length-=T.writelen,T.writelen=0}function ce(T,R){var L=T._writableState,V=L.sync,Z=L.writecb;if(typeof Z!="function")throw new x;if(ne(L),R)X(T,L,V,R,Z);else{var y=de(L)||T.destroyed;!y&&!L.corked&&!L.bufferProcessing&&L.bufferedRequest&&fe(T,L),V?process.nextTick(ue,T,L,y,Z):ue(T,L,y,Z)}}function ue(T,R,L,V){L||Y(T,R),R.pendingcb--,V(),H(T,R)}function Y(T,R){R.length===0&&R.needDrain&&(R.needDrain=!1,T.emit("drain"))}function fe(T,R){R.bufferProcessing=!0;var L=R.bufferedRequest;if(T._writev&&L&&L.next){var V=R.bufferedRequestCount,Z=new Array(V),y=R.corkedRequestsFree;y.entry=L;for(var g=0,q=!0;L;)Z[g]=L,L.isBuf||(q=!1),L=L.next,g+=1;Z.allBuffers=q,J(T,R,!0,R.length,Z,"",y.finish),R.pendingcb++,R.lastBufferedRequest=null,y.next?(R.corkedRequestsFree=y.next,y.next=null):R.corkedRequestsFree=new e(R),R.bufferedRequestCount=0}else{for(;L;){var P=L.chunk,Q=L.encoding,K=L.callback,re=R.objectMode?1:P.length;if(J(T,R,!1,re,P,Q,K),L=L.next,R.bufferedRequestCount--,R.writing)break}L===null&&(R.lastBufferedRequest=null)}R.bufferedRequest=L,R.bufferProcessing=!1}M.prototype._write=function(T,R,L){L(new I("_write()"))},M.prototype._writev=null,M.prototype.end=function(T,R,L){var V=this._writableState;return typeof T=="function"?(L=T,T=null,R=null):typeof R=="function"&&(L=R,R=null),T!=null&&this.write(T,R),V.corked&&(V.corked=1,this.uncork()),V.ending||te(this,V,L),this},Object.defineProperty(M.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function de(T){return T.ending&&T.length===0&&T.bufferedRequest===null&&!T.finished&&!T.writing}function ee(T,R){T._final(function(L){R.pendingcb--,L&&N(T,L),R.prefinished=!0,T.emit("prefinish"),H(T,R)})}function D(T,R){!R.prefinished&&!R.finalCalled&&(typeof T._final=="function"&&!R.destroyed?(R.pendingcb++,R.finalCalled=!0,process.nextTick(ee,T,R)):(R.prefinished=!0,T.emit("prefinish")))}function H(T,R){var L=de(R);if(L&&(D(T,R),R.pendingcb===0&&(R.finished=!0,T.emit("finish"),R.autoDestroy))){var V=T._readableState;(!V||V.autoDestroy&&V.endEmitted)&&T.destroy()}return L}function te(T,R,L){R.ending=!0,H(T,R),L&&(R.finished?process.nextTick(L):T.once("finish",L)),R.ended=!0,T.writable=!1}function oe(T,R,L){var V=T.entry;for(T.entry=null;V;){var Z=V.callback;R.pendingcb--,Z(L),V=V.next}R.corkedRequestsFree.next=T}return Object.defineProperty(M.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(R){this._writableState&&(this._writableState.destroyed=R)}}),M.prototype.destroy=b.destroy,M.prototype._undestroy=b.undestroy,M.prototype._destroy=function(T,R){R(T)},Ot}var Bt,vn;function Ke(){if(vn)return Bt;vn=1;var e=Object.keys||function(h){var f=[];for(var w in h)f.push(w);return f};Bt=c;var t=Er(),n=xr();it(c,t);for(var s=e(n.prototype),a=0;a<s.length;a++){var l=s[a];c.prototype[l]||(c.prototype[l]=n.prototype[l])}function c(h){if(!(this instanceof c))return new c(h);t.call(this,h),n.call(this,h),this.allowHalfOpen=!0,h&&(h.readable===!1&&(this.readable=!1),h.writable===!1&&(this.writable=!1),h.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",u)))}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function u(){this._writableState.ended||process.nextTick(b,this)}function b(h){h.end()}return Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(f){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=f,this._writableState.destroyed=f)}}),Bt}var Ft={},Rn;function Cn(){if(Rn)return Ft;Rn=1;var e=mr.Buffer,t=e.isEncoding||function(m){switch(m=""+m,m&&m.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function n(m){if(!m)return"utf8";for(var k;;)switch(m){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return m;default:if(k)return;m=(""+m).toLowerCase(),k=!0}}function s(m){var k=n(m);if(typeof k!="string"&&(e.isEncoding===t||!t(m)))throw new Error("Unknown encoding: "+m);return k||m}Ft.StringDecoder=a;function a(m){this.encoding=s(m);var k;switch(this.encoding){case"utf16le":this.text=w,this.end=E,k=4;break;case"utf8":this.fillLast=b,k=4;break;case"base64":this.text=I,this.end=x,k=3;break;default:this.write=C,this.end=_;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=e.allocUnsafe(k)}a.prototype.write=function(m){if(m.length===0)return"";var k,j;if(this.lastNeed){if(k=this.fillLast(m),k===void 0)return"";j=this.lastNeed,this.lastNeed=0}else j=0;return j<m.length?k?k+this.text(m,j):this.text(m,j):k||""},a.prototype.end=f,a.prototype.text=h,a.prototype.fillLast=function(m){if(this.lastNeed<=m.length)return m.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);m.copy(this.lastChar,this.lastTotal-this.lastNeed,0,m.length),this.lastNeed-=m.length};function l(m){return m<=127?0:m>>5===6?2:m>>4===14?3:m>>3===30?4:m>>6===2?-1:-2}function c(m,k,j){var N=k.length-1;if(N<j)return 0;var B=l(k[N]);return B>=0?(B>0&&(m.lastNeed=B-1),B):--N<j||B===-2?0:(B=l(k[N]),B>=0?(B>0&&(m.lastNeed=B-2),B):--N<j||B===-2?0:(B=l(k[N]),B>=0?(B>0&&(B===2?B=0:m.lastNeed=B-3),B):0))}function u(m,k,j){if((k[0]&192)!==128)return m.lastNeed=0,"ï¿½";if(m.lastNeed>1&&k.length>1){if((k[1]&192)!==128)return m.lastNeed=1,"ï¿½";if(m.lastNeed>2&&k.length>2&&(k[2]&192)!==128)return m.lastNeed=2,"ï¿½"}}function b(m){var k=this.lastTotal-this.lastNeed,j=u(this,m);if(j!==void 0)return j;if(this.lastNeed<=m.length)return m.copy(this.lastChar,k,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);m.copy(this.lastChar,k,0,m.length),this.lastNeed-=m.length}function h(m,k){var j=c(this,m,k);if(!this.lastNeed)return m.toString("utf8",k);this.lastTotal=j;var N=m.length-(j-this.lastNeed);return m.copy(this.lastChar,0,N),m.toString("utf8",k,N)}function f(m){var k=m&&m.length?this.write(m):"";return this.lastNeed?k+"ï¿½":k}function w(m,k){if((m.length-k)%2===0){var j=m.toString("utf16le",k);if(j){var N=j.charCodeAt(j.length-1);if(N>=55296&&N<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=m[m.length-2],this.lastChar[1]=m[m.length-1],j.slice(0,-1)}return j}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=m[m.length-1],m.toString("utf16le",k,m.length-1)}function E(m){var k=m&&m.length?this.write(m):"";if(this.lastNeed){var j=this.lastTotal-this.lastNeed;return k+this.lastChar.toString("utf16le",0,j)}return k}function I(m,k){var j=(m.length-k)%3;return j===0?m.toString("base64",k):(this.lastNeed=3-j,this.lastTotal=3,j===1?this.lastChar[0]=m[m.length-1]:(this.lastChar[0]=m[m.length-2],this.lastChar[1]=m[m.length-1]),m.toString("base64",k,m.length-j))}function x(m){var k=m&&m.length?this.write(m):"";return this.lastNeed?k+this.lastChar.toString("base64",0,3-this.lastNeed):k}function C(m){return m.toString(this.encoding)}function _(m){return m&&m.length?this.write(m):""}return Ft}var Sn=We.codes.ERR_STREAM_PREMATURE_CLOSE;function as(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];e.apply(this,s)}}}function ls(){}function cs(e){return e.setHeader&&typeof e.abort=="function"}function _r(e,t,n){if(typeof t=="function")return _r(e,null,t);t||(t={}),n=as(n||ls);var s=t.readable||t.readable!==!1&&e.readable,a=t.writable||t.writable!==!1&&e.writable,l=function(){e.writable||u()},c=e._writableState&&e._writableState.finished,u=function(){a=!1,c=!0,s||n.call(e)},b=e._readableState&&e._readableState.endEmitted,h=function(){s=!1,b=!0,a||n.call(e)},f=function(x){n.call(e,x)},w=function(){var x;if(s&&!b)return(!e._readableState||!e._readableState.ended)&&(x=new Sn),n.call(e,x);if(a&&!c)return(!e._writableState||!e._writableState.ended)&&(x=new Sn),n.call(e,x)},E=function(){e.req.on("finish",u)};return cs(e)?(e.on("complete",u),e.on("abort",w),e.req?E():e.on("request",E)):a&&!e._writableState&&(e.on("end",l),e.on("close",l)),e.on("end",h),e.on("finish",u),t.error!==!1&&e.on("error",f),e.on("close",w),function(){e.removeListener("complete",u),e.removeListener("abort",w),e.removeListener("request",E),e.req&&e.req.removeListener("finish",u),e.removeListener("end",l),e.removeListener("close",l),e.removeListener("finish",u),e.removeListener("end",h),e.removeListener("error",f),e.removeListener("close",w)}}var dn=_r,Pt,Nn;function us(){if(Nn)return Pt;Nn=1;var e;function t(j,N,B){return N=n(N),N in j?Object.defineProperty(j,N,{value:B,enumerable:!0,configurable:!0,writable:!0}):j[N]=B,j}function n(j){var N=s(j,"string");return typeof N=="symbol"?N:String(N)}function s(j,N){if(typeof j!="object"||j===null)return j;var B=j[Symbol.toPrimitive];if(B!==void 0){var z=B.call(j,N);if(typeof z!="object")return z;throw new TypeError("@@toPrimitive must return a primitive value.")}return(N==="string"?String:Number)(j)}var a=dn,l=Symbol("lastResolve"),c=Symbol("lastReject"),u=Symbol("error"),b=Symbol("ended"),h=Symbol("lastPromise"),f=Symbol("handlePromise"),w=Symbol("stream");function E(j,N){return{value:j,done:N}}function I(j){var N=j[l];if(N!==null){var B=j[w].read();B!==null&&(j[h]=null,j[l]=null,j[c]=null,N(E(B,!1)))}}function x(j){process.nextTick(I,j)}function C(j,N){return function(B,z){j.then(function(){if(N[b]){B(E(void 0,!0));return}N[f](B,z)},z)}}var _=Object.getPrototypeOf(function(){}),m=Object.setPrototypeOf((e={get stream(){return this[w]},next:function(){var N=this,B=this[u];if(B!==null)return Promise.reject(B);if(this[b])return Promise.resolve(E(void 0,!0));if(this[w].destroyed)return new Promise(function(F,G){process.nextTick(function(){N[u]?G(N[u]):F(E(void 0,!0))})});var z=this[h],W;if(z)W=new Promise(C(z,this));else{var M=this[w].read();if(M!==null)return Promise.resolve(E(M,!1));W=new Promise(this[f])}return this[h]=W,W}},t(e,Symbol.asyncIterator,function(){return this}),t(e,"return",function(){var N=this;return new Promise(function(B,z){N[w].destroy(null,function(W){if(W){z(W);return}B(E(void 0,!0))})})}),e),_),k=function(N){var B,z=Object.create(m,(B={},t(B,w,{value:N,writable:!0}),t(B,l,{value:null,writable:!0}),t(B,c,{value:null,writable:!0}),t(B,u,{value:null,writable:!0}),t(B,b,{value:N._readableState.endEmitted,writable:!0}),t(B,f,{value:function(M,F){var G=z[w].read();G?(z[h]=null,z[l]=null,z[c]=null,M(E(G,!1))):(z[l]=M,z[c]=F)},writable:!0}),B));return z[h]=null,a(N,function(W){if(W&&W.code!=="ERR_STREAM_PREMATURE_CLOSE"){var M=z[c];M!==null&&(z[h]=null,z[l]=null,z[c]=null,M(W)),z[u]=W;return}var F=z[l];F!==null&&(z[h]=null,z[l]=null,z[c]=null,F(E(void 0,!0))),z[b]=!0}),N.on("readable",x.bind(null,z)),z};return Pt=k,Pt}var Dt,jn;function ds(){return jn||(jn=1,Dt=function(){throw new Error("Readable.from is not available in the browser")}),Dt}var Lt,Tn;function Er(){if(Tn)return Lt;Tn=1,Lt=F;var e;F.ReadableState=M,gt.EventEmitter;var t=function(g,q){return g.listeners(q).length},n=gr,s=Xe.Buffer,a=(typeof De<"u"?De:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function l(y){return s.from(y)}function c(y){return s.isBuffer(y)||y instanceof a}var u=gt,b;u&&u.debuglog?b=u.debuglog("stream"):b=function(){};var h=Gi(),f=yr,w=br,E=w.getHighWaterMark,I=We.codes,x=I.ERR_INVALID_ARG_TYPE,C=I.ERR_STREAM_PUSH_AFTER_EOF,_=I.ERR_METHOD_NOT_IMPLEMENTED,m=I.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,k,j,N;it(F,n);var B=f.errorOrDestroy,z=["error","close","destroy","pause","resume"];function W(y,g,q){if(typeof y.prependListener=="function")return y.prependListener(g,q);!y._events||!y._events[g]?y.on(g,q):Array.isArray(y._events[g])?y._events[g].unshift(q):y._events[g]=[q,y._events[g]]}function M(y,g,q){e=e||Ke(),y=y||{},typeof q!="boolean"&&(q=g instanceof e),this.objectMode=!!y.objectMode,q&&(this.objectMode=this.objectMode||!!y.readableObjectMode),this.highWaterMark=E(this,y,"readableHighWaterMark",q),this.buffer=new h,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=y.emitClose!==!1,this.autoDestroy=!!y.autoDestroy,this.destroyed=!1,this.defaultEncoding=y.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,y.encoding&&(k||(k=Cn().StringDecoder),this.decoder=new k(y.encoding),this.encoding=y.encoding)}function F(y){if(e=e||Ke(),!(this instanceof F))return new F(y);var g=this instanceof e;this._readableState=new M(y,this,g),this.readable=!0,y&&(typeof y.read=="function"&&(this._read=y.read),typeof y.destroy=="function"&&(this._destroy=y.destroy)),n.call(this)}Object.defineProperty(F.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(g){this._readableState&&(this._readableState.destroyed=g)}}),F.prototype.destroy=f.destroy,F.prototype._undestroy=f.undestroy,F.prototype._destroy=function(y,g){g(y)},F.prototype.push=function(y,g){var q=this._readableState,P;return q.objectMode?P=!0:typeof y=="string"&&(g=g||q.defaultEncoding,g!==q.encoding&&(y=s.from(y,g),g=""),P=!0),G(this,y,g,!1,P)},F.prototype.unshift=function(y){return G(this,y,null,!0,!1)};function G(y,g,q,P,Q){b("readableAddChunk",g);var K=y._readableState;if(g===null)K.reading=!1,ce(y,K);else{var re;if(Q||(re=$(K,g)),re)B(y,re);else if(K.objectMode||g&&g.length>0)if(typeof g!="string"&&!K.objectMode&&Object.getPrototypeOf(g)!==s.prototype&&(g=l(g)),P)K.endEmitted?B(y,new m):ie(y,K,g,!0);else if(K.ended)B(y,new C);else{if(K.destroyed)return!1;K.reading=!1,K.decoder&&!q?(g=K.decoder.write(g),K.objectMode||g.length!==0?ie(y,K,g,!1):fe(y,K)):ie(y,K,g,!1)}else P||(K.reading=!1,fe(y,K))}return!K.ended&&(K.length<K.highWaterMark||K.length===0)}function ie(y,g,q,P){g.flowing&&g.length===0&&!g.sync?(g.awaitDrain=0,y.emit("data",q)):(g.length+=g.objectMode?1:q.length,P?g.buffer.unshift(q):g.buffer.push(q),g.needReadable&&ue(y)),fe(y,g)}function $(y,g){var q;return!c(g)&&typeof g!="string"&&g!==void 0&&!y.objectMode&&(q=new x("chunk",["string","Buffer","Uint8Array"],g)),q}F.prototype.isPaused=function(){return this._readableState.flowing===!1},F.prototype.setEncoding=function(y){k||(k=Cn().StringDecoder);var g=new k(y);this._readableState.decoder=g,this._readableState.encoding=this._readableState.decoder.encoding;for(var q=this._readableState.buffer.head,P="";q!==null;)P+=g.write(q.data),q=q.next;return this._readableState.buffer.clear(),P!==""&&this._readableState.buffer.push(P),this._readableState.length=P.length,this};var J=1073741824;function X(y){return y>=J?y=J:(y--,y|=y>>>1,y|=y>>>2,y|=y>>>4,y|=y>>>8,y|=y>>>16,y++),y}function ne(y,g){return y<=0||g.length===0&&g.ended?0:g.objectMode?1:y!==y?g.flowing&&g.length?g.buffer.head.data.length:g.length:(y>g.highWaterMark&&(g.highWaterMark=X(y)),y<=g.length?y:g.ended?g.length:(g.needReadable=!0,0))}F.prototype.read=function(y){b("read",y),y=parseInt(y,10);var g=this._readableState,q=y;if(y!==0&&(g.emittedReadable=!1),y===0&&g.needReadable&&((g.highWaterMark!==0?g.length>=g.highWaterMark:g.length>0)||g.ended))return b("read: emitReadable",g.length,g.ended),g.length===0&&g.ended?L(this):ue(this),null;if(y=ne(y,g),y===0&&g.ended)return g.length===0&&L(this),null;var P=g.needReadable;b("need readable",P),(g.length===0||g.length-y<g.highWaterMark)&&(P=!0,b("length less than watermark",P)),g.ended||g.reading?(P=!1,b("reading or ended",P)):P&&(b("do read"),g.reading=!0,g.sync=!0,g.length===0&&(g.needReadable=!0),this._read(g.highWaterMark),g.sync=!1,g.reading||(y=ne(q,g)));var Q;return y>0?Q=R(y,g):Q=null,Q===null?(g.needReadable=g.length<=g.highWaterMark,y=0):(g.length-=y,g.awaitDrain=0),g.length===0&&(g.ended||(g.needReadable=!0),q!==y&&g.ended&&L(this)),Q!==null&&this.emit("data",Q),Q};function ce(y,g){if(b("onEofChunk"),!g.ended){if(g.decoder){var q=g.decoder.end();q&&q.length&&(g.buffer.push(q),g.length+=g.objectMode?1:q.length)}g.ended=!0,g.sync?ue(y):(g.needReadable=!1,g.emittedReadable||(g.emittedReadable=!0,Y(y)))}}function ue(y){var g=y._readableState;b("emitReadable",g.needReadable,g.emittedReadable),g.needReadable=!1,g.emittedReadable||(b("emitReadable",g.flowing),g.emittedReadable=!0,process.nextTick(Y,y))}function Y(y){var g=y._readableState;b("emitReadable_",g.destroyed,g.length,g.ended),!g.destroyed&&(g.length||g.ended)&&(y.emit("readable"),g.emittedReadable=!1),g.needReadable=!g.flowing&&!g.ended&&g.length<=g.highWaterMark,T(y)}function fe(y,g){g.readingMore||(g.readingMore=!0,process.nextTick(de,y,g))}function de(y,g){for(;!g.reading&&!g.ended&&(g.length<g.highWaterMark||g.flowing&&g.length===0);){var q=g.length;if(b("maybeReadMore read 0"),y.read(0),q===g.length)break}g.readingMore=!1}F.prototype._read=function(y){B(this,new _("_read()"))},F.prototype.pipe=function(y,g){var q=this,P=this._readableState;switch(P.pipesCount){case 0:P.pipes=y;break;case 1:P.pipes=[P.pipes,y];break;default:P.pipes.push(y);break}P.pipesCount+=1,b("pipe count=%d opts=%j",P.pipesCount,g);var Q=(!g||g.end!==!1)&&y!==process.stdout&&y!==process.stderr,K=Q?be:Ce;P.endEmitted?process.nextTick(K):q.once("end",K),y.on("unpipe",re);function re(d,r){b("onunpipe"),d===q&&r&&r.hasUnpiped===!1&&(r.hasUnpiped=!0,xe())}function be(){b("onend"),y.end()}var _e=ee(q);y.on("drain",_e);var Re=!1;function xe(){b("cleanup"),y.removeListener("close",Ie),y.removeListener("finish",Ee),y.removeListener("drain",_e),y.removeListener("error",je),y.removeListener("unpipe",re),q.removeListener("end",be),q.removeListener("end",Ce),q.removeListener("data",pe),Re=!0,P.awaitDrain&&(!y._writableState||y._writableState.needDrain)&&_e()}q.on("data",pe);function pe(d){b("ondata");var r=y.write(d);b("dest.write",r),r===!1&&((P.pipesCount===1&&P.pipes===y||P.pipesCount>1&&Z(P.pipes,y)!==-1)&&!Re&&(b("false write response, pause",P.awaitDrain),P.awaitDrain++),q.pause())}function je(d){b("onerror",d),Ce(),y.removeListener("error",je),t(y,"error")===0&&B(y,d)}W(y,"error",je);function Ie(){y.removeListener("finish",Ee),Ce()}y.once("close",Ie);function Ee(){b("onfinish"),y.removeListener("close",Ie),Ce()}y.once("finish",Ee);function Ce(){b("unpipe"),q.unpipe(y)}return y.emit("pipe",q),P.flowing||(b("pipe resume"),q.resume()),y};function ee(y){return function(){var q=y._readableState;b("pipeOnDrain",q.awaitDrain),q.awaitDrain&&q.awaitDrain--,q.awaitDrain===0&&t(y,"data")&&(q.flowing=!0,T(y))}}F.prototype.unpipe=function(y){var g=this._readableState,q={hasUnpiped:!1};if(g.pipesCount===0)return this;if(g.pipesCount===1)return y&&y!==g.pipes?this:(y||(y=g.pipes),g.pipes=null,g.pipesCount=0,g.flowing=!1,y&&y.emit("unpipe",this,q),this);if(!y){var P=g.pipes,Q=g.pipesCount;g.pipes=null,g.pipesCount=0,g.flowing=!1;for(var K=0;K<Q;K++)P[K].emit("unpipe",this,{hasUnpiped:!1});return this}var re=Z(g.pipes,y);return re===-1?this:(g.pipes.splice(re,1),g.pipesCount-=1,g.pipesCount===1&&(g.pipes=g.pipes[0]),y.emit("unpipe",this,q),this)},F.prototype.on=function(y,g){var q=n.prototype.on.call(this,y,g),P=this._readableState;return y==="data"?(P.readableListening=this.listenerCount("readable")>0,P.flowing!==!1&&this.resume()):y==="readable"&&!P.endEmitted&&!P.readableListening&&(P.readableListening=P.needReadable=!0,P.flowing=!1,P.emittedReadable=!1,b("on readable",P.length,P.reading),P.length?ue(this):P.reading||process.nextTick(H,this)),q},F.prototype.addListener=F.prototype.on,F.prototype.removeListener=function(y,g){var q=n.prototype.removeListener.call(this,y,g);return y==="readable"&&process.nextTick(D,this),q},F.prototype.removeAllListeners=function(y){var g=n.prototype.removeAllListeners.apply(this,arguments);return(y==="readable"||y===void 0)&&process.nextTick(D,this),g};function D(y){var g=y._readableState;g.readableListening=y.listenerCount("readable")>0,g.resumeScheduled&&!g.paused?g.flowing=!0:y.listenerCount("data")>0&&y.resume()}function H(y){b("readable nexttick read 0"),y.read(0)}F.prototype.resume=function(){var y=this._readableState;return y.flowing||(b("resume"),y.flowing=!y.readableListening,te(this,y)),y.paused=!1,this};function te(y,g){g.resumeScheduled||(g.resumeScheduled=!0,process.nextTick(oe,y,g))}function oe(y,g){b("resume",g.reading),g.reading||y.read(0),g.resumeScheduled=!1,y.emit("resume"),T(y),g.flowing&&!g.reading&&y.read(0)}F.prototype.pause=function(){return b("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(b("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function T(y){var g=y._readableState;for(b("flow",g.flowing);g.flowing&&y.read()!==null;);}F.prototype.wrap=function(y){var g=this,q=this._readableState,P=!1;y.on("end",function(){if(b("wrapped end"),q.decoder&&!q.ended){var re=q.decoder.end();re&&re.length&&g.push(re)}g.push(null)}),y.on("data",function(re){if(b("wrapped data"),q.decoder&&(re=q.decoder.write(re)),!(q.objectMode&&re==null)&&!(!q.objectMode&&(!re||!re.length))){var be=g.push(re);be||(P=!0,y.pause())}});for(var Q in y)this[Q]===void 0&&typeof y[Q]=="function"&&(this[Q]=function(be){return function(){return y[be].apply(y,arguments)}}(Q));for(var K=0;K<z.length;K++)y.on(z[K],this.emit.bind(this,z[K]));return this._read=function(re){b("wrapped _read",re),P&&(P=!1,y.resume())},this},typeof Symbol=="function"&&(F.prototype[Symbol.asyncIterator]=function(){return j===void 0&&(j=us()),j(this)}),Object.defineProperty(F.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(F.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(F.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(g){this._readableState&&(this._readableState.flowing=g)}}),F._fromList=R,Object.defineProperty(F.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function R(y,g){if(g.length===0)return null;var q;return g.objectMode?q=g.buffer.shift():!y||y>=g.length?(g.decoder?q=g.buffer.join(""):g.buffer.length===1?q=g.buffer.first():q=g.buffer.concat(g.length),g.buffer.clear()):q=g.buffer.consume(y,g.decoder),q}function L(y){var g=y._readableState;b("endReadable",g.endEmitted),g.endEmitted||(g.ended=!0,process.nextTick(V,g,y))}function V(y,g){if(b("endReadableNT",y.endEmitted,y.length),!y.endEmitted&&y.length===0&&(y.endEmitted=!0,g.readable=!1,g.emit("end"),y.autoDestroy)){var q=g._writableState;(!q||q.autoDestroy&&q.finished)&&g.destroy()}}typeof Symbol=="function"&&(F.from=function(y,g){return N===void 0&&(N=ds()),N(F,y,g)});function Z(y,g){for(var q=0,P=y.length;q<P;q++)if(y[q]===g)return q;return-1}return Lt}var vr=Le,bt=We.codes,fs=bt.ERR_METHOD_NOT_IMPLEMENTED,hs=bt.ERR_MULTIPLE_CALLBACK,ps=bt.ERR_TRANSFORM_ALREADY_TRANSFORMING,ms=bt.ERR_TRANSFORM_WITH_LENGTH_0,xt=Ke();it(Le,xt);function gs(e,t){var n=this._transformState;n.transforming=!1;var s=n.writecb;if(s===null)return this.emit("error",new hs);n.writechunk=null,n.writecb=null,t!=null&&this.push(t),s(e);var a=this._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}function Le(e){if(!(this instanceof Le))return new Le(e);xt.call(this,e),this._transformState={afterTransform:gs.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&(typeof e.transform=="function"&&(this._transform=e.transform),typeof e.flush=="function"&&(this._flush=e.flush)),this.on("prefinish",ys)}function ys(){var e=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(t,n){An(e,t,n)}):An(this,null,null)}Le.prototype.push=function(e,t){return this._transformState.needTransform=!1,xt.prototype.push.call(this,e,t)};Le.prototype._transform=function(e,t,n){n(new fs("_transform()"))};Le.prototype._write=function(e,t,n){var s=this._transformState;if(s.writecb=n,s.writechunk=e,s.writeencoding=t,!s.transforming){var a=this._readableState;(s.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}};Le.prototype._read=function(e){var t=this._transformState;t.writechunk!==null&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0};Le.prototype._destroy=function(e,t){xt.prototype._destroy.call(this,e,function(n){t(n)})};function An(e,t,n){if(t)return e.emit("error",t);if(n!=null&&e.push(n),e._writableState.length)throw new ms;if(e._transformState.transforming)throw new ps;return e.push(null)}var ws=rt,Rr=vr;it(rt,Rr);function rt(e){if(!(this instanceof rt))return new rt(e);Rr.call(this,e)}rt.prototype._transform=function(e,t,n){n(null,e)};var Mt;function bs(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}var Cr=We.codes,xs=Cr.ERR_MISSING_ARGS,_s=Cr.ERR_STREAM_DESTROYED;function In(e){if(e)throw e}function Es(e){return e.setHeader&&typeof e.abort=="function"}function vs(e,t,n,s){s=bs(s);var a=!1;e.on("close",function(){a=!0}),Mt===void 0&&(Mt=dn),Mt(e,{readable:t,writable:n},function(c){if(c)return s(c);a=!0,s()});var l=!1;return function(c){if(!a&&!l){if(l=!0,Es(e))return e.abort();if(typeof e.destroy=="function")return e.destroy();s(c||new _s("pipe"))}}}function kn(e){e()}function Rs(e,t){return e.pipe(t)}function Cs(e){return!e.length||typeof e[e.length-1]!="function"?In:e.pop()}function Ss(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var s=Cs(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new xs("streams");var a,l=t.map(function(c,u){var b=u<t.length-1,h=u>0;return vs(c,b,h,function(f){a||(a=f),f&&l.forEach(kn),!b&&(l.forEach(kn),s(a))})});return t.reduce(Rs)}var Ns=Ss;(function(e,t){t=e.exports=Er(),t.Stream=t,t.Readable=t,t.Writable=xr(),t.Duplex=Ke(),t.Transform=vr,t.PassThrough=ws,t.finished=dn,t.pipeline=Ns})(Zt,Zt.exports);var js=Zt.exports;/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let On;var Ts=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:De):e=>(On||(On=Promise.resolve())).then(e).catch(t=>setTimeout(()=>{throw t},0));function Bn(e,t){for(const n in t)Object.defineProperty(e,n,{value:t[n],enumerable:!0,configurable:!0});return e}function As(e,t,n){if(!e||typeof e=="string")throw new TypeError("Please pass an Error to err-code");n||(n={}),typeof t=="object"&&(n=t,t=""),t&&(n.code=t);try{return Bn(e,n)}catch{n.message=e.message,n.stack=e.stack;const a=function(){};return a.prototype=Object.create(Object.getPrototypeOf(e)),Bn(new a,n)}}var Is=As;/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const ks=Ii("simple-peer"),Sr=ki,Fn=Wi,Os=js,Ut=Ts,le=Is,{Buffer:Bs}=Xe,qt=64*1024,Fs=5*1e3,Ps=5*1e3;function Pn(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}function Ds(e){console.warn(e)}class $e extends Os.Duplex{constructor(t){if(t=Object.assign({allowHalfOpen:!1},t),super(t),this._id=Fn(4).toString("hex").slice(0,7),this._debug("new peer %o",t),this.channelName=t.initiator?t.channelName||Fn(20).toString("hex"):null,this.initiator=t.initiator||!1,this.channelConfig=t.channelConfig||$e.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},$e.config,t.config),this.offerOptions=t.offerOptions||{},this.answerOptions=t.answerOptions||{},this.sdpTransform=t.sdpTransform||(n=>n),this.streams=t.streams||(t.stream?[t.stream]:[]),this.trickle=t.trickle!==void 0?t.trickle:!0,this.allowHalfTrickle=t.allowHalfTrickle!==void 0?t.allowHalfTrickle:!1,this.iceCompleteTimeout=t.iceCompleteTimeout||Fs,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=t.wrtc&&typeof t.wrtc=="object"?t.wrtc:Sr(),!this._wrtc)throw le(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(n){this.destroy(le(n,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=n=>{this._onIceCandidate(n)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(n=>{this.destroy(le(n,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=n=>{this._setupData(n)},this.streams&&this.streams.forEach(n=>{this.addStream(n)}),this._pc.ontrack=n=>{this._onTrack(n)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(t){if(!this.destroying){if(this.destroyed)throw le(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof t=="string")try{t=JSON.parse(t)}catch{t={}}this._debug("signal()"),t.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),t.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(t.transceiverRequest.kind,t.transceiverRequest.init)),t.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(t.candidate):this._pendingCandidates.push(t.candidate)),t.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(t)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(n=>{this._addIceCandidate(n)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(n=>{this.destroy(le(n,"ERR_SET_REMOTE_DESCRIPTION"))}),!t.sdp&&!t.candidate&&!t.renegotiate&&!t.transceiverRequest&&this.destroy(le(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(t){const n=new this._wrtc.RTCIceCandidate(t);this._pc.addIceCandidate(n).catch(s=>{!n.address||n.address.endsWith(".local")?Ds("Ignoring unsupported ICE candidate."):this.destroy(le(s,"ERR_ADD_ICE_CANDIDATE"))})}send(t){if(!this.destroying){if(this.destroyed)throw le(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(t)}}addTransceiver(t,n){if(!this.destroying){if(this.destroyed)throw le(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(t,n),this._needsNegotiation()}catch(s){this.destroy(le(s,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:t,init:n}})}}addStream(t){if(!this.destroying){if(this.destroyed)throw le(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),t.getTracks().forEach(n=>{this.addTrack(n,t)})}}addTrack(t,n){if(this.destroying)return;if(this.destroyed)throw le(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const s=this._senderMap.get(t)||new Map;let a=s.get(n);if(!a)a=this._pc.addTrack(t,n),s.set(n,a),this._senderMap.set(t,s),this._needsNegotiation();else throw a.removed?le(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):le(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(t,n,s){if(this.destroying)return;if(this.destroyed)throw le(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const a=this._senderMap.get(t),l=a?a.get(s):null;if(!l)throw le(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");n&&this._senderMap.set(n,a),l.replaceTrack!=null?l.replaceTrack(n):this.destroy(le(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(t,n){if(this.destroying)return;if(this.destroyed)throw le(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const s=this._senderMap.get(t),a=s?s.get(n):null;if(!a)throw le(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{a.removed=!0,this._pc.removeTrack(a)}catch(l){l.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(a):this.destroy(le(l,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(t){if(!this.destroying){if(this.destroyed)throw le(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),t.getTracks().forEach(n=>{this.removeTrack(n,t)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,Ut(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw le(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(t){this._destroy(t,()=>{})}_destroy(t,n){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",t&&(t.message||t)),Ut(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",t&&(t.message||t)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,t&&this.emit("error",t),this.emit("close"),n()}))}_setupData(t){if(!t.channel)return this.destroy(le(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=t.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=qt),this.channelName=this._channel.label,this._channel.onmessage=s=>{this._onChannelMessage(s)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=s=>{const a=s.error instanceof Error?s.error:new Error(`Datachannel error: ${s.message} ${s.filename}:${s.lineno}:${s.colno}`);this.destroy(le(a,"ERR_DATA_CHANNEL"))};let n=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(n&&this._onChannelClose(),n=!0):n=!1},Ps)}_read(){}_write(t,n,s){if(this.destroyed)return s(le(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(t)}catch(a){return this.destroy(le(a,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>qt?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=s):s(null)}else this._debug("write before connect"),this._chunk=t,this._cb=s}_onFinish(){if(this.destroyed)return;const t=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?t():this.once("connect",t)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(t=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(t.sdp=Pn(t.sdp)),t.sdp=this.sdpTransform(t.sdp);const n=()=>{if(this.destroyed)return;const l=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:l.type,sdp:l.sdp})},s=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?n():this.once("_iceComplete",n))},a=l=>{this.destroy(le(l,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(t).then(s).catch(a)}).catch(t=>{this.destroy(le(t,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(t=>{!t.mid&&t.sender.track&&!t.requested&&(t.requested=!0,this.addTransceiver(t.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(t=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(t.sdp=Pn(t.sdp)),t.sdp=this.sdpTransform(t.sdp);const n=()=>{if(this.destroyed)return;const l=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:l.type,sdp:l.sdp}),this.initiator||this._requestMissingTransceivers()},s=()=>{this.destroyed||(this.trickle||this._iceComplete?n():this.once("_iceComplete",n))},a=l=>{this.destroy(le(l,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(t).then(s).catch(a)}).catch(t=>{this.destroy(le(t,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(le(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const t=this._pc.iceConnectionState,n=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",t,n),this.emit("iceStateChange",t,n),(t==="connected"||t==="completed")&&(this._pcReady=!0,this._maybeReady()),t==="failed"&&this.destroy(le(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),t==="closed"&&this.destroy(le(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(t){const n=s=>(Object.prototype.toString.call(s.values)==="[object Array]"&&s.values.forEach(a=>{Object.assign(s,a)}),s);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(s=>{const a=[];s.forEach(l=>{a.push(n(l))}),t(null,a)},s=>t(s)):this._pc.getStats.length>0?this._pc.getStats(s=>{if(this.destroyed)return;const a=[];s.result().forEach(l=>{const c={};l.names().forEach(u=>{c[u]=l.stat(u)}),c.id=l.id,c.type=l.type,c.timestamp=l.timestamp,a.push(n(c))}),t(null,a)},s=>t(s)):t(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const t=()=>{this.destroyed||this.getStats((n,s)=>{if(this.destroyed)return;n&&(s=[]);const a={},l={},c={};let u=!1;s.forEach(h=>{(h.type==="remotecandidate"||h.type==="remote-candidate")&&(a[h.id]=h),(h.type==="localcandidate"||h.type==="local-candidate")&&(l[h.id]=h),(h.type==="candidatepair"||h.type==="candidate-pair")&&(c[h.id]=h)});const b=h=>{u=!0;let f=l[h.localCandidateId];f&&(f.ip||f.address)?(this.localAddress=f.ip||f.address,this.localPort=Number(f.port)):f&&f.ipAddress?(this.localAddress=f.ipAddress,this.localPort=Number(f.portNumber)):typeof h.googLocalAddress=="string"&&(f=h.googLocalAddress.split(":"),this.localAddress=f[0],this.localPort=Number(f[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let w=a[h.remoteCandidateId];w&&(w.ip||w.address)?(this.remoteAddress=w.ip||w.address,this.remotePort=Number(w.port)):w&&w.ipAddress?(this.remoteAddress=w.ipAddress,this.remotePort=Number(w.portNumber)):typeof h.googRemoteAddress=="string"&&(w=h.googRemoteAddress.split(":"),this.remoteAddress=w[0],this.remotePort=Number(w[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(s.forEach(h=>{h.type==="transport"&&h.selectedCandidatePairId&&b(c[h.selectedCandidatePairId]),(h.type==="googCandidatePair"&&h.googActiveConnection==="true"||(h.type==="candidatepair"||h.type==="candidate-pair")&&h.selected)&&b(h)}),!u&&(!Object.keys(c).length||Object.keys(l).length)){setTimeout(t,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(f){return this.destroy(le(f,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const h=this._cb;this._cb=null,h(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};t()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>qt||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(t=>{this._pc.removeTrack(t),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(t){this.destroyed||(t.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}}):!t.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),t.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(t){if(this.destroyed)return;let n=t.data;n instanceof ArrayBuffer&&(n=Bs.from(n)),this.push(n)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const t=this._cb;this._cb=null,t(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(t){this.destroyed||t.streams.forEach(n=>{this._debug("on track"),this.emit("track",t.track,n),this._remoteTracks.push({track:t.track,stream:n}),!this._remoteStreams.some(s=>s.id===n.id)&&(this._remoteStreams.push(n),Ut(()=>{this._debug("on stream"),this.emit("stream",n)}))})}_debug(){const t=[].slice.call(arguments);t[0]="["+this._id+"] "+t[0],ks.apply(null,t)}}$e.WEBRTC_SUPPORT=!!Sr();$e.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};$e.channelConfig={};var Ls=$e;const Dn=xi(Ls),_t=S.createContext(),Nr=({children:e})=>{const[t,n]=S.useState({}),[s,a]=S.useState(!1),[l,c]=S.useState(!1),[u,b]=S.useState(),[h,f]=S.useState(""),w=S.useRef(),E=S.useRef(),I=S.useRef(),x=S.useContext(Pe),{user:C}=ke();S.useEffect(()=>(navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(j=>{b(j),w.current&&(w.current.srcObject=j)}).catch(j=>console.error("Error accessing media devices.",j)),x&&C&&(f(C.name),x.on("callUser",({from:j,name:N,signal:B})=>{n({isReceivingCall:!0,from:j,name:N,signal:B})}),x.on("callEnded",()=>{var j;(j=I.current)==null||j.destroy(),window.location.reload()})),()=>{x==null||x.off("callUser"),x==null||x.off("callEnded")}),[x,C]);const _=()=>{a(!0);const j=new Dn({initiator:!1,trickle:!1,stream:u});j.on("signal",N=>x.emit("answerCall",{signal:N,to:t.from})),j.on("stream",N=>{E.current&&(E.current.srcObject=N)}),j.signal(t.signal),I.current=j},m=j=>{const N=new Dn({initiator:!0,trickle:!1,stream:u});N.on("signal",B=>x.emit("callUser",{userToCall:j,signalData:B,from:C._id,name:h})),N.on("stream",B=>{E.current&&(E.current.srcObject=B)}),x.on("callAccepted",B=>{a(!0),N.signal(B)}),I.current=N,n({...t,from:C._id})},k=()=>{if(c(!0),a(!1),u&&u.getTracks().forEach(j=>j.stop()),I.current&&I.current.destroy(),t.from||s){const j=t.from===C._id?null:t.from;j&&x.emit("callEnded",{to:j})}n({}),window.location.reload()};return i.jsx(_t.Provider,{value:{call:t,callAccepted:s,myVideo:w,userVideo:E,stream:u,name:h,callEnded:l,callUser:m,leaveCall:k,answerCall:_},children:e})},jr=S.createContext(),Ms=({children:e})=>{const[t,n]=S.useState(()=>localStorage.getItem("app-theme")||"light");S.useEffect(()=>{document.documentElement.setAttribute("data-theme",t),document.body.setAttribute("data-theme",t),localStorage.setItem("app-theme",t),console.log(`ðŸŽ¨ Theme changed to: ${t}`)},[t]);const s=[{id:"light",label:"Light",icon:"â˜€ï¸",description:"Clean and bright"},{id:"dark",label:"Dark",icon:"ðŸŒ™",description:"Easy on the eyes"},{id:"ocean",label:"Ocean",icon:"ðŸŒŠ",description:"Cool and calm"},{id:"sunset",label:"Sunset",icon:"ðŸŒ…",description:"Warm and cozy"},{id:"forest",label:"Forest",icon:"ðŸŒ²",description:"Natural and fresh"},{id:"midnight",label:"Midnight",icon:"âœ¨",description:"Modern and sleek"}],a=l=>{n(l)};return i.jsx(jr.Provider,{value:{theme:t,changeTheme:a,themes:s},children:e})},Us=()=>{const e=S.useContext(jr);if(!e)throw new Error("useTheme must be used within ThemeProvider");return e};function Tr(e,t){return function(){return e.apply(t,arguments)}}const{toString:qs}=Object.prototype,{getPrototypeOf:fn}=Object,{iterator:Et,toStringTag:Ar}=Symbol,vt=(e=>t=>{const n=qs.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Oe=e=>(e=e.toLowerCase(),t=>vt(t)===e),Rt=e=>t=>typeof t===e,{isArray:Ze}=Array,Je=Rt("undefined");function st(e){return e!==null&&!Je(e)&&e.constructor!==null&&!Je(e.constructor)&&Se(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const Ir=Oe("ArrayBuffer");function $s(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&Ir(e.buffer),t}const zs=Rt("string"),Se=Rt("function"),kr=Rt("number"),ot=e=>e!==null&&typeof e=="object",Hs=e=>e===!0||e===!1,ft=e=>{if(vt(e)!=="object")return!1;const t=fn(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Ar in e)&&!(Et in e)},Ws=e=>{if(!ot(e)||st(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},Vs=Oe("Date"),Ys=Oe("File"),Gs=Oe("Blob"),Ks=Oe("FileList"),Js=e=>ot(e)&&Se(e.pipe),Xs=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Se(e.append)&&((t=vt(e))==="formdata"||t==="object"&&Se(e.toString)&&e.toString()==="[object FormData]"))},Zs=Oe("URLSearchParams"),[Qs,eo,to,no]=["ReadableStream","Request","Response","Headers"].map(Oe),ro=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function at(e,t,{allOwnKeys:n=!1}={}){if(e===null||typeof e>"u")return;let s,a;if(typeof e!="object"&&(e=[e]),Ze(e))for(s=0,a=e.length;s<a;s++)t.call(null,e[s],s,e);else{if(st(e))return;const l=n?Object.getOwnPropertyNames(e):Object.keys(e),c=l.length;let u;for(s=0;s<c;s++)u=l[s],t.call(null,e[u],u,e)}}function Or(e,t){if(st(e))return null;t=t.toLowerCase();const n=Object.keys(e);let s=n.length,a;for(;s-- >0;)if(a=n[s],t===a.toLowerCase())return a;return null}const Ue=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Br=e=>!Je(e)&&e!==Ue;function tn(){const{caseless:e,skipUndefined:t}=Br(this)&&this||{},n={},s=(a,l)=>{const c=e&&Or(n,l)||l;ft(n[c])&&ft(a)?n[c]=tn(n[c],a):ft(a)?n[c]=tn({},a):Ze(a)?n[c]=a.slice():(!t||!Je(a))&&(n[c]=a)};for(let a=0,l=arguments.length;a<l;a++)arguments[a]&&at(arguments[a],s);return n}const io=(e,t,n,{allOwnKeys:s}={})=>(at(t,(a,l)=>{n&&Se(a)?e[l]=Tr(a,n):e[l]=a},{allOwnKeys:s}),e),so=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),oo=(e,t,n,s)=>{e.prototype=Object.create(t.prototype,s),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},ao=(e,t,n,s)=>{let a,l,c;const u={};if(t=t||{},e==null)return t;do{for(a=Object.getOwnPropertyNames(e),l=a.length;l-- >0;)c=a[l],(!s||s(c,e,t))&&!u[c]&&(t[c]=e[c],u[c]=!0);e=n!==!1&&fn(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},lo=(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const s=e.indexOf(t,n);return s!==-1&&s===n},co=e=>{if(!e)return null;if(Ze(e))return e;let t=e.length;if(!kr(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},uo=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&fn(Uint8Array)),fo=(e,t)=>{const s=(e&&e[Et]).call(e);let a;for(;(a=s.next())&&!a.done;){const l=a.value;t.call(e,l[0],l[1])}},ho=(e,t)=>{let n;const s=[];for(;(n=e.exec(t))!==null;)s.push(n);return s},po=Oe("HTMLFormElement"),mo=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,s,a){return s.toUpperCase()+a}),Ln=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),go=Oe("RegExp"),Fr=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),s={};at(n,(a,l)=>{let c;(c=t(a,l,e))!==!1&&(s[l]=c||a)}),Object.defineProperties(e,s)},yo=e=>{Fr(e,(t,n)=>{if(Se(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const s=e[n];if(Se(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},wo=(e,t)=>{const n={},s=a=>{a.forEach(l=>{n[l]=!0})};return Ze(e)?s(e):s(String(e).split(t)),n},bo=()=>{},xo=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function _o(e){return!!(e&&Se(e.append)&&e[Ar]==="FormData"&&e[Et])}const Eo=e=>{const t=new Array(10),n=(s,a)=>{if(ot(s)){if(t.indexOf(s)>=0)return;if(st(s))return s;if(!("toJSON"in s)){t[a]=s;const l=Ze(s)?[]:{};return at(s,(c,u)=>{const b=n(c,a+1);!Je(b)&&(l[u]=b)}),t[a]=void 0,l}}return s};return n(e,0)},vo=Oe("AsyncFunction"),Ro=e=>e&&(ot(e)||Se(e))&&Se(e.then)&&Se(e.catch),Pr=((e,t)=>e?setImmediate:t?((n,s)=>(Ue.addEventListener("message",({source:a,data:l})=>{a===Ue&&l===n&&s.length&&s.shift()()},!1),a=>{s.push(a),Ue.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",Se(Ue.postMessage)),Co=typeof queueMicrotask<"u"?queueMicrotask.bind(Ue):typeof process<"u"&&process.nextTick||Pr,So=e=>e!=null&&Se(e[Et]),O={isArray:Ze,isArrayBuffer:Ir,isBuffer:st,isFormData:Xs,isArrayBufferView:$s,isString:zs,isNumber:kr,isBoolean:Hs,isObject:ot,isPlainObject:ft,isEmptyObject:Ws,isReadableStream:Qs,isRequest:eo,isResponse:to,isHeaders:no,isUndefined:Je,isDate:Vs,isFile:Ys,isBlob:Gs,isRegExp:go,isFunction:Se,isStream:Js,isURLSearchParams:Zs,isTypedArray:uo,isFileList:Ks,forEach:at,merge:tn,extend:io,trim:ro,stripBOM:so,inherits:oo,toFlatObject:ao,kindOf:vt,kindOfTest:Oe,endsWith:lo,toArray:co,forEachEntry:fo,matchAll:ho,isHTMLForm:po,hasOwnProperty:Ln,hasOwnProp:Ln,reduceDescriptors:Fr,freezeMethods:yo,toObjectSet:wo,toCamelCase:mo,noop:bo,toFiniteNumber:xo,findKey:Or,global:Ue,isContextDefined:Br,isSpecCompliantForm:_o,toJSONObject:Eo,isAsyncFn:vo,isThenable:Ro,setImmediate:Pr,asap:Co,isIterable:So};function se(e,t,n,s,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),s&&(this.request=s),a&&(this.response=a,this.status=a.status?a.status:null)}O.inherits(se,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:O.toJSONObject(this.config),code:this.code,status:this.status}}});const Dr=se.prototype,Lr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Lr[e]={value:e}});Object.defineProperties(se,Lr);Object.defineProperty(Dr,"isAxiosError",{value:!0});se.from=(e,t,n,s,a,l)=>{const c=Object.create(Dr);O.toFlatObject(e,c,function(f){return f!==Error.prototype},h=>h!=="isAxiosError");const u=e&&e.message?e.message:"Error",b=t==null&&e?e.code:t;return se.call(c,u,b,n,s,a),e&&c.cause==null&&Object.defineProperty(c,"cause",{value:e,configurable:!0}),c.name=e&&e.name||"Error",l&&Object.assign(c,l),c};const No=null;function nn(e){return O.isPlainObject(e)||O.isArray(e)}function Mr(e){return O.endsWith(e,"[]")?e.slice(0,-2):e}function Mn(e,t,n){return e?e.concat(t).map(function(a,l){return a=Mr(a),!n&&l?"["+a+"]":a}).join(n?".":""):t}function jo(e){return O.isArray(e)&&!e.some(nn)}const To=O.toFlatObject(O,{},null,function(t){return/^is[A-Z]/.test(t)});function Ct(e,t,n){if(!O.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,n=O.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(C,_){return!O.isUndefined(_[C])});const s=n.metaTokens,a=n.visitor||f,l=n.dots,c=n.indexes,b=(n.Blob||typeof Blob<"u"&&Blob)&&O.isSpecCompliantForm(t);if(!O.isFunction(a))throw new TypeError("visitor must be a function");function h(x){if(x===null)return"";if(O.isDate(x))return x.toISOString();if(O.isBoolean(x))return x.toString();if(!b&&O.isBlob(x))throw new se("Blob is not supported. Use a Buffer instead.");return O.isArrayBuffer(x)||O.isTypedArray(x)?b&&typeof Blob=="function"?new Blob([x]):Buffer.from(x):x}function f(x,C,_){let m=x;if(x&&!_&&typeof x=="object"){if(O.endsWith(C,"{}"))C=s?C:C.slice(0,-2),x=JSON.stringify(x);else if(O.isArray(x)&&jo(x)||(O.isFileList(x)||O.endsWith(C,"[]"))&&(m=O.toArray(x)))return C=Mr(C),m.forEach(function(j,N){!(O.isUndefined(j)||j===null)&&t.append(c===!0?Mn([C],N,l):c===null?C:C+"[]",h(j))}),!1}return nn(x)?!0:(t.append(Mn(_,C,l),h(x)),!1)}const w=[],E=Object.assign(To,{defaultVisitor:f,convertValue:h,isVisitable:nn});function I(x,C){if(!O.isUndefined(x)){if(w.indexOf(x)!==-1)throw Error("Circular reference detected in "+C.join("."));w.push(x),O.forEach(x,function(m,k){(!(O.isUndefined(m)||m===null)&&a.call(t,m,O.isString(k)?k.trim():k,C,E))===!0&&I(m,C?C.concat(k):[k])}),w.pop()}}if(!O.isObject(e))throw new TypeError("data must be an object");return I(e),t}function Un(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function hn(e,t){this._pairs=[],e&&Ct(e,this,t)}const Ur=hn.prototype;Ur.append=function(t,n){this._pairs.push([t,n])};Ur.toString=function(t){const n=t?function(s){return t.call(this,s,Un)}:Un;return this._pairs.map(function(a){return n(a[0])+"="+n(a[1])},"").join("&")};function Ao(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function qr(e,t,n){if(!t)return e;const s=n&&n.encode||Ao;O.isFunction(n)&&(n={serialize:n});const a=n&&n.serialize;let l;if(a?l=a(t,n):l=O.isURLSearchParams(t)?t.toString():new hn(t,n).toString(s),l){const c=e.indexOf("#");c!==-1&&(e=e.slice(0,c)),e+=(e.indexOf("?")===-1?"?":"&")+l}return e}class qn{constructor(){this.handlers=[]}use(t,n,s){return this.handlers.push({fulfilled:t,rejected:n,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){O.forEach(this.handlers,function(s){s!==null&&t(s)})}}const $r={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Io=typeof URLSearchParams<"u"?URLSearchParams:hn,ko=typeof FormData<"u"?FormData:null,Oo=typeof Blob<"u"?Blob:null,Bo={isBrowser:!0,classes:{URLSearchParams:Io,FormData:ko,Blob:Oo},protocols:["http","https","file","blob","url","data"]},pn=typeof window<"u"&&typeof document<"u",rn=typeof navigator=="object"&&navigator||void 0,Fo=pn&&(!rn||["ReactNative","NativeScript","NS"].indexOf(rn.product)<0),Po=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Do=pn&&window.location.href||"http://localhost",Lo=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:pn,hasStandardBrowserEnv:Fo,hasStandardBrowserWebWorkerEnv:Po,navigator:rn,origin:Do},Symbol.toStringTag,{value:"Module"})),ve={...Lo,...Bo};function Mo(e,t){return Ct(e,new ve.classes.URLSearchParams,{visitor:function(n,s,a,l){return ve.isNode&&O.isBuffer(n)?(this.append(s,n.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...t})}function Uo(e){return O.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function qo(e){const t={},n=Object.keys(e);let s;const a=n.length;let l;for(s=0;s<a;s++)l=n[s],t[l]=e[l];return t}function zr(e){function t(n,s,a,l){let c=n[l++];if(c==="__proto__")return!0;const u=Number.isFinite(+c),b=l>=n.length;return c=!c&&O.isArray(a)?a.length:c,b?(O.hasOwnProp(a,c)?a[c]=[a[c],s]:a[c]=s,!u):((!a[c]||!O.isObject(a[c]))&&(a[c]=[]),t(n,s,a[c],l)&&O.isArray(a[c])&&(a[c]=qo(a[c])),!u)}if(O.isFormData(e)&&O.isFunction(e.entries)){const n={};return O.forEachEntry(e,(s,a)=>{t(Uo(s),a,n,0)}),n}return null}function $o(e,t,n){if(O.isString(e))try{return(t||JSON.parse)(e),O.trim(e)}catch(s){if(s.name!=="SyntaxError")throw s}return(n||JSON.stringify)(e)}const lt={transitional:$r,adapter:["xhr","http","fetch"],transformRequest:[function(t,n){const s=n.getContentType()||"",a=s.indexOf("application/json")>-1,l=O.isObject(t);if(l&&O.isHTMLForm(t)&&(t=new FormData(t)),O.isFormData(t))return a?JSON.stringify(zr(t)):t;if(O.isArrayBuffer(t)||O.isBuffer(t)||O.isStream(t)||O.isFile(t)||O.isBlob(t)||O.isReadableStream(t))return t;if(O.isArrayBufferView(t))return t.buffer;if(O.isURLSearchParams(t))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let u;if(l){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Mo(t,this.formSerializer).toString();if((u=O.isFileList(t))||s.indexOf("multipart/form-data")>-1){const b=this.env&&this.env.FormData;return Ct(u?{"files[]":t}:t,b&&new b,this.formSerializer)}}return l||a?(n.setContentType("application/json",!1),$o(t)):t}],transformResponse:[function(t){const n=this.transitional||lt.transitional,s=n&&n.forcedJSONParsing,a=this.responseType==="json";if(O.isResponse(t)||O.isReadableStream(t))return t;if(t&&O.isString(t)&&(s&&!this.responseType||a)){const c=!(n&&n.silentJSONParsing)&&a;try{return JSON.parse(t,this.parseReviver)}catch(u){if(c)throw u.name==="SyntaxError"?se.from(u,se.ERR_BAD_RESPONSE,this,null,this.response):u}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ve.classes.FormData,Blob:ve.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};O.forEach(["delete","get","head","post","put","patch"],e=>{lt.headers[e]={}});const zo=O.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ho=e=>{const t={};let n,s,a;return e&&e.split(`
`).forEach(function(c){a=c.indexOf(":"),n=c.substring(0,a).trim().toLowerCase(),s=c.substring(a+1).trim(),!(!n||t[n]&&zo[n])&&(n==="set-cookie"?t[n]?t[n].push(s):t[n]=[s]:t[n]=t[n]?t[n]+", "+s:s)}),t},$n=Symbol("internals");function et(e){return e&&String(e).trim().toLowerCase()}function ht(e){return e===!1||e==null?e:O.isArray(e)?e.map(ht):String(e)}function Wo(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=n.exec(e);)t[s[1]]=s[2];return t}const Vo=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function $t(e,t,n,s,a){if(O.isFunction(s))return s.call(this,t,n);if(a&&(t=n),!!O.isString(t)){if(O.isString(s))return t.indexOf(s)!==-1;if(O.isRegExp(s))return s.test(t)}}function Yo(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,n,s)=>n.toUpperCase()+s)}function Go(e,t){const n=O.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(e,s+n,{value:function(a,l,c){return this[s].call(this,t,a,l,c)},configurable:!0})})}let Ne=class{constructor(t){t&&this.set(t)}set(t,n,s){const a=this;function l(u,b,h){const f=et(b);if(!f)throw new Error("header name must be a non-empty string");const w=O.findKey(a,f);(!w||a[w]===void 0||h===!0||h===void 0&&a[w]!==!1)&&(a[w||b]=ht(u))}const c=(u,b)=>O.forEach(u,(h,f)=>l(h,f,b));if(O.isPlainObject(t)||t instanceof this.constructor)c(t,n);else if(O.isString(t)&&(t=t.trim())&&!Vo(t))c(Ho(t),n);else if(O.isObject(t)&&O.isIterable(t)){let u={},b,h;for(const f of t){if(!O.isArray(f))throw TypeError("Object iterator must return a key-value pair");u[h=f[0]]=(b=u[h])?O.isArray(b)?[...b,f[1]]:[b,f[1]]:f[1]}c(u,n)}else t!=null&&l(n,t,s);return this}get(t,n){if(t=et(t),t){const s=O.findKey(this,t);if(s){const a=this[s];if(!n)return a;if(n===!0)return Wo(a);if(O.isFunction(n))return n.call(this,a,s);if(O.isRegExp(n))return n.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=et(t),t){const s=O.findKey(this,t);return!!(s&&this[s]!==void 0&&(!n||$t(this,this[s],s,n)))}return!1}delete(t,n){const s=this;let a=!1;function l(c){if(c=et(c),c){const u=O.findKey(s,c);u&&(!n||$t(s,s[u],u,n))&&(delete s[u],a=!0)}}return O.isArray(t)?t.forEach(l):l(t),a}clear(t){const n=Object.keys(this);let s=n.length,a=!1;for(;s--;){const l=n[s];(!t||$t(this,this[l],l,t,!0))&&(delete this[l],a=!0)}return a}normalize(t){const n=this,s={};return O.forEach(this,(a,l)=>{const c=O.findKey(s,l);if(c){n[c]=ht(a),delete n[l];return}const u=t?Yo(l):String(l).trim();u!==l&&delete n[l],n[u]=ht(a),s[u]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const n=Object.create(null);return O.forEach(this,(s,a)=>{s!=null&&s!==!1&&(n[a]=t&&O.isArray(s)?s.join(", "):s)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,n])=>t+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...n){const s=new this(t);return n.forEach(a=>s.set(a)),s}static accessor(t){const s=(this[$n]=this[$n]={accessors:{}}).accessors,a=this.prototype;function l(c){const u=et(c);s[u]||(Go(a,c),s[u]=!0)}return O.isArray(t)?t.forEach(l):l(t),this}};Ne.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);O.reduceDescriptors(Ne.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(s){this[n]=s}}});O.freezeMethods(Ne);function zt(e,t){const n=this||lt,s=t||n,a=Ne.from(s.headers);let l=s.data;return O.forEach(e,function(u){l=u.call(n,l,a.normalize(),t?t.status:void 0)}),a.normalize(),l}function Hr(e){return!!(e&&e.__CANCEL__)}function Qe(e,t,n){se.call(this,e??"canceled",se.ERR_CANCELED,t,n),this.name="CanceledError"}O.inherits(Qe,se,{__CANCEL__:!0});function Wr(e,t,n){const s=n.config.validateStatus;!n.status||!s||s(n.status)?e(n):t(new se("Request failed with status code "+n.status,[se.ERR_BAD_REQUEST,se.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function Ko(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function Jo(e,t){e=e||10;const n=new Array(e),s=new Array(e);let a=0,l=0,c;return t=t!==void 0?t:1e3,function(b){const h=Date.now(),f=s[l];c||(c=h),n[a]=b,s[a]=h;let w=l,E=0;for(;w!==a;)E+=n[w++],w=w%e;if(a=(a+1)%e,a===l&&(l=(l+1)%e),h-c<t)return;const I=f&&h-f;return I?Math.round(E*1e3/I):void 0}}function Xo(e,t){let n=0,s=1e3/t,a,l;const c=(h,f=Date.now())=>{n=f,a=null,l&&(clearTimeout(l),l=null),e(...h)};return[(...h)=>{const f=Date.now(),w=f-n;w>=s?c(h,f):(a=h,l||(l=setTimeout(()=>{l=null,c(a)},s-w)))},()=>a&&c(a)]}const yt=(e,t,n=3)=>{let s=0;const a=Jo(50,250);return Xo(l=>{const c=l.loaded,u=l.lengthComputable?l.total:void 0,b=c-s,h=a(b),f=c<=u;s=c;const w={loaded:c,total:u,progress:u?c/u:void 0,bytes:b,rate:h||void 0,estimated:h&&u&&f?(u-c)/h:void 0,event:l,lengthComputable:u!=null,[t?"download":"upload"]:!0};e(w)},n)},zn=(e,t)=>{const n=e!=null;return[s=>t[0]({lengthComputable:n,total:e,loaded:s}),t[1]]},Hn=e=>(...t)=>O.asap(()=>e(...t)),Zo=ve.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,ve.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(ve.origin),ve.navigator&&/(msie|trident)/i.test(ve.navigator.userAgent)):()=>!0,Qo=ve.hasStandardBrowserEnv?{write(e,t,n,s,a,l){const c=[e+"="+encodeURIComponent(t)];O.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),O.isString(s)&&c.push("path="+s),O.isString(a)&&c.push("domain="+a),l===!0&&c.push("secure"),document.cookie=c.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function ea(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function ta(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function Vr(e,t,n){let s=!ea(t);return e&&(s||n==!1)?ta(e,t):t}const Wn=e=>e instanceof Ne?{...e}:e;function ze(e,t){t=t||{};const n={};function s(h,f,w,E){return O.isPlainObject(h)&&O.isPlainObject(f)?O.merge.call({caseless:E},h,f):O.isPlainObject(f)?O.merge({},f):O.isArray(f)?f.slice():f}function a(h,f,w,E){if(O.isUndefined(f)){if(!O.isUndefined(h))return s(void 0,h,w,E)}else return s(h,f,w,E)}function l(h,f){if(!O.isUndefined(f))return s(void 0,f)}function c(h,f){if(O.isUndefined(f)){if(!O.isUndefined(h))return s(void 0,h)}else return s(void 0,f)}function u(h,f,w){if(w in t)return s(h,f);if(w in e)return s(void 0,h)}const b={url:l,method:l,data:l,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:u,headers:(h,f,w)=>a(Wn(h),Wn(f),w,!0)};return O.forEach(Object.keys({...e,...t}),function(f){const w=b[f]||a,E=w(e[f],t[f],f);O.isUndefined(E)&&w!==u||(n[f]=E)}),n}const Yr=e=>{const t=ze({},e);let{data:n,withXSRFToken:s,xsrfHeaderName:a,xsrfCookieName:l,headers:c,auth:u}=t;if(t.headers=c=Ne.from(c),t.url=qr(Vr(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),u&&c.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):""))),O.isFormData(n)){if(ve.hasStandardBrowserEnv||ve.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if(O.isFunction(n.getHeaders)){const b=n.getHeaders(),h=["content-type","content-length"];Object.entries(b).forEach(([f,w])=>{h.includes(f.toLowerCase())&&c.set(f,w)})}}if(ve.hasStandardBrowserEnv&&(s&&O.isFunction(s)&&(s=s(t)),s||s!==!1&&Zo(t.url))){const b=a&&l&&Qo.read(l);b&&c.set(a,b)}return t},na=typeof XMLHttpRequest<"u",ra=na&&function(e){return new Promise(function(n,s){const a=Yr(e);let l=a.data;const c=Ne.from(a.headers).normalize();let{responseType:u,onUploadProgress:b,onDownloadProgress:h}=a,f,w,E,I,x;function C(){I&&I(),x&&x(),a.cancelToken&&a.cancelToken.unsubscribe(f),a.signal&&a.signal.removeEventListener("abort",f)}let _=new XMLHttpRequest;_.open(a.method.toUpperCase(),a.url,!0),_.timeout=a.timeout;function m(){if(!_)return;const j=Ne.from("getAllResponseHeaders"in _&&_.getAllResponseHeaders()),B={data:!u||u==="text"||u==="json"?_.responseText:_.response,status:_.status,statusText:_.statusText,headers:j,config:e,request:_};Wr(function(W){n(W),C()},function(W){s(W),C()},B),_=null}"onloadend"in _?_.onloadend=m:_.onreadystatechange=function(){!_||_.readyState!==4||_.status===0&&!(_.responseURL&&_.responseURL.indexOf("file:")===0)||setTimeout(m)},_.onabort=function(){_&&(s(new se("Request aborted",se.ECONNABORTED,e,_)),_=null)},_.onerror=function(N){const B=N&&N.message?N.message:"Network Error",z=new se(B,se.ERR_NETWORK,e,_);z.event=N||null,s(z),_=null},_.ontimeout=function(){let N=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const B=a.transitional||$r;a.timeoutErrorMessage&&(N=a.timeoutErrorMessage),s(new se(N,B.clarifyTimeoutError?se.ETIMEDOUT:se.ECONNABORTED,e,_)),_=null},l===void 0&&c.setContentType(null),"setRequestHeader"in _&&O.forEach(c.toJSON(),function(N,B){_.setRequestHeader(B,N)}),O.isUndefined(a.withCredentials)||(_.withCredentials=!!a.withCredentials),u&&u!=="json"&&(_.responseType=a.responseType),h&&([E,x]=yt(h,!0),_.addEventListener("progress",E)),b&&_.upload&&([w,I]=yt(b),_.upload.addEventListener("progress",w),_.upload.addEventListener("loadend",I)),(a.cancelToken||a.signal)&&(f=j=>{_&&(s(!j||j.type?new Qe(null,e,_):j),_.abort(),_=null)},a.cancelToken&&a.cancelToken.subscribe(f),a.signal&&(a.signal.aborted?f():a.signal.addEventListener("abort",f)));const k=Ko(a.url);if(k&&ve.protocols.indexOf(k)===-1){s(new se("Unsupported protocol "+k+":",se.ERR_BAD_REQUEST,e));return}_.send(l||null)})},ia=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let s=new AbortController,a;const l=function(h){if(!a){a=!0,u();const f=h instanceof Error?h:this.reason;s.abort(f instanceof se?f:new Qe(f instanceof Error?f.message:f))}};let c=t&&setTimeout(()=>{c=null,l(new se(`timeout ${t} of ms exceeded`,se.ETIMEDOUT))},t);const u=()=>{e&&(c&&clearTimeout(c),c=null,e.forEach(h=>{h.unsubscribe?h.unsubscribe(l):h.removeEventListener("abort",l)}),e=null)};e.forEach(h=>h.addEventListener("abort",l));const{signal:b}=s;return b.unsubscribe=()=>O.asap(u),b}},sa=function*(e,t){let n=e.byteLength;if(n<t){yield e;return}let s=0,a;for(;s<n;)a=s+t,yield e.slice(s,a),s=a},oa=async function*(e,t){for await(const n of aa(e))yield*sa(n,t)},aa=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:n,value:s}=await t.read();if(n)break;yield s}}finally{await t.cancel()}},Vn=(e,t,n,s)=>{const a=oa(e,t);let l=0,c,u=b=>{c||(c=!0,s&&s(b))};return new ReadableStream({async pull(b){try{const{done:h,value:f}=await a.next();if(h){u(),b.close();return}let w=f.byteLength;if(n){let E=l+=w;n(E)}b.enqueue(new Uint8Array(f))}catch(h){throw u(h),h}},cancel(b){return u(b),a.return()}},{highWaterMark:2})},Yn=64*1024,{isFunction:ut}=O,la=(({Request:e,Response:t})=>({Request:e,Response:t}))(O.global),{ReadableStream:Gn,TextEncoder:Kn}=O.global,Jn=(e,...t)=>{try{return!!e(...t)}catch{return!1}},ca=e=>{e=O.merge.call({skipUndefined:!0},la,e);const{fetch:t,Request:n,Response:s}=e,a=t?ut(t):typeof fetch=="function",l=ut(n),c=ut(s);if(!a)return!1;const u=a&&ut(Gn),b=a&&(typeof Kn=="function"?(x=>C=>x.encode(C))(new Kn):async x=>new Uint8Array(await new n(x).arrayBuffer())),h=l&&u&&Jn(()=>{let x=!1;const C=new n(ve.origin,{body:new Gn,method:"POST",get duplex(){return x=!0,"half"}}).headers.has("Content-Type");return x&&!C}),f=c&&u&&Jn(()=>O.isReadableStream(new s("").body)),w={stream:f&&(x=>x.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(x=>{!w[x]&&(w[x]=(C,_)=>{let m=C&&C[x];if(m)return m.call(C);throw new se(`Response type '${x}' is not supported`,se.ERR_NOT_SUPPORT,_)})});const E=async x=>{if(x==null)return 0;if(O.isBlob(x))return x.size;if(O.isSpecCompliantForm(x))return(await new n(ve.origin,{method:"POST",body:x}).arrayBuffer()).byteLength;if(O.isArrayBufferView(x)||O.isArrayBuffer(x))return x.byteLength;if(O.isURLSearchParams(x)&&(x=x+""),O.isString(x))return(await b(x)).byteLength},I=async(x,C)=>{const _=O.toFiniteNumber(x.getContentLength());return _??E(C)};return async x=>{let{url:C,method:_,data:m,signal:k,cancelToken:j,timeout:N,onDownloadProgress:B,onUploadProgress:z,responseType:W,headers:M,withCredentials:F="same-origin",fetchOptions:G}=Yr(x),ie=t||fetch;W=W?(W+"").toLowerCase():"text";let $=ia([k,j&&j.toAbortSignal()],N),J=null;const X=$&&$.unsubscribe&&(()=>{$.unsubscribe()});let ne;try{if(z&&h&&_!=="get"&&_!=="head"&&(ne=await I(M,m))!==0){let ee=new n(C,{method:"POST",body:m,duplex:"half"}),D;if(O.isFormData(m)&&(D=ee.headers.get("content-type"))&&M.setContentType(D),ee.body){const[H,te]=zn(ne,yt(Hn(z)));m=Vn(ee.body,Yn,H,te)}}O.isString(F)||(F=F?"include":"omit");const ce=l&&"credentials"in n.prototype,ue={...G,signal:$,method:_.toUpperCase(),headers:M.normalize().toJSON(),body:m,duplex:"half",credentials:ce?F:void 0};J=l&&new n(C,ue);let Y=await(l?ie(J,G):ie(C,ue));const fe=f&&(W==="stream"||W==="response");if(f&&(B||fe&&X)){const ee={};["status","statusText","headers"].forEach(oe=>{ee[oe]=Y[oe]});const D=O.toFiniteNumber(Y.headers.get("content-length")),[H,te]=B&&zn(D,yt(Hn(B),!0))||[];Y=new s(Vn(Y.body,Yn,H,()=>{te&&te(),X&&X()}),ee)}W=W||"text";let de=await w[O.findKey(w,W)||"text"](Y,x);return!fe&&X&&X(),await new Promise((ee,D)=>{Wr(ee,D,{data:de,headers:Ne.from(Y.headers),status:Y.status,statusText:Y.statusText,config:x,request:J})})}catch(ce){throw X&&X(),ce&&ce.name==="TypeError"&&/Load failed|fetch/i.test(ce.message)?Object.assign(new se("Network Error",se.ERR_NETWORK,x,J),{cause:ce.cause||ce}):se.from(ce,ce&&ce.code,x,J)}}},ua=new Map,Gr=e=>{let t=e?e.env:{};const{fetch:n,Request:s,Response:a}=t,l=[s,a,n];let c=l.length,u=c,b,h,f=ua;for(;u--;)b=l[u],h=f.get(b),h===void 0&&f.set(b,h=u?new Map:ca(t)),f=h;return h};Gr();const sn={http:No,xhr:ra,fetch:{get:Gr}};O.forEach(sn,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const Xn=e=>`- ${e}`,da=e=>O.isFunction(e)||e===null||e===!1,Kr={getAdapter:(e,t)=>{e=O.isArray(e)?e:[e];const{length:n}=e;let s,a;const l={};for(let c=0;c<n;c++){s=e[c];let u;if(a=s,!da(s)&&(a=sn[(u=String(s)).toLowerCase()],a===void 0))throw new se(`Unknown adapter '${u}'`);if(a&&(O.isFunction(a)||(a=a.get(t))))break;l[u||"#"+c]=a}if(!a){const c=Object.entries(l).map(([b,h])=>`adapter ${b} `+(h===!1?"is not supported by the environment":"is not available in the build"));let u=n?c.length>1?`since :
`+c.map(Xn).join(`
`):" "+Xn(c[0]):"as no adapter specified";throw new se("There is no suitable adapter to dispatch the request "+u,"ERR_NOT_SUPPORT")}return a},adapters:sn};function Ht(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Qe(null,e)}function Zn(e){return Ht(e),e.headers=Ne.from(e.headers),e.data=zt.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Kr.getAdapter(e.adapter||lt.adapter,e)(e).then(function(s){return Ht(e),s.data=zt.call(e,e.transformResponse,s),s.headers=Ne.from(s.headers),s},function(s){return Hr(s)||(Ht(e),s&&s.response&&(s.response.data=zt.call(e,e.transformResponse,s.response),s.response.headers=Ne.from(s.response.headers))),Promise.reject(s)})}const Jr="1.12.2",St={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{St[e]=function(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}});const Qn={};St.transitional=function(t,n,s){function a(l,c){return"[Axios v"+Jr+"] Transitional option '"+l+"'"+c+(s?". "+s:"")}return(l,c,u)=>{if(t===!1)throw new se(a(c," has been removed"+(n?" in "+n:"")),se.ERR_DEPRECATED);return n&&!Qn[c]&&(Qn[c]=!0,console.warn(a(c," has been deprecated since v"+n+" and will be removed in the near future"))),t?t(l,c,u):!0}};St.spelling=function(t){return(n,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function fa(e,t,n){if(typeof e!="object")throw new se("options must be an object",se.ERR_BAD_OPTION_VALUE);const s=Object.keys(e);let a=s.length;for(;a-- >0;){const l=s[a],c=t[l];if(c){const u=e[l],b=u===void 0||c(u,l,e);if(b!==!0)throw new se("option "+l+" must be "+b,se.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new se("Unknown option "+l,se.ERR_BAD_OPTION)}}const pt={assertOptions:fa,validators:St},Be=pt.validators;let qe=class{constructor(t){this.defaults=t||{},this.interceptors={request:new qn,response:new qn}}async request(t,n){try{return await this._request(t,n)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?l&&!String(s.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+l):s.stack=l}catch{}}throw s}}_request(t,n){typeof t=="string"?(n=n||{},n.url=t):n=t||{},n=ze(this.defaults,n);const{transitional:s,paramsSerializer:a,headers:l}=n;s!==void 0&&pt.assertOptions(s,{silentJSONParsing:Be.transitional(Be.boolean),forcedJSONParsing:Be.transitional(Be.boolean),clarifyTimeoutError:Be.transitional(Be.boolean)},!1),a!=null&&(O.isFunction(a)?n.paramsSerializer={serialize:a}:pt.assertOptions(a,{encode:Be.function,serialize:Be.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),pt.assertOptions(n,{baseUrl:Be.spelling("baseURL"),withXsrfToken:Be.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let c=l&&O.merge(l.common,l[n.method]);l&&O.forEach(["delete","get","head","post","put","patch","common"],x=>{delete l[x]}),n.headers=Ne.concat(c,l);const u=[];let b=!0;this.interceptors.request.forEach(function(C){typeof C.runWhen=="function"&&C.runWhen(n)===!1||(b=b&&C.synchronous,u.unshift(C.fulfilled,C.rejected))});const h=[];this.interceptors.response.forEach(function(C){h.push(C.fulfilled,C.rejected)});let f,w=0,E;if(!b){const x=[Zn.bind(this),void 0];for(x.unshift(...u),x.push(...h),E=x.length,f=Promise.resolve(n);w<E;)f=f.then(x[w++],x[w++]);return f}E=u.length;let I=n;for(;w<E;){const x=u[w++],C=u[w++];try{I=x(I)}catch(_){C.call(this,_);break}}try{f=Zn.call(this,I)}catch(x){return Promise.reject(x)}for(w=0,E=h.length;w<E;)f=f.then(h[w++],h[w++]);return f}getUri(t){t=ze(this.defaults,t);const n=Vr(t.baseURL,t.url,t.allowAbsoluteUrls);return qr(n,t.params,t.paramsSerializer)}};O.forEach(["delete","get","head","options"],function(t){qe.prototype[t]=function(n,s){return this.request(ze(s||{},{method:t,url:n,data:(s||{}).data}))}});O.forEach(["post","put","patch"],function(t){function n(s){return function(l,c,u){return this.request(ze(u||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:l,data:c}))}}qe.prototype[t]=n(),qe.prototype[t+"Form"]=n(!0)});let ha=class Xr{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(l){n=l});const s=this;this.promise.then(a=>{if(!s._listeners)return;let l=s._listeners.length;for(;l-- >0;)s._listeners[l](a);s._listeners=null}),this.promise.then=a=>{let l;const c=new Promise(u=>{s.subscribe(u),l=u}).then(a);return c.cancel=function(){s.unsubscribe(l)},c},t(function(l,c,u){s.reason||(s.reason=new Qe(l,c,u),n(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=s=>{t.abort(s)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new Xr(function(a){t=a}),cancel:t}}};function pa(e){return function(n){return e.apply(null,n)}}function ma(e){return O.isObject(e)&&e.isAxiosError===!0}const on={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(on).forEach(([e,t])=>{on[t]=e});function Zr(e){const t=new qe(e),n=Tr(qe.prototype.request,t);return O.extend(n,qe.prototype,t,{allOwnKeys:!0}),O.extend(n,t,null,{allOwnKeys:!0}),n.create=function(a){return Zr(ze(e,a))},n}const we=Zr(lt);we.Axios=qe;we.CanceledError=Qe;we.CancelToken=ha;we.isCancel=Hr;we.VERSION=Jr;we.toFormData=Ct;we.AxiosError=se;we.Cancel=we.CanceledError;we.all=function(t){return Promise.all(t)};we.spread=pa;we.isAxiosError=ma;we.mergeConfig=ze;we.AxiosHeaders=Ne;we.formToJSON=e=>zr(O.isHTMLForm(e)?new FormData(e):e);we.getAdapter=Kr.getAdapter;we.HttpStatusCode=on;we.default=we;const{Axios:Ua,AxiosError:qa,CanceledError:$a,isCancel:za,CancelToken:Ha,VERSION:Wa,all:Va,Cancel:Ya,isAxiosError:Ga,spread:Ka,toFormData:Ja,AxiosHeaders:Xa,HttpStatusCode:Za,formToJSON:Qa,getAdapter:el,mergeConfig:tl}=we,Ye=we.create({baseURL:"https://lovebirds-ph.onrender.com/api",headers:{"Content-Type":"application/json"}});Ye.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e});const ga=()=>{const[e,t]=S.useState({name:"",email:"",password:""}),[n,s]=S.useState(!1),[a,l]=S.useState(""),[c,u]=S.useState(!1),[b,h]=S.useState(null),[f,w]=S.useState(""),[E,I]=S.useState(!1),[x,C]=S.useState({email:""}),[_,m]=S.useState({otp:"",newPassword:"",confirmPassword:""}),[k,j]=S.useState(!1),[N,B]=S.useState(!1),{login:z}=ke(),W=D=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(D),M=D=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/.test(D),F=async D=>{var H,te;if(D.preventDefault(),u(!0),l(""),!W(x.email)){l("Please enter a valid email address"),u(!1);return}try{await Ye.post("/auth/forgot-password",{email:x.email}),j(!0),l("")}catch(oe){l(((te=(H=oe.response)==null?void 0:H.data)==null?void 0:te.message)||"Failed to send OTP")}finally{u(!1)}},G=async D=>{var H,te;if(D.preventDefault(),u(!0),l(""),_.otp.length!==4){l("OTP must be 4 digits"),u(!1);return}try{await Ye.post("/auth/verify-otp",{email:x.email,otp:_.otp}),B(!0),l("")}catch(oe){l(((te=(H=oe.response)==null?void 0:H.data)==null?void 0:te.message)||"Invalid OTP")}finally{u(!1)}},ie=async D=>{var H,te;if(D.preventDefault(),u(!0),l(""),!M(_.newPassword)){l("Password must be 8+ characters with uppercase, lowercase, number & special character"),u(!1);return}if(_.newPassword!==_.confirmPassword){l("Passwords do not match"),u(!1);return}try{await Ye.post("/auth/reset-password",{email:x.email,otp:_.otp,newPassword:_.newPassword}),I(!1),j(!1),B(!1),C({email:""}),m({otp:"",newPassword:"",confirmPassword:""}),l("Password reset successfully! Please login with your new password.")}catch(oe){l(((te=(H=oe.response)==null?void 0:H.data)==null?void 0:te.message)||"Failed to reset password")}finally{u(!1)}},$=async D=>{var H,te;if(D.preventDefault(),u(!0),l(""),n){if(!M(e.password)){l("Password must be 8+ characters and include uppercase, lowercase, number, & special character."),u(!1);return}if(!W(e.email)){l("Please enter a valid email address"),u(!1);return}}try{if(n){const oe=new FormData;oe.append("name",e.name),oe.append("email",e.email),oe.append("password",e.password),b&&oe.append("avatar",b);const{data:T}=await Ye.post("/auth/signup",oe,{headers:{"Content-Type":"multipart/form-data"}});z(T.token,T.user)}else{const oe={email:e.email,password:e.password},{data:T}=await Ye.post("/auth/login",oe);z(T.token,T.user)}}catch(oe){console.error("Login error:",oe),l(((te=(H=oe.response)==null?void 0:H.data)==null?void 0:te.message)||"Authentication failed")}finally{u(!1)}},J=D=>{t({...e,[D.target.name]:D.target.value})},X=D=>{C({...x,[D.target.name]:D.target.value})},ne=D=>{m({..._,[D.target.name]:D.target.value})},ce=D=>{const H=D.target.files[0];if(H){if(!H.type.startsWith("image/")){l("Please select an image file");return}if(H.size>5*1024*1024){l("Image size should be less than 5MB");return}h(H),w(URL.createObjectURL(H)),l("")}},ue=()=>{t({name:"",email:"",password:""}),h(null),w(""),l(""),s(!1),I(!1),j(!1),B(!1),C({email:""}),m({otp:"",newPassword:"",confirmPassword:""})},Y=()=>{I(!1),j(!1),B(!1),C({email:""}),m({otp:"",newPassword:"",confirmPassword:""}),l("")},fe=()=>i.jsx("svg",{className:"logo-icon",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:i.jsx("path",{d:"M12.7,21.9C9,21.5,5.2,18.8,3,15.1c-1.3-2.2-1.8-4.7-1.6-7.2c0.2-2.5,1.2-4.8,2.9-6.6 C6.1,0,8.6-0.5,11.1,0.3c1.9,0.6,3.5,1.9,4.6,3.6c-0.6-0.3-1.3-0.5-2-0.6c-2.1-0.3-4.2,0.6-5.6,2.3c-1.2,1.5-1.7,3.4-1.4,5.3 c0.3,2,1.7,3.7,3.6,4.5c0.3,0.1,0.6,0.2,0.9,0.3c-0.1,0.2-0.2,0.3-0.2,0.5c-0.6,0.9-0.8,2-0.6,3.1c0.2,1,0.8,1.9,1.6,2.6 C12.3,21.8,12.5,21.8,12.7,21.9z M21.3,12.3c-0.2-2.5-1.2-4.8-2.9-6.6c-1.8-1.8-4.1-2.7-6.5-2.5c-0.6,0-1.2,0.1-1.8,0.3 c1.2-1.9,3.1-3.2,5.3-3.6c2.5-0.5,5,0.1,6.8,1.8c1.8,1.8,2.7,4.1,2.5,6.5c-0.1,1.9-0.9,3.6-2.1,5c-0.8,0.9-1.8,1.6-2.8,2.1 c0.5,0.2,1,0.2,1.5,0.1c2.1-0.3,4-1.6,5.1-3.4C22.2,16.5,22,14.2,21.3,12.3z"})}),de=()=>{if(!k&&!N)return i.jsxs(Me.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},className:"login-card",children:[i.jsx("h2",{className:"card-title",children:"Reset Your Password"}),i.jsx("p",{className:"card-subtitle",children:"Enter your email to receive a verification code"}),a&&i.jsx("div",{className:"error-message",children:a}),i.jsxs("form",{className:"login-form",onSubmit:F,children:[i.jsx("input",{type:"email",name:"email",value:x.email,onChange:X,placeholder:"Enter your email",className:"input-field",required:!0,disabled:c}),i.jsxs("div",{className:"button-group",children:[i.jsx("button",{type:"button",className:"cancel-button",onClick:Y,disabled:c,children:"Back to Login"}),i.jsx("button",{type:"submit",className:"submit-button",disabled:c,children:c?"Sending...":"Send OTP"})]})]})]});if(k&&!N)return i.jsxs(Me.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},className:"login-card",children:[i.jsx("h2",{className:"card-title",children:"Verify OTP"}),i.jsxs("p",{className:"card-subtitle",children:["Enter the 4-digit code sent to ",x.email]}),a&&i.jsx("div",{className:"error-message",children:a}),i.jsxs("form",{className:"login-form",onSubmit:G,children:[i.jsx("input",{type:"text",name:"otp",value:_.otp,onChange:ne,placeholder:"Enter 4-digit OTP",className:"input-field",maxLength:"4",required:!0,disabled:c}),i.jsxs("div",{className:"button-group",children:[i.jsx("button",{type:"button",className:"cancel-button",onClick:Y,disabled:c,children:"Cancel"}),i.jsx("button",{type:"submit",className:"submit-button",disabled:c,children:c?"Verifying...":"Verify OTP"})]})]})]});if(N)return i.jsxs(Me.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},className:"login-card",children:[i.jsx("h2",{className:"card-title",children:"Create New Password"}),i.jsx("p",{className:"card-subtitle",children:"Enter your new password"}),a&&i.jsx("div",{className:"error-message",children:a}),i.jsxs("form",{className:"login-form",onSubmit:ie,children:[i.jsx("input",{type:"password",name:"newPassword",value:_.newPassword,onChange:ne,placeholder:"New Password",className:"input-field",required:!0,disabled:c}),i.jsx("input",{type:"password",name:"confirmPassword",value:_.confirmPassword,onChange:ne,placeholder:"Confirm New Password",className:"input-field",required:!0,disabled:c}),i.jsxs("div",{className:"button-group",children:[i.jsx("button",{type:"button",className:"cancel-button",onClick:Y,disabled:c,children:"Cancel"}),i.jsx("button",{type:"submit",className:"submit-button",disabled:c,children:c?"Resetting...":"Reset Password"})]})]})]})},ee=()=>i.jsxs(Me.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.7,delay:.2},className:"login-card",children:[i.jsx("h2",{className:"card-title",children:n?"Create an Account":"Login to Lovebirds"}),a&&i.jsx("div",{className:"error-message",children:a}),i.jsxs("form",{className:"login-form",onSubmit:$,children:[n&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"avatar-uploader",children:[i.jsx("label",{htmlFor:"avatar-upload",className:"avatar-label",children:f?i.jsx("img",{src:f,alt:"Avatar Preview",className:"avatar-preview"}):i.jsxs("div",{className:"avatar-placeholder",children:[i.jsx("span",{children:"+"}),i.jsx("p",{children:"Add Photo"})]})}),i.jsx("input",{id:"avatar-upload",type:"file",name:"avatar",accept:"image/png, image/jpeg, image/jpg, image/gif",onChange:ce,className:"avatar-input"}),f&&i.jsx("button",{type:"button",className:"avatar-remove",onClick:()=>{h(null),w("")},children:"Ã—"})]}),i.jsx("input",{type:"text",name:"name",value:e.name,onChange:J,placeholder:"Your Name",className:"input-field",required:!0,disabled:c})]}),i.jsx("input",{type:"email",name:"email",value:e.email,onChange:J,placeholder:"Email",className:"input-field",required:!0,disabled:c}),i.jsx("input",{type:"password",name:"password",value:e.password,onChange:J,placeholder:"Password",className:"input-field",required:!0,disabled:c}),!n&&i.jsx("div",{className:"forgot-password-link",children:i.jsx("button",{type:"button",onClick:()=>I(!0),className:"forgot-password-btn",children:"Forgot your password?"})}),i.jsxs("div",{className:"button-group",children:[i.jsx("button",{type:"button",className:"cancel-button",onClick:ue,disabled:c,children:"Cancel"}),i.jsx("button",{type:"submit",className:"submit-button",disabled:c,children:c?"Loading...":n?"Sign Up":"Login"})]})]}),i.jsxs("div",{className:"signup-link",children:[n?"Already have an account? ":"Don't have an account? ",i.jsx("button",{onClick:()=>s(!n),disabled:c,children:n?"Log in":"Sign up"})]})]});return i.jsxs("div",{className:"login-page-container",children:[i.jsxs(Me.div,{initial:{opacity:0,y:-30},animate:{opacity:1,y:0},transition:{duration:.7},className:"logo-container",children:[i.jsx(fe,{}),i.jsx("h1",{className:"logo-title",children:"LOVEBIRDS"}),i.jsx("p",{className:"logo-tagline",children:"Connect & Share"})]}),E?de():ee()]})},ya=({isOpen:e,onClose:t})=>{const{user:n,updateProfile:s}=ke(),[a,l]=S.useState({name:(n==null?void 0:n.name)||"",avatar:null}),[c,u]=S.useState((n==null?void 0:n.avatar)||""),[b,h]=S.useState(!1),[f,w]=S.useState(""),E=S.useRef(null),I=m=>m?m.startsWith("http")?m:`${window.location.origin}/uploads/${m}`:"";S.useEffect(()=>{l({name:(n==null?void 0:n.name)||"",avatar:null}),u(I(n==null?void 0:n.avatar)||"")},[n]);const x=m=>{const k=m.target.files[0];if(k){if(k.size>5*1024*1024){w("File size must be less than 5MB");return}if(!k.type.startsWith("image/")){w("Please select an image file");return}l(N=>({...N,avatar:k})),w("");const j=new FileReader;j.onload=N=>u(N.target.result),j.readAsDataURL(k)}},C=()=>{var m;(m=E.current)==null||m.click()},_=async m=>{if(m.preventDefault(),h(!0),w(""),!a.name.trim()){w("Name is required"),h(!1);return}if(a.name.trim().length<2){w("Name must be at least 2 characters long"),h(!1);return}try{await s(a),t()}catch(k){w(k.message||"Failed to update profile. Please try again.")}finally{h(!1)}};return e?i.jsx("div",{className:"modal-overlay",children:i.jsxs("div",{className:"modal-content",children:[i.jsxs("div",{className:"modal-header",children:[i.jsx("h2",{children:"Edit Profile"}),i.jsx("button",{className:"close-button",onClick:t,children:i.jsx(He,{size:20})})]}),i.jsxs("form",{onSubmit:_,className:"profile-form",children:[i.jsxs("div",{className:"avatar-section",children:[i.jsxs("div",{className:"avatar-upload",onClick:C,children:[c?i.jsx("img",{src:c,alt:"Preview",className:"avatar-preview"}):i.jsx("div",{className:"avatar-placeholder",children:i.jsx(nr,{size:40})}),i.jsx("div",{className:"avatar-overlay",children:i.jsx(rr,{size:20})})]}),i.jsx("input",{ref:E,type:"file",accept:"image/*",onChange:x,className:"file-input"}),i.jsx("p",{className:"avatar-hint",children:"Click to upload new photo (max 5MB)"})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"name",children:"Display Name"}),i.jsx("input",{type:"text",id:"name",value:a.name,onChange:m=>l(k=>({...k,name:m.target.value})),placeholder:"Enter your name",minLength:"2",maxLength:"50",required:!0})]}),f&&i.jsx("div",{className:"error-message",children:f}),i.jsxs("div",{className:"form-actions",children:[i.jsx("button",{type:"button",onClick:t,className:"btn-secondary",children:"Cancel"}),i.jsx("button",{type:"submit",disabled:b,className:"btn-primary",children:b?"Saving...":"Save Changes"})]})]})]})}):null},wa=({isOpen:e,onClose:t,currentFriends:n=[]})=>{const[s,a]=S.useState(""),[l,c]=S.useState([]),[u,b]=S.useState(!1),[h,f]=S.useState(""),[w,E]=S.useState({}),[I,x]=S.useState({}),[C,_]=S.useState(new Set),m=S.useContext(Pe),{user:k}=ke();S.useEffect(()=>{e&&(a(""),c([]),f(""),E({}),x({}),_(new Set))},[e]),S.useEffect(()=>{if(!m)return;const F=$=>{console.log("âœ… Chat request sent:",$);const J=$.receiver._id||$.receiver;_(X=>new Set([...X,J])),E(X=>{const ne={...X};return delete ne[J],ne}),x(X=>({...X,[J]:"Request sent successfully!"})),setTimeout(()=>{x(X=>{const ne={...X};return delete ne[J],ne})},3e3)},G=$=>{console.error("âŒ Chat request error:",$),alert($.message||"Failed to send chat request"),E({})},ie=({requestId:$})=>{console.log("ðŸ—‘ï¸ Chat request cancelled:",$)};return m.on("chatRequestSent",F),m.on("chatRequestError",G),m.on("chatRequestCancelled",ie),()=>{m.off("chatRequestSent",F),m.off("chatRequestError",G),m.off("chatRequestCancelled",ie)}},[m]);const j=async()=>{if(!s.trim()){f("Please enter a search term");return}b(!0),f(""),c([]);try{const F=localStorage.getItem("token");if(!F)throw new Error("Authentication token not found. Please log in again.");console.log("ðŸ” Searching for:",s);let G=await fetch(`https://lovebirds-ph.onrender.com/api/users/search?q=${encodeURIComponent(s)}`,{headers:{Authorization:`Bearer ${F}`,"Content-Type":"application/json"}});if(!G.ok){const J=await G.json().catch(()=>({message:"Search failed"}));throw new Error(J.message||`Search failed: ${G.status}`)}const ie=await G.json();console.log("âœ… Search results:",ie);const $=ie.filter(J=>J._id!==k._id);c($),$.length===0&&f("No users found matching your search")}catch(F){console.error("âŒ Search error:",F),f(F.message||"Failed to search users. Please try again."),c([])}finally{b(!1)}},N=F=>{if(!m){alert("Connection error. Please refresh the page.");return}if(!F){alert("Invalid user ID");return}console.log("ðŸ“¨ Sending chat request to:",F),E(G=>({...G,[F]:!0})),x(G=>{const ie={...G};return delete ie[F],ie}),m.emit("sendChatRequest",{receiverId:F})},B=F=>{if(!m){alert("Connection error. Please refresh the page.");return}window.confirm("Are you sure you want to block this user?")&&(m.emit("blockUser",{userIdToBlock:F}),c(G=>G.filter(ie=>ie._id!==F)),alert("User blocked successfully"))},z=F=>n.some(G=>G._id===F||G===F),W=F=>C.has(F)||w[F]||I[F],M=F=>{F.key==="Enter"&&j()};return e?i.jsx("div",{className:"modal-overlay",onClick:t,children:i.jsxs("div",{className:"user-search-modal",onClick:F=>F.stopPropagation(),children:[i.jsxs("div",{className:"modal-header",children:[i.jsx("h2",{children:"Find Friends"}),i.jsx("button",{onClick:t,className:"modal-close",children:i.jsx(He,{size:20})})]}),i.jsx("div",{className:"search-section",children:i.jsxs("div",{className:"search-input-container",children:[i.jsx(Ge,{size:18,className:"search-icon"}),i.jsx("input",{type:"text",placeholder:"Search by name or email...",value:s,onChange:F=>a(F.target.value),onKeyPress:M,className:"search-input-field",autoFocus:!0}),i.jsx("button",{onClick:j,className:"search-button",disabled:u||!s.trim(),children:u?i.jsx(Nt,{size:18,className:"spinner"}):"Search"})]})}),h&&i.jsxs("div",{className:"error-message",children:[i.jsx(Qr,{size:16}),i.jsx("p",{children:h})]}),i.jsx("div",{className:"search-results",children:u?i.jsxs("div",{className:"loading-state",children:[i.jsx(Nt,{size:32,className:"spinner"}),i.jsx("p",{children:"Searching users..."})]}):l.length===0&&!h?i.jsxs("div",{className:"empty-state",children:[i.jsx(Ge,{size:48}),i.jsx("p",{children:"Search for users to send chat requests"}),i.jsx("small",{children:"Enter a name or email address above to start searching"})]}):i.jsx("div",{className:"results-list",children:l.map(F=>{const G=z(F._id),ie=W(F._id),$=w[F._id],J=I[F._id];return i.jsxs("div",{className:"user-result-item",children:[i.jsxs("div",{className:"user-info",children:[i.jsx("img",{src:F.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(F.name)}&background=random`,alt:F.name,className:"user-avatar"}),i.jsxs("div",{className:"user-details",children:[i.jsx("h3",{children:F.name}),i.jsx("p",{children:F.email}),i.jsxs("div",{className:"user-status",children:[i.jsx("span",{className:`status-dot ${F.isOnline?"online":"offline"}`}),F.isOnline?"Online":"Offline"]})]})]}),i.jsx("div",{className:"user-actions",children:J?i.jsxs("div",{className:"success-message",children:[i.jsx(ei,{size:16}),i.jsx("span",{children:"Request Sent!"})]}):G?i.jsx("button",{className:"btn btn-already-friend",disabled:!0,children:"Already Friends"}):ie?i.jsxs("button",{className:"btn btn-request-pending",disabled:!0,children:[i.jsx(ir,{size:16}),i.jsx("span",{children:"Request Pending"})]}):i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:()=>N(F._id),className:"btn btn-send-request",disabled:$,children:$?i.jsxs(i.Fragment,{children:[i.jsx(Nt,{size:16,className:"spinner"}),i.jsx("span",{children:"Sending..."})]}):i.jsxs(i.Fragment,{children:[i.jsx(sr,{size:16}),i.jsx("span",{children:"Send Request"})]})}),i.jsx("button",{onClick:()=>B(F._id),className:"btn btn-block-user",title:"Block user",disabled:$,children:i.jsx(an,{size:16})})]})})]},F._id)})})})]})}):null},ba=({isOpen:e,onClose:t,requests:n=[]})=>{const[s,a]=S.useState("received"),l=S.useContext(Pe),c=n.received||[],u=n.sent||[],b=E=>{l&&l.emit("acceptChatRequest",{requestId:E})},h=E=>{l&&l.emit("rejectChatRequest",{requestId:E})},f=E=>{l&&l.emit("cancelChatRequest",{requestId:E})},w=E=>{l&&l.emit("blockUser",{userIdToBlock:E})};return e?i.jsx("div",{className:"modal-overlay",onClick:t,children:i.jsxs("div",{className:"chat-request-modal",onClick:E=>E.stopPropagation(),children:[i.jsxs("div",{className:"modal-header",children:[i.jsx("h2",{children:"Chat Requests"}),i.jsx("button",{onClick:t,className:"modal-close",children:i.jsx(He,{size:20})})]}),i.jsxs("div",{className:"modal-tabs",children:[i.jsxs("button",{className:`tab ${s==="received"?"active":""}`,onClick:()=>a("received"),children:["Received (",c.length,")"]}),i.jsxs("button",{className:`tab ${s==="sent"?"active":""}`,onClick:()=>a("sent"),children:["Sent (",u.length,")"]})]}),i.jsx("div",{className:"modal-content",children:s==="received"?c.length===0?i.jsxs("div",{className:"no-requests",children:[i.jsx(ir,{size:48}),i.jsx("p",{children:"No pending chat requests"})]}):i.jsx("div",{className:"requests-list",children:c.map(E=>{var I,x,C,_,m;return i.jsxs("div",{className:"request-item",children:[i.jsxs("div",{className:"request-user-info",children:[i.jsx("img",{src:((I=E.sender)==null?void 0:I.avatar)||`https://ui-avatars.com/api/?name=${(x=E.sender)==null?void 0:x.name}&background=random`,alt:(C=E.sender)==null?void 0:C.name,className:"request-avatar"}),i.jsxs("div",{className:"request-details",children:[i.jsx("h3",{children:(_=E.sender)==null?void 0:_.name}),i.jsx("p",{children:(m=E.sender)==null?void 0:m.email}),i.jsx("small",{children:new Date(E.createdAt).toLocaleDateString()})]})]}),i.jsxs("div",{className:"request-actions",children:[i.jsxs("button",{onClick:()=>b(E._id),className:"btn btn-accept",title:"Accept request",children:[i.jsx(Wt,{size:18}),i.jsx("span",{children:"Accept"})]}),i.jsxs("button",{onClick:()=>h(E._id),className:"btn btn-reject",title:"Reject request",children:[i.jsx(mn,{size:18}),i.jsx("span",{children:"Reject"})]}),i.jsxs("button",{onClick:()=>{var k;return w((k=E.sender)==null?void 0:k._id)},className:"btn btn-block",title:"Block user",children:[i.jsx(an,{size:18}),i.jsx("span",{children:"Block"})]})]})]},E._id)})}):u.length===0?i.jsxs("div",{className:"no-requests",children:[i.jsx(nr,{size:48}),i.jsx("p",{children:"No sent chat requests"})]}):i.jsx("div",{className:"requests-list",children:u.map(E=>{var I,x,C,_,m;return i.jsxs("div",{className:"request-item",children:[i.jsxs("div",{className:"request-user-info",children:[i.jsx("img",{src:((I=E.receiver)==null?void 0:I.avatar)||`https://ui-avatars.com/api/?name=${(x=E.receiver)==null?void 0:x.name}&background=random`,alt:(C=E.receiver)==null?void 0:C.name,className:"request-avatar"}),i.jsxs("div",{className:"request-details",children:[i.jsx("h3",{children:(_=E.receiver)==null?void 0:_.name}),i.jsx("p",{children:(m=E.receiver)==null?void 0:m.email}),i.jsxs("small",{children:["Sent ",new Date(E.createdAt).toLocaleDateString()]})]})]}),i.jsx("div",{className:"request-actions",children:i.jsxs("button",{onClick:()=>f(E._id),className:"btn btn-cancel",title:"Cancel request",children:[i.jsx(mn,{size:18}),i.jsx("span",{children:"Cancel"})]})})]},E._id)})})})]})}):null},xa=({isOpen:e,onClose:t})=>{const[n,s]=S.useState([]),[a,l]=S.useState(!1),c=S.useContext(Pe);S.useEffect(()=>{e&&c&&u()},[e,c]);const u=async()=>{l(!0);try{const f=localStorage.getItem("token"),w=await fetch("https://lovebirds-ph.onrender.com/api/users/blocked/list",{headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"}});if(w.ok){const E=await w.json();s(E),console.log("âœ… Loaded blocked users:",E.length)}else console.error("âŒ Failed to fetch blocked users")}catch(f){console.error("âŒ Error fetching blocked users:",f)}finally{l(!1)}},b=(f,w)=>{window.confirm(`Are you sure you want to unblock ${w}?`)&&c&&(console.log("ðŸ”“ Unblocking user:",f),c.emit("unblockUser",{userIdToUnblock:f}),s(E=>E.filter(I=>I._id!==f)),alert(`${w} has been unblocked successfully.`))},h=f=>f!=null&&f.avatar?f.avatar.startsWith("http")?f.avatar:`${window.location.origin}/uploads/${f.avatar}`:`https://ui-avatars.com/api/?name=${encodeURIComponent((f==null?void 0:f.name)||"User")}&background=random`;return e?i.jsx("div",{className:"modal-overlay",onClick:t,children:i.jsxs("div",{className:"modal-content blocked-users-modal",onClick:f=>f.stopPropagation(),children:[i.jsxs("div",{className:"modal-header",children:[i.jsxs("div",{className:"modal-header-title",children:[i.jsx(or,{size:24}),i.jsx("h2",{children:"Blocked Users"})]}),i.jsx("button",{onClick:t,className:"modal-close-button",children:i.jsx(He,{size:20})})]}),i.jsx("div",{className:"modal-body",children:a?i.jsxs("div",{className:"loading-state",children:[i.jsx("div",{className:"spinner"}),i.jsx("p",{children:"Loading blocked users..."})]}):n.length===0?i.jsxs("div",{className:"empty-state",children:[i.jsx(ti,{size:48,className:"empty-icon"}),i.jsx("h3",{children:"No Blocked Users"}),i.jsx("p",{children:"You haven't blocked anyone yet."})]}):i.jsx("div",{className:"blocked-users-list",children:n.map(f=>i.jsxs("div",{className:"blocked-user-item",children:[i.jsxs("div",{className:"blocked-user-info",children:[i.jsx("img",{src:h(f),alt:f.name,className:"blocked-user-avatar",onError:w=>{w.target.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(f.name)}&background=random`}}),i.jsxs("div",{className:"blocked-user-details",children:[i.jsx("h3",{children:f.name}),i.jsx("p",{children:f.email})]})]}),i.jsx("button",{onClick:()=>b(f._id,f.name),className:"unblock-button",children:"Unblock"})]},f._id))})})]})}):null},_a=({users:e,selectedUser:t,onSelectUser:n,messagesMap:s={},lastMessageUpdate:a})=>{const{user:l,logout:c}=ke(),u=S.useContext(Pe),[b,h]=S.useState(""),[f,w]=S.useState(localStorage.getItem("chat-theme")||"light"),[E,I]=S.useState(!1),[x,C]=S.useState(!1),[_,m]=S.useState(!1),[k,j]=S.useState(!1),[N,B]=S.useState({received:[],sent:[]}),[z,W]=S.useState(0),[M,F]=S.useState(!1),G=S.useRef({}),[ie,$]=S.useState({}),J=S.useRef(null);S.useEffect(()=>{t&&window.innerWidth<=768&&F(!1)},[t]),S.useEffect(()=>{const Y=()=>{window.innerWidth>768&&F(!1)};return window.addEventListener("resize",Y),()=>window.removeEventListener("resize",Y)},[]),S.useEffect(()=>(M&&window.innerWidth<=768?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[M]),S.useEffect(()=>{if(l!=null&&l._id){const Y=localStorage.getItem(`unreadCounts_${l._id}`);if(Y)try{G.current=JSON.parse(Y),$({...G.current}),console.log("ðŸ’¾ [SIDEBAR] Loaded unread counts from storage:",G.current)}catch{console.error("âŒ [SIDEBAR] Failed to parse saved unread counts"),G.current={}}}},[l]),S.useEffect(()=>{l!=null&&l._id&&(localStorage.setItem(`unreadCounts_${l._id}`,JSON.stringify(G.current)),console.log("ðŸ’¾ [SIDEBAR] Saved unread counts to storage:",G.current))},[ie,l]),S.useEffect(()=>{t?(J.current=t._id,console.log(`ðŸ“Œ [SIDEBAR] Selected user: ${t.name} (${t._id})`),G.current[t._id]&&(console.log(`ðŸ—‘ï¸ [SIDEBAR] Clearing unreads for: ${t._id}`),delete G.current[t._id],$({...G.current}))):J.current=null},[t]),S.useEffect(()=>{if(!a||!l){console.log("âš ï¸ [SIDEBAR] No lastMessageUpdate or user");return}console.log("ðŸ”” [SIDEBAR] ========================================"),console.log("ðŸ”” [SIDEBAR] Message update received:",a);const{userId:Y,message:fe,isReceived:de}=a;if(!Y){console.log("âš ï¸ [SIDEBAR] No userId in lastMessageUpdate");return}const ee=J.current===Y;if(console.log(`ðŸ‘€ [SIDEBAR] Currently viewing chat with ${Y}? ${ee}`),console.log(`ðŸ‘€ [SIDEBAR] Current chat user: ${J.current}`),ee){if(console.log("âœ… [SIDEBAR] User IS viewing this chat - NOT incrementing unread"),G.current[Y]){delete G.current[Y];const D={...G.current};$(D)}console.log("ðŸ”” [SIDEBAR] ========================================");return}if(console.log("ðŸ“­ [SIDEBAR] User NOT viewing this chat"),de){console.log(`ðŸ“¬ [SIDEBAR] RECEIVED message from ${Y} - INCREMENTING unread count`);const D=G.current[Y]||0;G.current[Y]=D+1,console.log(`ðŸ“Š [SIDEBAR] New unread count for ${Y}: ${G.current[Y]}`),console.log("ðŸ“Š [SIDEBAR] All unread counts:",G.current);const H={...G.current};$(H),console.log("âœ… [SIDEBAR] State updated with new counts")}else{console.log(`ðŸ“¤ [SIDEBAR] SENT message to ${Y} - updating last message preview`);const D={...G.current};$(D),console.log("âœ… [SIDEBAR] State updated for sent message")}console.log("ðŸ”” [SIDEBAR] ========================================")},[a,l]),S.useEffect(()=>{if(!u){console.log("âš ï¸ [SIDEBAR] No socket available for chat requests");return}console.log("ðŸŽ§ [SIDEBAR] Setting up chat request listeners");const Y=()=>{console.log("ðŸ“¬ [SIDEBAR] Requesting chat requests from server")},fe=R=>{var L,V;console.log("ðŸ“¬ [SIDEBAR] Chat requests loaded:",{received:((L=R.received)==null?void 0:L.length)||0,sent:((V=R.sent)==null?void 0:V.length)||0,count:R.count||0}),B({received:R.received||[],sent:R.sent||[]}),W(R.count||0)},de=R=>{console.log("ðŸ“¨ [SIDEBAR] New chat request received:",R),B(L=>({...L,received:[R,...L.received]})),W(L=>L+1),Notification.permission==="granted"&&R.sender&&new Notification("New Chat Request",{body:`${R.sender.name} wants to connect with you!`,icon:R.sender.avatar||"/default-avatar.png"})},ee=R=>{console.log("âœ… [SIDEBAR] Chat request sent:",R),B(L=>({...L,sent:[R,...L.sent]}))},D=R=>{var L;console.log("âœ… [SIDEBAR] Chat request accepted:",R),B(V=>({received:V.received.filter(Z=>Z._id!==R._id),sent:V.sent.filter(Z=>Z._id!==R._id)})),((L=R.receiver)==null?void 0:L._id)===(l==null?void 0:l._id)&&W(V=>Math.max(0,V-1))},H=({requestId:R})=>{console.log("âŒ [SIDEBAR] Chat request rejected:",R),B(V=>({received:V.received.filter(Z=>Z._id!==R),sent:V.sent.filter(Z=>Z._id!==R)})),N.received.some(V=>V._id===R)&&W(V=>Math.max(0,V-1))},te=({requestId:R})=>{console.log("ðŸ—‘ï¸ [SIDEBAR] Chat request cancelled:",R),B(L=>({received:L.received.filter(V=>V._id!==R),sent:L.sent.filter(V=>V._id!==R)}))},oe=R=>{console.error("âŒ [SIDEBAR] Chat request error:",R),R.message==="Chat request already exists"&&console.log("ðŸ”„ [SIDEBAR] Request already exists, should be in chat requests list")},T=({userId:R})=>{console.log("ðŸš« [SIDEBAR] User blocked:",R),B(L=>({received:L.received.filter(V=>{var Z;return((Z=V.sender)==null?void 0:Z._id)!==R}),sent:L.sent.filter(V=>{var Z;return((Z=V.receiver)==null?void 0:Z._id)!==R})}))};return u.on("chatRequestsLoaded",fe),u.on("newChatRequest",de),u.on("chatRequestSent",ee),u.on("chatRequestAccepted",D),u.on("chatRequestRejected",H),u.on("chatRequestCancelled",te),u.on("chatRequestError",oe),u.on("userBlocked",T),Y(),()=>{console.log("ðŸ§¹ [SIDEBAR] Cleaning up chat request listeners"),u.off("chatRequestsLoaded",fe),u.off("newChatRequest",de),u.off("chatRequestSent",ee),u.off("chatRequestAccepted",D),u.off("chatRequestRejected",H),u.off("chatRequestCancelled",te),u.off("chatRequestError",oe),u.off("userBlocked",T)}},[u,l,N.received]),S.useEffect(()=>{document.body.dataset.theme=f,localStorage.setItem("chat-theme",f)},[f]);const X=()=>{w(Y=>Y==="light"?"dark":"light")},ne=S.useCallback(Y=>Y?Y.avatar?Y.avatar.startsWith("http")?Y.avatar:`${window.location.origin}/uploads/${Y.avatar}`:`https://ui-avatars.com/api/?name=${encodeURIComponent(Y.name)}&background=random`:"",[]),ce=S.useCallback(Y=>{var Z,y;const fe=Y._id.toString(),ee=[...s[fe]||[]].sort((g,q)=>new Date(g.createdAt)-new Date(q.createdAt)),D=ie[fe]||0,H=ee[ee.length-1];let te="No messages yet",oe="",T=!1,R=!1,L=!1;if(H){let g="";switch(H.messageType){case"image":g="ðŸ“· Photo";break;case"video":g="ðŸŽ¬ Video";break;case"voice":g="ðŸŽ™ï¸ Voice message";break;case"file":g="ðŸ“Ž File";break;default:g=((Z=H.content)==null?void 0:Z.text)||H.content||"..."}T=((y=H.sender)==null?void 0:y._id)===(l==null?void 0:l._id),R=H.isDelivered,L=H.isRead,te=T?`You: ${g}`:g,oe=H.createdAt?new Date(H.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""}let V="";return T&&(L?V=" âœ“âœ“":R&&(V=" âœ“")),{unreadCount:D,lastMessageText:te+V,lastMessageTime:oe,hasMessages:ee.length>0,isLastMessageFromCurrentUser:T}},[s,ie,l]),ue=e.filter(Y=>Y.name.toLowerCase().includes(b.toLowerCase()));return console.log("ðŸŽ¨ [SIDEBAR] Rendering - Unread counts:",ie),console.log("ðŸ“¬ [SIDEBAR] Chat requests state:",{received:N.received.length,sent:N.sent.length,unreadCount:z}),i.jsxs(i.Fragment,{children:[i.jsx("button",{className:"hamburger-menu-button",onClick:()=>F(!M),"aria-label":"Toggle menu",children:M?i.jsx(He,{size:24}):i.jsx(ni,{size:24})}),M&&i.jsx("div",{className:"mobile-menu-overlay",onClick:()=>F(!1)}),i.jsxs("div",{className:`sidebar-container ${M?"mobile-menu-open":""}`,children:[i.jsxs("div",{className:"sidebar-header",children:[i.jsxs("div",{className:"sidebar-header-top",children:[i.jsx("h2",{className:"sidebar-title",children:"Chats"}),i.jsxs("div",{className:"sidebar-actions",children:[i.jsxs("div",{className:"action-button-wrapper",children:[i.jsxs("button",{className:"action-button",title:"Chat Requests",onClick:()=>{m(!0),W(0)},style:{position:"relative"},children:[i.jsx(ri,{size:18}),z>0&&i.jsx("span",{className:"notification-badge",children:z>99?"99+":z})]}),i.jsx("span",{className:"action-button-label",children:"Request's"})]}),i.jsxs("div",{className:"action-button-wrapper",children:[i.jsx("button",{className:"action-button",title:"Add Friend",onClick:()=>C(!0),children:i.jsx(sr,{size:18})}),i.jsx("span",{className:"action-button-label",children:"Add Friend"})]}),i.jsxs("div",{className:"action-button-wrapper",children:[i.jsx("button",{className:"action-button",title:"Blocked Users",onClick:()=>j(!0),children:i.jsx(or,{size:18})}),i.jsx("span",{className:"action-button-label",children:"Blocked User"})]})]})]}),i.jsxs("div",{className:"search-container",children:[i.jsx(Ge,{size:18,className:"search-icon"}),i.jsx("input",{type:"text",placeholder:"Search conversations...",className:"search-input",value:b,onChange:Y=>h(Y.target.value)})]})]}),i.jsxs("div",{className:"user-list",children:[ue.map(Y=>{const fe=(t==null?void 0:t._id)===Y._id,{unreadCount:de,lastMessageText:ee,lastMessageTime:D,hasMessages:H,isLastMessageFromCurrentUser:te}=ce(Y);return i.jsxs("div",{onClick:()=>n(Y),className:`user-item ${fe?"active":""} ${de>0?"has-unread":""}`,children:[i.jsxs("div",{className:"user-avatar-wrapper",children:[i.jsx("img",{src:ne(Y),alt:Y.name,className:"user-avatar",onError:oe=>{oe.target.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(Y.name)}&background=random`}}),i.jsx("div",{className:`user-status-dot ${Y.isOnline?"online":"offline"}`}),de>0&&i.jsx("span",{className:"user-unread-badge",children:de>99?"99+":de})]}),i.jsxs("div",{className:"user-details",children:[i.jsxs("div",{className:"user-details-top",children:[i.jsx("h3",{className:"user-name",children:Y.name}),H&&i.jsx("span",{className:"user-last-time",children:D})]}),i.jsxs("div",{className:"user-details-bottom",children:[i.jsx("p",{className:`user-last-message ${de>0?"unread":""}`,children:de>0&&!te?i.jsxs("span",{className:"new-message-indicator",children:["ðŸ“¬ New message ",de>1?`(${de})`:""]}):i.jsx(i.Fragment,{children:ee.length>35?`${ee.slice(0,35)}...`:ee})}),de>0&&i.jsx("div",{className:"message-indicator"})]})]})]},Y._id)}),ue.length===0&&i.jsx("div",{className:"no-users-message",children:i.jsx("p",{children:"No users found"})})]}),i.jsx("div",{className:"sidebar-profile",children:i.jsxs("div",{className:"profile-main",children:[i.jsxs("div",{className:"profile-avatar-wrapper",children:[i.jsx("img",{src:ne(l),alt:"Profile",className:"profile-avatar",onError:Y=>{Y.target.src=`https://ui-avatars.com/api/?name=${encodeURIComponent((l==null?void 0:l.name)||"User")}&background=random`}}),i.jsx("div",{className:"profile-status-indicator online",title:"Online"})]}),i.jsxs("div",{className:"profile-info",children:[i.jsx("h4",{className:"profile-name",children:l==null?void 0:l.name}),i.jsx("p",{className:"profile-status",children:"Active now"})]}),i.jsxs("div",{className:"profile-actions",children:[i.jsx("button",{onClick:()=>I(!0),className:"profile-action-button",title:"Edit Profile",children:i.jsx(ii,{size:16})}),i.jsx("button",{onClick:X,className:"profile-action-button",title:"Toggle Theme",children:f==="light"?i.jsx(si,{size:16}):i.jsx(oi,{size:16})}),i.jsx("button",{onClick:c,className:"profile-action-button logout",title:"Log Out",children:i.jsx(ai,{size:16})})]})]})}),i.jsx(ya,{isOpen:E,onClose:()=>I(!1)}),i.jsx(wa,{isOpen:x,onClose:()=>C(!1),currentFriends:e}),i.jsx(ba,{isOpen:_,onClose:()=>m(!1),requests:N}),i.jsx(xa,{isOpen:k,onClose:()=>j(!1)})]})]})},Ea=({message:e,isSender:t,onReply:n})=>{var ue,Y,fe,de,ee;const[s,a]=S.useState(!1),[l,c]=S.useState(!1),[u,b]=S.useState("default"),[h,f]=S.useState(!1),w=S.useRef(null),E=S.useRef(null),I=S.useRef(null),x=S.useRef(null),C=S.useRef(null),_=S.useRef(null),m=S.useContext(Pe),{user:k}=ke(),j=k==null?void 0:k._id,N=e!=null&&e.createdAt?new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",B=`message-bubble-wrapper ${t?"sender":"receiver"}`,z=`message-bubble ${t?"sender":"receiver"} ${h?"mobile-actions-active":""}`,W=["â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ˜¡","ðŸ‘"];S.useEffect(()=>{const D=H=>{_.current&&_.current.contains(H.target)||w.current&&!w.current.contains(H.target)&&E.current&&!E.current.contains(H.target)&&I.current&&!I.current.contains(H.target)&&x.current&&!x.current.contains(H.target)&&C.current&&!C.current.contains(H.target)&&(a(!1),c(!1),b("default"),f(!1))};return(s||l||h)&&(document.addEventListener("mousedown",D),document.addEventListener("touchstart",D)),()=>{document.removeEventListener("mousedown",D),document.removeEventListener("touchstart",D)}},[s,l,h]);const M=(D,H)=>{const te=document.createElement("a");te.href=D,te.download=H,document.body.appendChild(te),te.click(),document.body.removeChild(te)},F=D=>{var te;if(!m||!e._id||!j){console.log("âš ï¸ [MESSAGE BUBBLE] Cannot add reaction: missing socket, message._id, or currentUserId");return}console.log("ðŸ˜Š [MESSAGE BUBBLE] Adding/removing reaction:",{emoji:D,messageId:e._id,userId:j}),((te=e.reactions)==null?void 0:te.find(oe=>{var T;return((T=oe.userId)==null?void 0:T._id)===j&&oe.emoji===D}))?(console.log("ðŸ—‘ï¸ [MESSAGE BUBBLE] Removing existing reaction"),m.emit("removeReaction",{messageId:e._id})):(console.log("âž• [MESSAGE BUBBLE] Adding new reaction"),m.emit("addReaction",{messageId:e._id,emoji:D})),a(!1),c(!1),b("default"),f(!1)},G=D=>{F(D.emoji)},ie=()=>!e.reactions||e.reactions.length===0?{}:e.reactions.reduce((D,H)=>(D[H.emoji]||(D[H.emoji]={count:0,users:[]}),D[H.emoji].count++,D[H.emoji].users.push(H.userId),D),{}),$=D=>!j||!e.reactions?!1:e.reactions.some(H=>{var te;return((te=H.userId)==null?void 0:te._id)===j&&H.emoji===D}),J=D=>{window.innerWidth<=768&&(D.stopPropagation(),f(!h),a(!1),c(!1))},X=()=>{if(!t)return null;if(e!=null&&e.isOptimistic)return i.jsxs("span",{className:"message-status optimistic",title:"Sending...",children:[i.jsx(Wt,{size:14}),i.jsx("span",{className:"status-text",children:"Sending..."})]});if(e!=null&&e.failed)return i.jsxs("span",{className:"message-status failed",title:"Failed",children:[i.jsx(He,{size:14}),i.jsx("span",{className:"status-text",children:"Failed"})]});const D=(e==null?void 0:e.isDelivered)===!0;return(e==null?void 0:e.isRead)===!0?i.jsxs("span",{className:"message-status read",title:"Read",children:[i.jsx(gn,{size:14}),i.jsx("span",{className:"status-text"})]}):D?i.jsxs("span",{className:"message-status delivered",title:"Delivered",children:[i.jsx(gn,{size:14}),i.jsx("span",{className:"status-text"})]}):i.jsxs("span",{className:"message-status sent",title:"Sent",children:[i.jsx(Wt,{size:14}),i.jsx("span",{className:"status-text"})]})},ne=()=>{const D=e.messageType||"text",{content:H}=e;switch(D){case"image":return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"message-image-container",children:[i.jsx("img",{src:H.fileUrl,alt:H.fileName||"image attachment",className:"message-image"}),i.jsx("button",{className:"download-btn",onClick:()=>M(H.fileUrl,H.fileName||"image.jpg"),title:"Download image",children:i.jsx(ct,{size:16})})]}),i.jsxs("div",{className:"message-time-inline",children:[i.jsx("span",{className:"message-time",children:N}),X()]})]});case"video":return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"message-video-container",children:[i.jsx("video",{src:H.fileUrl,controls:!0,className:"message-video"}),i.jsx("button",{className:"download-btn",onClick:()=>M(H.fileUrl,H.fileName||"video.mp4"),title:"Download video",children:i.jsx(ct,{size:16})})]}),i.jsxs("div",{className:"message-time-inline",children:[i.jsx("span",{className:"message-time",children:N}),X()]})]});case"voice":return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"message-voice-container",children:[i.jsx(nt,{size:20,className:"voice-icon"}),i.jsx("audio",{src:H.fileUrl,controls:!0,className:"message-audio"}),i.jsx("button",{className:"download-btn",onClick:()=>M(H.fileUrl,H.fileName||"voice.mp3"),title:"Download voice message",children:i.jsx(ct,{size:16})})]}),i.jsxs("div",{className:"message-time-inline",children:[i.jsx("span",{className:"message-time",children:N}),X()]})]});case"file":return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"message-file-container",children:[i.jsxs("a",{href:H.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"message-file",children:["ðŸ“„ ",i.jsx("span",{children:H.fileName||"View File"})]}),i.jsx("button",{className:"download-btn",onClick:()=>M(H.fileUrl,H.fileName||"file"),title:"Download file",children:i.jsx(ct,{size:16})})]}),i.jsxs("div",{className:"message-time-inline",children:[i.jsx("span",{className:"message-time",children:N}),X()]})]});default:return i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"message-text",children:H.text}),i.jsxs("div",{className:"message-time-inline",children:[i.jsx("span",{className:"message-time",children:N}),X()]})]})}},ce=ie();return i.jsx("div",{className:B,children:i.jsxs("div",{className:"message-bubble-container",ref:C,children:[e.replyTo&&i.jsxs("div",{className:`reply-reference ${t?"sender":"receiver"}`,children:[i.jsx("div",{className:"reply-reference-line"}),i.jsxs("div",{className:"reply-reference-content",children:[i.jsx("span",{className:"reply-reference-sender",children:((ue=e.replyTo.sender)==null?void 0:ue.name)||"Unknown"}),i.jsxs("span",{className:"reply-reference-text",children:[((fe=(Y=e.replyTo.content)==null?void 0:Y.text)==null?void 0:fe.substring(0,50))||"Message",((ee=(de=e.replyTo.content)==null?void 0:de.text)==null?void 0:ee.length)>50?"...":""]})]})]}),i.jsxs("div",{className:"bubble-with-reply",children:[i.jsx("div",{className:z,onClick:J,children:i.jsx("div",{className:"message-content-wrapper",children:ne()})}),!e.isOptimistic&&i.jsx("button",{className:"permanent-reply-btn",onClick:()=>{n&&n(e),f(!1)},title:"Reply to message",children:i.jsx(li,{size:16})})]}),!e.isOptimistic&&i.jsx("div",{className:"message-actions",children:i.jsx("button",{ref:E,className:"message-action-btn reaction-trigger-btn",onClick:D=>{D.stopPropagation(),console.log("ðŸ–±ï¸ [MESSAGE BUBBLE] Reaction button clicked"),a(!s),c(!1),b("default"),f(!1)},title:"Add reaction",children:i.jsx(Vt,{size:16})})}),!e.isOptimistic&&h&&i.jsx("div",{className:"mobile-actions-overlay",ref:_,children:i.jsx("div",{className:`mobile-actions ${t?"sender":"receiver"}`,children:i.jsxs("button",{className:"mobile-action-btn reaction-btn",onClick:D=>{D.stopPropagation(),a(!s),c(!1),b("default")},title:"Add reaction",children:[i.jsx(Vt,{size:18}),i.jsx("span",{className:"mobile-action-text",children:"React"})]})})}),Object.keys(ce).length>0&&i.jsxs("div",{ref:I,className:`message-reactions ${t?"sender":"receiver"}`,children:[Object.entries(ce).map(([D,H])=>i.jsxs("button",{className:`reaction-badge ${$(D)?"user-reacted":""}`,onClick:te=>{te.stopPropagation(),F(D)},title:H.users.map(te=>(te==null?void 0:te.name)||"Unknown").join(", "),children:[i.jsx("span",{className:"reaction-emoji",children:D}),H.count>1&&i.jsx("span",{className:"reaction-count",children:H.count})]},D)),i.jsx("button",{className:"reaction-badge reaction-add-btn",onClick:D=>{D.stopPropagation(),c(!l),a(!1),b("reactions-bar"),f(!1)},title:"Add reaction",children:i.jsx("span",{className:"reaction-emoji",children:"+"})})]}),s&&i.jsxs("div",{ref:w,className:`reaction-picker ${t?"sender":"receiver"} ${u}`,onClick:D=>D.stopPropagation(),children:[i.jsx("div",{className:"reaction-picker-header",children:i.jsx("button",{className:"reaction-picker-close",onClick:D=>{D.stopPropagation(),a(!1)},title:"Close reaction picker",children:"Ã—"})}),i.jsxs("div",{className:"reaction-options",children:[W.map(D=>i.jsx("button",{className:`reaction-option ${$(D)?"active":""}`,onClick:H=>{H.stopPropagation(),F(D)},title:$(D)?"Remove reaction":"Add reaction",children:D},D)),i.jsx("button",{className:"reaction-option reaction-more-btn",onClick:D=>{D.stopPropagation(),a(!1),c(!0),b("default")},title:"More reactions",children:"+"})]})]}),l&&i.jsxs("div",{ref:x,className:`emoji-picker-container ${t?"sender":"receiver"} ${u}`,onClick:D=>D.stopPropagation(),children:[i.jsx("button",{className:"emoji-picker-close",onClick:D=>{D.stopPropagation(),c(!1)},title:"Close emoji picker",children:"Ã—"}),i.jsx(ar,{onEmojiClick:G,width:300,height:400,searchDisabled:!0,skinTonesDisabled:!0,previewConfig:{showPreview:!1}})]})]})})},er=(e,t)=>{S.useEffect(()=>{const n=s=>{!e.current||e.current.contains(s.target)||t(s)};return document.addEventListener("mousedown",n),document.addEventListener("touchstart",n),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)}},[e,t])},va=({show:e,onClose:t,onCapture:n})=>{const s=S.useRef(null),a=S.useRef(null),[l,c]=S.useState(null),[u,b]=S.useState(null);S.useEffect(()=>{e?(b(null),navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}}).then(w=>{c(w),s.current&&(s.current.srcObject=w)}).catch(w=>{console.error("Camera access denied:",w),alert("Camera access was denied. Please allow camera access in your browser settings."),t()})):l&&(l.getTracks().forEach(w=>w.stop()),c(null))},[e]);const h=()=>{if(s.current&&a.current){const w=s.current,E=a.current;E.width=w.videoWidth,E.height=w.videoHeight,E.getContext("2d").drawImage(w,0,0,w.videoWidth,w.videoHeight);const I=E.toDataURL("image/jpeg");b(I)}},f=()=>{n(u),b(null),t()};return e?i.jsxs("div",{className:"camera-modal-overlay",children:[i.jsxs("div",{className:"camera-modal-content",children:[i.jsx("button",{onClick:t,className:"camera-modal-close",children:"Ã—"}),u?i.jsx("img",{src:u,alt:"Captured",className:"camera-preview"}):i.jsx("video",{ref:s,autoPlay:!0,playsInline:!0,className:"camera-feed"}),i.jsx("div",{className:"camera-actions",children:u?i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:()=>b(null),className:"camera-button",children:"Retake"}),i.jsx("button",{onClick:f,className:"camera-button primary",children:"Use Photo"})]}):i.jsx("button",{onClick:h,className:"camera-button capture-button",children:"Capture"})})]}),i.jsx("canvas",{ref:a,style:{display:"none"}})]}):null},Ra=({onRecordingComplete:e,onCancel:t})=>{const[n,s]=S.useState(!1),[a,l]=S.useState(0),[c,u]=S.useState(null),[b,h]=S.useState(null),f=S.useRef(null),w=S.useRef([]),E=S.useRef(null),I=S.useRef(null),x=async()=>{try{const N=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}});I.current=N;let B="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(B)||(B="audio/webm"),MediaRecorder.isTypeSupported(B)||(B="audio/ogg;codecs=opus"),MediaRecorder.isTypeSupported(B)||(B=""),console.log("ðŸŽ¤ Using MIME type:",B||"default");const z=B?{mimeType:B}:{},W=new MediaRecorder(N,z);f.current=W,w.current=[],W.ondataavailable=M=>{M.data.size>0&&(console.log("ðŸŽ¤ Audio chunk received:",M.data.size,"bytes"),w.current.push(M.data))},W.onstop=()=>{console.log("ðŸŽ¤ Recording stopped, chunks:",w.current.length);const M=W.mimeType||B||"audio/webm",F=new Blob(w.current,{type:M});console.log("ðŸŽ¤ Created audio blob:",{size:F.size,type:F.type});const G=URL.createObjectURL(F);u(F),h(G),I.current&&(I.current.getTracks().forEach(ie=>ie.stop()),I.current=null)},W.start(100),s(!0),l(0),E.current=setInterval(()=>{l(M=>M+1)},1e3),console.log("ðŸŽ¤ Recording started")}catch(N){console.error("âŒ Error accessing microphone:",N),alert("Microphone access denied. Please allow microphone access in your browser settings.")}},C=()=>{f.current&&n&&(console.log("ðŸ›‘ Stopping recording..."),f.current.stop(),s(!1),clearInterval(E.current))},_=async()=>{if(c){console.log("ðŸ“¤ Sending voice recording:",{size:c.size,type:c.type});try{let N="webm";c.type.includes("ogg")?N="ogg":c.type.includes("mp3")?N="mp3":c.type.includes("wav")&&(N="wav");const B=`voice-message-${Date.now()}.${N}`;let z;try{z=new Yt([c],B,{type:c.type})}catch{z=c,z.name=B,z.lastModified=Date.now()}console.log("ðŸ“¤ Created file:",{name:z.name,size:z.size,type:z.type}),await e(z),b&&URL.revokeObjectURL(b)}catch(N){console.error("âŒ Error sending voice recording:",N),alert("Failed to send voice message. Please try again.")}}},m=()=>{n&&C(),clearInterval(E.current),I.current&&(I.current.getTracks().forEach(N=>N.stop()),I.current=null),b&&URL.revokeObjectURL(b),t()},k=()=>{b&&URL.revokeObjectURL(b),u(null),h(null),l(0),w.current=[],x()},j=N=>{const B=Math.floor(N/60),z=N%60;return`${B}:${z.toString().padStart(2,"0")}`};return S.useEffect(()=>()=>{b&&URL.revokeObjectURL(b),E.current&&clearInterval(E.current),I.current&&I.current.getTracks().forEach(N=>N.stop())},[b]),i.jsx("div",{className:"voice-recorder-container",children:i.jsxs("div",{className:"voice-recorder",children:[i.jsxs("div",{className:"recording-indicator",children:[i.jsx("span",{className:`recording-dot ${n?"active":""}`}),i.jsx("span",{className:"recording-time",children:j(a)})]}),b&&i.jsxs("div",{className:"audio-preview",children:[i.jsx("audio",{controls:!0,src:b,className:"preview-audio"}),i.jsx("div",{className:"audio-duration",children:j(a)})]}),i.jsx("div",{className:"recorder-buttons",children:b?i.jsxs(i.Fragment,{children:[i.jsxs("button",{onClick:_,className:"recorder-button send",children:[i.jsx(cn,{size:16})," Send Voice"]}),i.jsxs("button",{onClick:k,className:"recorder-button record-again",children:[i.jsx(nt,{size:16})," Record Again"]}),i.jsx("button",{onClick:m,className:"recorder-button cancel",children:"Cancel"})]}):i.jsxs(i.Fragment,{children:[n?i.jsxs("button",{onClick:C,className:"recorder-button stop",children:[i.jsx(di,{size:20})," Stop Recording"]}):i.jsxs("button",{onClick:x,className:"recorder-button start",children:[i.jsx(nt,{size:20})," Start Recording"]}),i.jsx("button",{onClick:m,className:"recorder-button cancel",children:"Cancel"})]})})]})})},Ca=({onSendMessage:e,onSendFile:t,selectedUser:n,socket:s})=>{const[a,l]=S.useState(""),[c,u]=S.useState(!1),[b,h]=S.useState(!1),[f,w]=S.useState(!1),[E,I]=S.useState(!1),x=S.useRef(null),C=S.useRef(0),{user:_}=ke(),m=S.useRef(null),k=S.useRef(null),j=S.useRef(null),N=S.useRef(null),B=S.useRef(null),z=S.useRef(null);er(m,()=>u(!1)),er(j,()=>h(!1));const W=(X,ne)=>[X,ne].sort().join("_"),M=X=>{const ne=X.target.value;if(l(ne),!s||!n||!_)return;const ce=W(_._id,n._id),ue=ne.trim().length>0,Y=Date.now();x.current&&clearTimeout(x.current),ue?(Y-C.current>1e3&&(s.emit("typing",{chatId:ce}),C.current=Y),x.current=setTimeout(()=>{s.emit("stopTyping",{chatId:ce}),C.current=0},3e3)):(s.emit("stopTyping",{chatId:ce}),C.current=0)},F=X=>{if(X.preventDefault(),!a.trim())return;const ne=W(_._id,n._id);s.emit("stopTyping",{chatId:ne}),C.current=0,e(a.trim()),l(""),u(!1),x.current&&clearTimeout(x.current)},G=X=>{l(ne=>ne+X.emoji),k.current.focus()},ie=X=>{const ne=X.target.files[0];ne&&t(ne),X.target.value="",h(!1)},$=X=>{fetch(X).then(ne=>ne.blob()).then(ne=>{const ce=`capture-${Date.now()}.jpg`;let ue;try{ue=new Yt([ne],ce,{type:"image/jpeg"})}catch{ue=ne,ue.name=ce,ue.lastModified=Date.now()}t(ue)})},J=async X=>{try{console.log("ðŸŽ¤ Voice recording to send:",{name:X.name,type:X.type,size:X.size}),await t(X),I(!1),console.log("âœ… Voice message sent successfully")}catch(ne){console.error("âŒ Error sending voice recording:",ne),alert("Failed to send voice message. Please try again.")}};return S.useEffect(()=>()=>{if(x.current&&clearTimeout(x.current),s&&n&&_){const X=W(_._id,n._id);s.emit("stopTyping",{chatId:X})}},[s,n,_]),E?i.jsx(Ra,{onRecordingComplete:J,onCancel:()=>I(!1)}):i.jsxs("div",{className:"message-input-container",children:[i.jsx(va,{show:f,onClose:()=>w(!1),onCapture:$}),c&&i.jsx("div",{ref:m,className:"emoji-picker-wrapper",children:i.jsx(ar,{onEmojiClick:G,theme:"light"})}),b&&i.jsxs("div",{ref:j,className:"attachment-menu",children:[i.jsxs("button",{onClick:()=>N.current.click(),className:"attachment-menu-item",children:[i.jsx(ci,{size:20})," Image"]}),i.jsxs("button",{onClick:()=>w(!0),className:"attachment-menu-item",children:[i.jsx(rr,{size:20})," Camera"]}),i.jsxs("button",{onClick:()=>B.current.click(),className:"attachment-menu-item",children:[i.jsx(ln,{size:20})," Video"]}),i.jsxs("button",{onClick:()=>z.current.click(),className:"attachment-menu-item",children:[i.jsx(Yt,{size:20})," File"]})]}),i.jsxs("form",{onSubmit:F,className:"message-input-form",children:[i.jsx("button",{type:"button",onClick:()=>h(X=>!X),className:"message-input-button attachment-button",children:i.jsx(ui,{size:22})}),i.jsx("button",{type:"button",onClick:()=>u(X=>!X),className:"message-input-button emoji-button",children:i.jsx(Vt,{size:22})}),i.jsx("button",{type:"button",onClick:()=>I(!0),className:"message-input-button voice-button",children:i.jsx(nt,{size:22})}),i.jsx("div",{className:"input-wrapper",children:i.jsx("input",{ref:k,value:a,onChange:M,placeholder:"Type your message...",className:"message-input-field",type:"text"})}),i.jsx("button",{type:"submit",className:"message-input-button send-button",disabled:!a.trim(),children:i.jsx(cn,{size:20})}),i.jsx("input",{type:"file",accept:"image/*",ref:N,onChange:ie,style:{display:"none"}}),i.jsx("input",{type:"file",accept:"video/*",ref:B,onChange:ie,style:{display:"none"}}),i.jsx("input",{type:"file",ref:z,onChange:ie,style:{display:"none"}})]})]})},Sa=()=>{const{myVideo:e,userVideo:t,callAccepted:n,callEnded:s,stream:a,leaveCall:l}=S.useContext(_t),[c,u]=S.useState(!1),[b,h]=S.useState(!1);if(!n||s)return null;const f=()=>{a.getAudioTracks()[0].enabled=c,u(!c)},w=()=>{a.getVideoTracks()[0].enabled=b,h(!b)};return i.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-75 z-50 flex flex-col items-center justify-center",children:[i.jsx("video",{playsInline:!0,ref:t,autoPlay:!0,className:"w-full h-full object-cover"}),i.jsx("div",{className:"absolute top-4 right-4 w-1/4 max-w-xs border-2 border-white rounded-lg overflow-hidden",children:i.jsx("video",{playsInline:!0,muted:!0,ref:e,autoPlay:!0,className:"w-full h-full object-cover"})}),i.jsxs("div",{className:"absolute bottom-10 flex items-center space-x-6",children:[i.jsx("button",{onClick:f,className:`p-4 rounded-full ${c?"bg-red-500":"bg-gray-600"} text-white`,children:c?i.jsx(fi,{}):i.jsx(nt,{})}),i.jsx("button",{onClick:l,className:"p-4 rounded-full bg-red-600 hover:bg-red-700 text-white transform scale-110",children:i.jsx(lr,{})}),i.jsx("button",{onClick:w,className:`p-4 rounded-full ${b?"bg-red-500":"bg-gray-600"} text-white`,children:b?i.jsx(hi,{}):i.jsx(ln,{})})]})]})},Na=()=>{const{call:e,answerCall:t,leaveCall:n}=S.useContext(_t);return e.isReceivingCall?i.jsxs("div",{className:"fixed top-5 right-5 bg-gray-800 text-white p-4 rounded-lg shadow-lg z-50 flex items-center space-x-4 animate-pulse",children:[i.jsx("img",{src:"https://i.pravatar.cc/150",alt:e.name,className:"w-12 h-12 rounded-full"}),i.jsx("div",{children:i.jsxs("p",{className:"font-semibold",children:[e.name," is calling..."]})}),i.jsxs("div",{className:"flex space-x-2",children:[i.jsx("button",{onClick:t,className:"p-3 bg-green-500 hover:bg-green-600 rounded-full",children:i.jsx(cr,{size:20})}),i.jsx("button",{onClick:n,className:"p-3 bg-red-500 hover:bg-red-600 rounded-full",children:i.jsx(lr,{size:20})})]})]}):null},ja=({userName:e})=>{const t=["ðŸ‘¤","ðŸ§‘â€ðŸ’»","ðŸ™‚","ðŸ¤”","ðŸ˜Ž","â¤ï¸","ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ˜†","ðŸ˜…","ðŸ˜‚","ðŸ¤£","ðŸ¥²","ðŸ¥¹","â˜ºï¸","ðŸ˜Š","ðŸ˜‡","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜Œ","ðŸ˜","ðŸ¥°","ðŸ˜˜","ðŸ˜—","ðŸ˜™","ðŸ˜š","ðŸ˜‹","ðŸ˜›","ðŸ˜","ðŸ˜œ","ðŸ¤ª","ðŸ¤¨","ðŸ§","ðŸ¤“","ðŸ˜Ž","ðŸ¥¸","ðŸ¤©","ðŸ¥³","ðŸ˜","ðŸ˜’","ðŸ˜ž","ðŸ˜”","ðŸ˜Ÿ","ðŸ˜•","ðŸ™","â˜¹ï¸","ðŸ˜£","ðŸ˜–","ðŸ˜«","ðŸ˜©","ðŸ¥º","ðŸ˜¢","ðŸ˜­","ðŸ˜¤","ðŸ˜ ","ðŸ˜¡","ðŸ¤¬","ðŸ¤¯","ðŸ˜³","ðŸ¥µ","ðŸ¥¶","ðŸ˜±","ðŸ˜¨","ðŸ˜°","ðŸ˜¥","ðŸ˜“","ðŸ¤—","ðŸ¤”","ðŸ¤­","ðŸ¤«","ðŸ¤¥","ðŸ˜¶","ðŸ˜","ðŸ˜‘","ðŸ˜¬","ðŸ™„","ðŸ˜¯","ðŸ˜¦","ðŸ˜§","ðŸ˜®","ðŸ˜²","ðŸ¥±","ðŸ˜´","ðŸ¤¤","ðŸ˜ª","ðŸ˜µ","ðŸ˜µâ€ðŸ’«","ðŸ¤","ðŸ¥´","ðŸ¤¢","ðŸ¤®","ðŸ¤§","ðŸ˜·","ðŸ¤’","ðŸ¤•","ðŸ¤‘","ðŸ¤ ","ðŸ˜ˆ","ðŸ‘¿","ðŸ‘¹","ðŸ‘º","ðŸ¤¡","ðŸ’©","ðŸ‘»","ðŸ’€","â˜ ï¸","ðŸ‘½","ðŸ‘¾","ðŸ¤–","ðŸŽƒ","ðŸ˜º","ðŸ˜¸","ðŸ˜¹","ðŸ˜»","ðŸ˜¼","ðŸ˜½","ðŸ™€","ðŸ˜¿","ðŸ˜¾"],[n,s]=S.useState(t[0]);return S.useEffect(()=>{const a=setInterval(()=>{s(l=>{const u=(t.indexOf(l)+1)%t.length;return t[u]})},700);return()=>clearInterval(a)},[]),i.jsx("div",{className:"typing-indicator-float",children:i.jsxs("div",{className:"typing-indicator-popup",children:[i.jsx("div",{className:"typing-avatar-container",children:i.jsx("div",{className:"human-emote",children:n})}),i.jsxs("div",{className:"typing-content",children:[i.jsxs("div",{className:"typing-text",children:[i.jsx("span",{className:"typing-name",children:e})," is typing"]}),i.jsxs("div",{className:"typing-dots",children:[i.jsx("span",{className:"dot"}),i.jsx("span",{className:"dot"}),i.jsx("span",{className:"dot"})]})]})]})})},tt=(e,t)=>[e,t].sort().join("_"),Ta=({selectedUser:e,onOptimisticMessage:t})=>{var Z,y,g,q;const[n,s]=S.useState([]),[a,l]=S.useState(""),[c,u]=S.useState(!1),[b,h]=S.useState(!1),[f,w]=S.useState(!1),[E,I]=S.useState(!1),[x,C]=S.useState(null),[_,m]=S.useState(!1),[k,j]=S.useState(null),[N,B]=S.useState(3),[z,W]=S.useState(!1),[M,F]=S.useState(null),G=S.useRef(null),ie=S.useRef(null),$=S.useContext(Pe),{user:J}=ke(),{callUser:X}=S.useContext(_t),ne=S.useRef(null),ce=()=>{var P;(P=ne.current)==null||P.scrollIntoView({behavior:"smooth"})};S.useEffect(ce,[n,E]),S.useEffect(()=>{const P=Q=>{ie.current&&!ie.current.contains(Q.target)&&W(!1)};return document.addEventListener("mousedown",P),()=>document.removeEventListener("mousedown",P)},[]),S.useEffect(()=>{if(!$||!e||!J)return;const P=tt(J._id,e._id),Q=r=>{var o;!r||!((o=r.sender)!=null&&o._id)||r.chatId===P&&(console.log("ðŸ“¨ [CHAT WINDOW] Received message:",r),s(p=>[...p.filter(A=>A.tempId!==r.tempId),r]),r.sender._id!==J._id&&$.emit("markMessageAsRead",{messageId:r._id,senderId:r.sender._id}))},K=r=>{r.chatId===P&&(console.log("ðŸ“š [CHAT WINDOW] Messages loaded:",r.messages.length),s(r.messages),w(!1),r.messages.filter(p=>p.sender._id!==J._id&&!p.isRead).length>0&&$.emit("markChatAsRead",{otherUserId:e._id}))},re=r=>{w(!1),r.requiresFriendship?alert("You must be friends with this user to view messages. Send a chat request first!"):r.isBlocked&&alert("You cannot view messages from this user.")},be=r=>{r.chatId===P&&(s([]),h(!1))},_e=r=>{r.chatId===P&&s(o=>o.filter(p=>p._id!==r.messageId))},Re=r=>{const{messageId:o,deliveredAt:p}=r;s(v=>v.map(A=>A._id===o||A.tempId===r.tempId?{...A,isDelivered:!0,deliveredAt:p}:A))},xe=r=>{const{messageId:o,readAt:p}=r;s(v=>v.map(A=>A._id===o?{...A,isRead:!0,readAt:p}:A))},pe=r=>{const{readAt:o,readBy:p}=r;p!==J._id&&s(v=>v.map(A=>A.sender._id===J._id&&!A.isRead?{...A,isRead:!0,readAt:o}:A))},je=r=>{(r==null?void 0:r.userId)!==J._id&&(r==null?void 0:r.userId)===e._id&&(r==null?void 0:r.chatId)===P&&(C(e.name),I(!0),G.current&&clearTimeout(G.current),G.current=setTimeout(()=>{I(!1),C(null)},6e3))},Ie=r=>{(r==null?void 0:r.userId)!==J._id&&(r==null?void 0:r.userId)===e._id&&(r==null?void 0:r.chatId)===P&&(I(!1),C(null),G.current&&clearTimeout(G.current))},Ee=r=>{r.chatId===P&&(m(!0),j(new Date(r.expiresAt)),console.log("ðŸ•µï¸ Incognito mode enabled:",r))},Ce=r=>{r.chatId===P&&(m(!1),j(null),console.log("ðŸ‘ï¸ Incognito mode disabled:",r))},d=r=>{r.chatId===P&&(m(r.enabled),r.enabled&&r.expiresAt?j(new Date(r.expiresAt)):j(null),console.log("ðŸ•µï¸ Incognito status loaded:",r))};return $.on("receiveMessage",Q),$.on("messagesLoaded",K),$.on("messagesLoadError",re),$.on("chatCleared",be),$.on("messageDeleted",_e),$.on("messageDelivered",Re),$.on("messageRead",xe),$.on("chatRead",pe),$.on("typing",je),$.on("stopTyping",Ie),$.on("incognitoEnabled",Ee),$.on("incognitoDisabled",Ce),$.on("incognitoStatus",d),$.on("messageSent",r=>{r!=null&&r.success&&r.tempId&&s(o=>o.map(p=>p.tempId===r.tempId?{...p,_id:r.messageId,isOptimistic:!1,confirmed:!0,isDelivered:r.isDelivered||!1,deliveredAt:r.deliveredAt||null}:p))}),$.on("sendMessageError",r=>{r.requiresFriendship?alert("You must be friends to send messages. Send a chat request first!"):r.isBlocked&&alert("You cannot send messages to this user."),r.tempId&&s(o=>o.map(p=>p.tempId===r.tempId?{...p,isOptimistic:!1,failed:!0,errorMessage:r.message}:p))}),$.emit("getIncognitoStatus",{otherUserId:e._id}),()=>{$.off("receiveMessage",Q),$.off("messagesLoaded",K),$.off("messagesLoadError",re),$.off("chatCleared",be),$.off("messageDeleted",_e),$.off("messageDelivered",Re),$.off("messageRead",xe),$.off("chatRead",pe),$.off("typing",je),$.off("stopTyping",Ie),$.off("incognitoEnabled",Ee),$.off("incognitoDisabled",Ce),$.off("incognitoStatus",d),$.off("messageSent"),$.off("sendMessageError"),G.current&&clearTimeout(G.current)}},[$,e,J]),S.useEffect(()=>{if(!$||!e||!J)return;const P=K=>{const{messageId:re,reactions:be,chatId:_e}=K,Re=tt(J._id,e._id);_e===Re&&(console.log("ðŸ˜Š [CHAT WINDOW] Reaction updated:",{messageId:re,reactionCount:be.length}),s(xe=>xe.map(pe=>pe._id===re||pe.tempId===re?{...pe,reactions:be}:pe)))},Q=K=>{console.error("âŒ [CHAT WINDOW] Reaction error:",K),alert(`Failed to add reaction: ${K.message}`)};return $.on("reactionUpdated",P),$.on("reactionError",Q),()=>{$.off("reactionUpdated",P),$.off("reactionError",Q)}},[$,e,J]);const ue=(P=null)=>{if(!$||!e)return;const Q=!_,K=P||N;console.log("ðŸ”„ Toggling incognito mode:",Q,"Duration:",K,"hours"),$.emit("toggleIncognito",{otherUserId:e._id,enabled:Q,durationHours:K}),W(!1)},Y=P=>{B(P),_?ue(P):W(!1)},fe=P=>{console.log("ðŸ’¬ [CHAT WINDOW] Replying to message:",P),F(P)},de=()=>{F(null)},ee=async P=>{if(!P.trim()||!e||!$)return;const Q=Date.now().toString(),K=tt(J._id,e._id),re={receiverId:e._id,messageType:"text",content:{text:P},tempId:Q};M&&(re.replyTo={messageId:M._id,sender:M.sender,content:M.content}),$.emit("sendMessage",re),$.emit("userActivity");const be={_id:Q,tempId:Q,chatId:K,receiverId:e._id,sender:{_id:J._id,name:J.name,avatar:J.avatar},content:{text:P},messageType:"text",createdAt:new Date().toISOString(),isOptimistic:!0,isDelivered:!1,isRead:!1,deliveredAt:null,readAt:null,replyTo:M?{messageId:M._id,sender:M.sender,content:M.content}:null};if(s(_e=>[..._e,be]),F(null),t&&t(be,e._id),!e.isOnline)try{await fetch("https://lovebirds-ph.onrender.com/api/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recipientEmail:e.email,senderName:J.name})})}catch(_e){console.error("Failed to send offline email:",_e)}},D=async P=>{if(!P||!e||!$)return;const Q=new FormData;Q.append("file",P);try{const K=await fetch("https://lovebirds-ph.onrender.com/api/upload",{method:"POST",body:Q});if(!K.ok){const Ce=await K.json();throw new Error(Ce.message||"File upload failed")}const re=await K.json(),{fileUrl:be,fileName:_e,mimeType:Re}=re;let xe="file";Re.startsWith("image/")?xe="image":Re.startsWith("video/")?xe="video":Re.startsWith("audio/")&&(xe="voice");const pe=Date.now().toString(),je=tt(J._id,e._id),Ie={receiverId:e._id,messageType:xe,content:{fileUrl:be,fileName:xe==="voice"?`voice-message-${Date.now()}.webm`:_e},tempId:pe};M&&(Ie.replyTo={messageId:M._id,sender:M.sender,content:M.content}),$.emit("sendMessage",Ie);const Ee={_id:pe,tempId:pe,chatId:je,receiverId:e._id,sender:{_id:J._id,name:J.name,avatar:J.avatar},content:{fileUrl:be,fileName:xe==="voice"?`voice-message-${Date.now()}.webm`:_e},messageType:xe,createdAt:new Date().toISOString(),isOptimistic:!0,isDelivered:!1,isRead:!1,deliveredAt:null,readAt:null,replyTo:M?{messageId:M._id,sender:M.sender,content:M.content}:null};s(Ce=>[...Ce,Ee]),F(null)}catch(K){console.error("âŒ Error uploading and sending file:",K),alert(`File upload failed: ${K.message}`)}},H=()=>{window.confirm("Are you sure you want to clear this chat? This action cannot be undone.")&&$.emit("clearChat",{otherUserId:e._id}),h(!1)},te=()=>{window.confirm(`Are you sure you want to remove ${e.name} from your friends? You will need to send a new chat request to message them again.`)?$&&(console.log("ðŸ”„ Removing friend:",e._id),$.emit("removeFriend",{friendId:e._id}),alert(`${e.name} has been removed from your friends list.`),h(!1)):h(!1)},oe=()=>{window.confirm(`Are you sure you want to block ${e.name}? They will be removed from your friends and won't be able to send you messages or chat requests.`)?$&&(console.log("ðŸš« Blocking user:",e._id),$.emit("blockUser",{userIdToBlock:e._id}),alert(`${e.name} has been blocked successfully.`),h(!1)):h(!1)};if(S.useEffect(()=>{if(!e){s([]),I(!1),m(!1),j(null),F(null);return}if(s([]),l(""),u(!1),h(!1),w(!0),I(!1),F(null),$){const P=tt(J._id,e._id);$.emit("joinChat",P),$.emit("loadMessages",{otherUserId:e._id})}},[e,$,J]),S.useEffect(()=>{const P=()=>{!document.hidden&&e&&$&&$.emit("markChatAsRead",{otherUserId:e._id})};return document.addEventListener("visibilitychange",P),window.addEventListener("focus",P),()=>{document.removeEventListener("visibilitychange",P),window.removeEventListener("focus",P)}},[e,$]),!e)return i.jsx("div",{className:"chat-placeholder",children:i.jsxs("div",{className:"placeholder-content",children:[i.jsx(cn,{size:64,className:"placeholder-icon"}),i.jsx("h2",{children:"Welcome to Chat"}),i.jsx("p",{children:"Select a friend from the sidebar to start a conversation"})]})});const T=P=>P!=null&&P.avatar?P.avatar.startsWith("http")?P.avatar:`${window.location.origin}/uploads/${P.avatar}`:`https://ui-avatars.com/api/?name=${encodeURIComponent((P==null?void 0:P.name)||"User")}&background=random`,R=P=>{var Q;return((Q=P==null?void 0:P.sender)==null?void 0:Q._id)===J._id},L=a?n.filter(P=>{var Q,K;return(K=(Q=P.content)==null?void 0:Q.text)==null?void 0:K.toLowerCase().includes(a.toLowerCase())}):n,V=()=>{if(!k)return"";const Q=k-new Date;if(Q<=0)return"Expired";const K=Math.floor(Q/(1e3*60*60)),re=Math.floor(Q%(1e3*60*60)/(1e3*60));return K>0?`${K}h ${re}m remaining`:`${re}m remaining`};return i.jsxs("div",{className:"chat-window-container",children:[i.jsx(Na,{}),i.jsx(Sa,{}),E&&i.jsx(ja,{userName:x||e.name}),i.jsxs("div",{className:"chat-header",children:[i.jsxs("div",{className:"user-info",children:[i.jsx("img",{src:T(e),alt:e.name,className:"header-avatar",onError:P=>{P.target.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(e.name)}&background=random`}}),i.jsxs("div",{className:"user-details",children:[i.jsx("h3",{className:"header-name",children:e.name}),i.jsxs("p",{className:"header-status",children:[i.jsx("span",{className:`status-indicator ${e.isOnline?"online":"offline"}`}),E?`${e.name} is typing...`:e.isOnline?"Active now":"Offline"]}),_&&k&&i.jsxs("p",{className:"incognito-status",children:["ðŸ•µï¸ Incognito mode â€¢ ",V()]})]})]}),i.jsxs("div",{className:"header-actions",children:[i.jsx("button",{onClick:()=>u(!c),className:`header-btn ${c?"active":""}`,title:"Search messages",children:i.jsx(Ge,{size:20})}),i.jsxs("div",{className:"incognito-toggle-container",ref:ie,children:[i.jsxs("label",{className:"incognito-toggle",children:[i.jsx("input",{type:"checkbox",checked:_,onChange:()=>ue()}),i.jsx("span",{className:"incognito-slider"})]}),i.jsxs("div",{className:"incognito-controls",children:[i.jsx("span",{className:"incognito-label",children:"Incognito"}),i.jsxs("button",{className:"incognito-duration-btn",onClick:()=>W(!z),title:"Select duration",children:[N,"h ",i.jsx(pi,{size:14})]})]}),z&&i.jsxs("div",{className:"incognito-duration-menu",children:[i.jsxs("button",{className:`duration-option ${N===1?"active":""}`,onClick:()=>Y(1),children:[i.jsx("span",{className:"duration-icon",children:"â±ï¸"}),i.jsx("span",{className:"duration-text",children:"1 Hour"}),N===1&&i.jsx("span",{className:"check-icon",children:"âœ“"})]}),i.jsxs("button",{className:`duration-option ${N===2?"active":""}`,onClick:()=>Y(2),children:[i.jsx("span",{className:"duration-icon",children:"â±ï¸"}),i.jsx("span",{className:"duration-text",children:"2 Hours"}),N===2&&i.jsx("span",{className:"check-icon",children:"âœ“"})]}),i.jsxs("button",{className:`duration-option ${N===3?"active":""}`,onClick:()=>Y(3),children:[i.jsx("span",{className:"duration-icon",children:"â±ï¸"}),i.jsx("span",{className:"duration-text",children:"3 Hours"}),N===3&&i.jsx("span",{className:"check-icon",children:"âœ“"})]})]})]}),i.jsx("button",{onClick:()=>X(e._id),className:"header-btn",title:"Video call",children:i.jsx(ln,{size:20})}),i.jsx("button",{className:"header-btn",title:"Voice call",children:i.jsx(cr,{size:20})}),i.jsxs("div",{className:"menu-container",children:[i.jsx("button",{className:"header-btn",title:"More options",onClick:()=>h(!b),children:i.jsx(mi,{size:20})}),b&&i.jsxs("div",{className:"dropdown-menu",children:[i.jsxs("button",{className:"dropdown-item warning",onClick:te,children:[i.jsx(gi,{size:16})," Remove Friend"]}),i.jsxs("button",{className:"dropdown-item danger",onClick:oe,children:[i.jsx(an,{size:16})," Block User"]}),i.jsx("div",{className:"dropdown-divider"}),i.jsxs("button",{className:"dropdown-item danger",onClick:H,children:[i.jsx(yi,{size:16})," Clear Chat"]})]})]})]})]}),c&&i.jsx("div",{className:"search-container-chat",children:i.jsxs("div",{className:"search-input-wrapper",children:[i.jsx(Ge,{size:16,className:"search-icon"}),i.jsx("input",{type:"text",placeholder:"Search in conversation...",value:a,onChange:P=>l(P.target.value),className:"search-input-chat",autoFocus:!0}),a&&i.jsx("button",{onClick:()=>l(""),className:"clear-search",children:"Ã—"})]})}),M&&i.jsx("div",{className:"reply-bar",children:i.jsxs("div",{className:"reply-bar-content",children:[i.jsxs("div",{className:"reply-bar-info",children:[i.jsxs("span",{className:"reply-bar-label",children:["â†©ï¸ Replying to ",M.sender.name]}),i.jsxs("span",{className:"reply-bar-message",children:[M.messageType==="text"?((y=(Z=M.content)==null?void 0:Z.text)==null?void 0:y.substring(0,60))||"Message":`${M.messageType.charAt(0).toUpperCase()+M.messageType.slice(1)} message`,((q=(g=M.content)==null?void 0:g.text)==null?void 0:q.length)>60?"...":""]})]}),i.jsx("button",{className:"reply-bar-cancel",onClick:de,title:"Cancel reply",children:i.jsx(He,{size:20})})]})}),i.jsx("div",{className:"messages-area",onClick:()=>h(!1),children:i.jsxs("div",{className:"messages-list",children:[f?i.jsx("div",{className:"loading-messages",children:i.jsx("p",{children:"Loading messages..."})}):L.length===0?i.jsx("div",{className:"no-messages",children:a?i.jsxs("div",{className:"no-search-results",children:[i.jsx(Ge,{size:48}),i.jsxs("p",{children:['No messages found for "',a,'"']})]}):i.jsxs("div",{className:"chat-start",children:[i.jsx("div",{className:"start-avatar",children:i.jsx("img",{src:T(e),alt:e.name})}),i.jsxs("h3",{children:["Start chatting with ",e.name]}),i.jsx("p",{children:"Send a message to begin your conversation"})]})}):L.map((P,Q)=>i.jsx(Ea,{message:P,isSender:R(P),onReply:fe},P._id||P.tempId||Q)),i.jsx("div",{ref:ne})]})}),i.jsx(Ca,{onSendMessage:ee,onSendFile:D,socket:$,selectedUser:e})]})},tr=()=>i.jsx("svg",{className:"logo-icon",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:i.jsx("path",{d:"M12.7,21.9C9,21.5,5.2,18.8,3,15.1c-1.3-2.2-1.8-4.7-1.6-7.2c0.2-2.5,1.2-4.8,2.9-6.6 C6.1,0,8.6-0.5,11.1,0.3c1.9,0.6,3.5,1.9,4.6,3.6c-0.6-0.3-1.3-0.5-2-0.6c-2.1-0.3-4.2,0.6-5.6,2.3c-1.2,1.5-1.7,3.4-1.4,5.3 c0.3,2,1.7,3.7,3.6,4.5c0.3,0.1,0.6,0.2,0.9,0.3c-0.1,0.2-0.2,0.3-0.2,0.5c-0.6,0.9-0.8,2-0.6,3.1c0.2,1,0.8,1.9,1.6,2.6 C12.3,21.8,12.5,21.8,12.7,21.9z M21.3,12.3c-0.2-2.5-1.2-4.8-2.9-6.6c-1.8-1.8-4.1-2.7-6.5-2.5c-0.6,0-1.2,0.1-1.8,0.3 c1.2-1.9,3.1-3.2,5.3-3.6c2.5-0.5,5,0.1,6.8,1.8c1.8,1.8,2.7,4.1,2.5,6.5c-0.1,1.9-0.9,3.6-2.1,5c-0.8,0.9-1.8,1.6-2.8,2.1 c0.5,0.2,1,0.2,1.5,0.1c2.1-0.3,4-1.6,5.1-3.4C22.2,16.5,22,14.2,21.3,12.3z"})}),Aa=({messagesMap:e,lastMessageUpdate:t,onOptimisticMessage:n})=>{const[s,a]=S.useState(null),[l,c]=S.useState([]),[u,b]=S.useState(!0),[h,f]=S.useState(null),[w,E]=S.useState(!1),[I,x]=S.useState("sidebar"),{user:C,loading:_}=ke(),m=S.useContext(Pe);S.useEffect(()=>{!_&&C&&(async()=>{if(!C){b(!1);return}try{console.log("ðŸ‘¥ [CHAT LAYOUT] Fetching friends list...");const N=localStorage.getItem("token");if(!N)throw new Error("No authentication token found");let B=await fetch("https://lovebirds-ph.onrender.com/api/users/friends/list",{headers:{Authorization:`Bearer ${N}`,"Content-Type":"application/json"}}),z=[];if(B.ok)z=await B.json(),console.log("âœ… [CHAT LAYOUT] Loaded friends:",z.length);else if(console.log("âš ï¸ [CHAT LAYOUT] Friends endpoint failed, fetching all users..."),B=await fetch("https://lovebirds-ph.onrender.com/api/users",{headers:{Authorization:`Bearer ${N}`,"Content-Type":"application/json"}}),B.ok)z=(await B.json()).filter(F=>F._id!==C._id),console.log("âœ… [CHAT LAYOUT] Loaded users (fallback):",z.length);else throw new Error("Failed to fetch users");const W=z.map(M=>({...M,avatar:M.avatar||null,name:M.name||"Unknown User",email:M.email||"No email",isOnline:M.isOnline||!1,lastSeen:M.lastSeen||new Date}));c(W),f(null),console.log("âœ… [CHAT LAYOUT] Final users list:",W.length)}catch(N){console.error("âŒ [CHAT LAYOUT] Failed to fetch users:",N),f("Could not load user data. Please try again later."),c([])}finally{b(!1)}})()},[C,_]),S.useEffect(()=>{if(!m){console.log("âš ï¸ [CHAT LAYOUT] No socket available");return}console.log("ðŸŽ§ [CHAT LAYOUT] Setting up socket listeners");const j=W=>{console.log("ðŸ“Š [CHAT LAYOUT] User status update:",W),c(M=>M.map(F=>F._id===W.userId?{...F,isOnline:W.isOnline,lastSeen:W.lastSeen,status:W.status}:F))},N=W=>{console.log("âœ… [CHAT LAYOUT] Chat request accepted:",W);const M=W.sender._id===C._id?W.receiver:W.sender;c(F=>{if(F.some($=>$._id===M._id))return console.log("âš ï¸ [CHAT LAYOUT] Friend already in list"),F;console.log("âž• [CHAT LAYOUT] Adding new friend:",M.name);const ie={...M,avatar:M.avatar||null,name:M.name||"Unknown User",email:M.email||"No email",isOnline:M.isOnline||!1,lastSeen:M.lastSeen||new Date};return[...F,ie]}),alert(`You are now friends with ${M.name}!`)},B=({userId:W})=>{console.log("ðŸš« [CHAT LAYOUT] User blocked:",W),c(M=>M.filter(F=>F._id!==W)),(s==null?void 0:s._id)===W&&a(null),alert("User has been blocked.")},z=({userId:W})=>{console.log("âœ… [CHAT LAYOUT] User unblocked:",W)};return m.on("userStatus",j),m.on("chatRequestAccepted",N),m.on("userBlocked",B),m.on("userUnblocked",z),()=>{console.log("ðŸ§¹ [CHAT LAYOUT] Cleaning up socket listeners"),m.off("userStatus",j),m.off("chatRequestAccepted",N),m.off("userBlocked",B),m.off("userUnblocked",z)}},[m,C,s]);const k=j=>{console.log("ðŸ‘¤ [CHAT LAYOUT] User selected:",j.name,j._id),a(j)};return _?i.jsxs("div",{className:"loading-state",children:[i.jsx("div",{className:"spinner"}),i.jsx("p",{children:"Checking authentication..."})]}):C?u?i.jsxs("div",{className:"loading-state",children:[i.jsx("div",{className:"spinner"}),i.jsx("p",{children:"Loading chats..."})]}):h?i.jsxs("div",{className:"error-state",children:[i.jsx("p",{children:h}),i.jsx("button",{onClick:()=>window.location.reload(),children:"Retry"})]}):(console.log("ðŸŽ¨ [CHAT LAYOUT] Rendering with:",{usersCount:l.length,selectedUser:s==null?void 0:s.name,hasMessagesMap:!!e,messagesMapSize:Object.keys(e||{}).length,lastMessageUpdate:t==null?void 0:t.timestamp}),i.jsxs("div",{className:"chat-layout-container",children:[i.jsxs(Me.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"logo-container",children:[i.jsx(tr,{}),i.jsx("h1",{className:"logo-title",children:"LOVEBIRDS"}),i.jsx("p",{className:"logo-tagline",children:"Connect & Share"})]}),i.jsxs(Me.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},className:"chat-card",children:[i.jsx(_a,{users:l,selectedUser:s,onSelectUser:k,messagesMap:e,lastMessageUpdate:t}),i.jsx(Ta,{selectedUser:s,onOptimisticMessage:n})]})]})):i.jsx("div",{className:"auth-required",children:i.jsxs("div",{className:"logo-container",children:[i.jsx(tr,{}),i.jsx("h1",{className:"logo-title",children:"LOVEBIRDS"}),i.jsx("p",{className:"logo-tagline",children:"Please log in to continue"})]})})},Ia=()=>{const{user:e,loading:t}=ke(),{theme:n}=Us(),s=Ni(),[a,l]=S.useState({}),[c,u]=S.useState(null);S.useEffect(()=>{if(!s||!e){console.log("âš ï¸ [APP] Socket or user not ready");return}console.log("ðŸŽ§ [APP] Setting up message listeners for user:",e.name);const h=f=>{var m,k,j,N,B;console.log("ðŸ“¨ [APP] New message received:",{messageId:f._id,sender:(m=f.sender)==null?void 0:m.name,senderID:(k=f.sender)==null?void 0:k._id,receiverId:f.receiverId,currentUserId:e._id,messageType:f.messageType,isForSender:f.isForSender,isForReceiver:f.isForReceiver});const w=(N=(j=f.sender)==null?void 0:j._id)==null?void 0:N.toString(),E=(B=f.receiverId)==null?void 0:B.toString(),I=e._id.toString();let x,C;w===I?(x=E,C=!1,console.log("ðŸ“¤ [APP] I SENT this message to:",x)):(x=w,C=!0,console.log("ðŸ“¬ [APP] I RECEIVED this message from:",x)),l(z=>{const W={...z};return W[x]||(W[x]=[]),W[x].some(F=>F._id===f._id||F.tempId===f.tempId)?console.log("âš ï¸ [APP] Message already exists in messagesMap, skipping"):(W[x]=[...W[x],f],console.log("âœ… [APP] Added message to messagesMap for:",x)),W});const _={userId:x,message:f,timestamp:Date.now(),isReceived:C,isDelivered:f.isDelivered||!1,isRead:f.isRead||!1};console.log("ðŸ”” [APP] Setting lastMessageUpdate:",_),u({..._})};return s.on("receiveMessage",h),s.on("newMessageForSidebar",h),console.log("âœ… [APP] Message listeners attached"),()=>{console.log("ðŸ§¹ [APP] Cleaning up message listeners"),s.off("receiveMessage",h),s.off("newMessageForSidebar",h)}},[s,e]),S.useEffect(()=>{if(!s)return;const h=E=>{console.log("âœ… [APP] Message delivered:",E),l(I=>{const x={...I};return Object.keys(x).forEach(C=>{x[C]=x[C].map(_=>_._id===E.messageId||_.tempId===E.tempId?{..._,isDelivered:!0,deliveredAt:E.deliveredAt}:_)}),x}),u(I=>I?{...I,timestamp:Date.now()}:null)},f=E=>{console.log("ðŸ‘ï¸ [APP] Message read:",E),l(I=>{const x={...I};return Object.keys(x).forEach(C=>{x[C]=x[C].map(_=>_._id===E.messageId?{..._,isRead:!0,readAt:E.readAt}:_)}),x}),u(I=>I?{...I,timestamp:Date.now()}:null)},w=E=>{console.log("ðŸ‘ï¸ [APP] Chat read:",E),l(I=>{const x={...I};return Object.keys(x).forEach(C=>{x[C]=x[C].map(_=>{var m;return _.chatId===E.chatId&&((m=_.sender)==null?void 0:m._id)!==e._id?{..._,isRead:!0,readAt:E.readAt}:_})}),x}),u(I=>I?{...I,timestamp:Date.now()}:null)};return s.on("messageDelivered",h),s.on("messageRead",f),s.on("chatRead",w),()=>{s.off("messageDelivered",h),s.off("messageRead",f),s.off("chatRead",w)}},[s,e]);const b=(h,f)=>{console.log("âœ¨ [APP] Optimistic message received:",{messageId:h._id,tempId:h.tempId,otherUserId:f,content:h.content}),S.useEffect(()=>{if(!(!s||!e))return s.on("friendRemoved",E=>{console.log("âœ… [APP] Friend removed:",E.userId),s.emit("getUsers")}),s.on("friendRemovedBy",E=>{console.log("ðŸ‘‹ [APP] You were removed by:",E.userName),alert(`${E.userName} removed you from their friends list.`),s.emit("getUsers")}),s.on("removeFriendError",E=>{console.error("âŒ [APP] Remove friend error:",E.message),alert(E.message||"Failed to remove friend")}),()=>{s.off("friendRemoved"),s.off("friendRemovedBy"),s.off("removeFriendError")}},[s,e]),l(E=>{const I={...E};return I[f]||(I[f]=[]),I[f]=[...I[f],h],I});const w={userId:f,message:h,timestamp:Date.now(),isReceived:!1,isDelivered:h.isDelivered||!1,isRead:!1};console.log("ðŸ”” [APP] Setting optimistic lastMessageUpdate:",w),u({...w})};return t?i.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-900 text-white",children:i.jsx("p",{className:"text-xl",children:"Loading Application..."})}):(console.log("ðŸ”Œ [APP] Rendering with:",{socketConnected:!!s,socketId:(s==null?void 0:s.id)||"not-connected",userPresent:!!e,messagesMapSize:Object.keys(a).length,lastMessageUpdateTimestamp:c==null?void 0:c.timestamp}),i.jsx("div",{"data-theme":n,className:"app-wrapper",children:e?i.jsx(Aa,{socket:s,messagesMap:a,lastMessageUpdate:c,onOptimisticMessage:b}):i.jsx(ga,{})}))};function ka(){return i.jsx(Ms,{children:i.jsx(fr,{children:i.jsx(hr,{children:i.jsx(Nr,{children:i.jsx(Ia,{})})})})})}const Oa="870428754330-1rerr0864mf12kg17voeqks820o0n9ru.apps.googleusercontent.com";Gt.createRoot(document.getElementById("root")).render(i.jsx(ur.StrictMode,{children:i.jsx(_i,{children:i.jsx(Ci,{clientId:Oa,children:i.jsx(fr,{children:i.jsx(hr,{children:i.jsx(Nr,{children:i.jsx(ka,{})})})})})})}));
